<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="12 Data Wrangling &amp; Tidy data Revisited | Data Science for the Natural Environment (FA21)" />
<meta property="og:type" content="book" />





<meta name="author" content="Shannon J. O’Leary" />

<meta name="date" content="2021-09-16" />


<meta name="description" content="12 Data Wrangling &amp; Tidy data Revisited | Data Science for the Natural Environment (FA21)">

<title>12 Data Wrangling &amp; Tidy data Revisited | Data Science for the Natural Environment (FA21)</title>

<link href="libs/tufte-css/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css/msmb.css" rel="stylesheet" />
<script src="libs/accessible-code-block/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="msmb.css" type="text/css" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script>
function copy_link(id) {
  var dummy = document.createElement('input'),
  text = window.location.href.split(/[?#]/)[0] + '#' + id;
  document.body.appendChild(dummy);
  dummy.value = text;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  
  var tooltip = document.getElementById(id + '-tooltip');
  tooltip.innerHTML = 'Copied!';
}

function reset_tooltip(id) {
  var tooltip = document.getElementById(id);
  tooltip.innerHTML = 'Copy link';
}
</script>

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Data Science for the Natural Environment (FA21)<p><p class="author">Shannon J. O'Leary</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html">Overview</a>
<a href="what-even-is-data-science.html"><span class="toc-section-number">1</span> What even is data science?</a>
<a href="installing-rrstudio.html"><span class="toc-section-number">2</span> Installing R/Rstudio</a>
<a href="project-management-and-rmarkdown-basics.html"><span class="toc-section-number">3</span> Project management and Rmarkdown Basics</a>
<a href="r-functions-objects-vectors-oh-my.html"><span class="toc-section-number">4</span> R: Functions, Objects, Vectors - oh my!</a>
<a href="identifying-essential-fish-habitat-shark-nurseries-on-the-texas-coast.html"><span class="toc-section-number">5</span> Identifying essential fish habitat: Shark Nurseries on the Texas coast</a>
<a href="intro-to-data-frames.html"><span class="toc-section-number">6</span> Intro to data frames</a>
<a href="welcome-to-the-tidyverse.html"><span class="toc-section-number">7</span> Welcome to the tidyverse</a>
<a href="catch-data-analysis.html"><span class="toc-section-number">8</span> Catch data analysis</a>
<a href="scientific-misconduct-and-the-reproducible-crisis.html"><span class="toc-section-number">9</span> Scientific misconduct and the reproducible crisis</a>
<a href="responsible-research-is-reproducible-research.html"><span class="toc-section-number">10</span> Responsible Research is Reproducible Research</a>
<a href="project-management-revisited.html"><span class="toc-section-number">11</span> Project Management Revisited</a>
<a id="active-page" href="data-wrangling-tidy-data-revisited.html"><span class="toc-section-number">12</span> Data Wrangling &amp; Tidy data Revisited</a><ul class="toc-sections">
<li class="toc"><a href="#round-1"> Round 1</a></li>
<li class="toc"><a href="#round-2"> Round 2</a></li>
<li class="toc"><a href="#round-3"> Round 3</a></li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div id="data-wrangling-tidy-data-revisited" class="section level1">
<h1>
<span class="header-section-number">12</span> Data Wrangling &amp; Tidy data Revisited</h1>
<p><strong>Learning Objectives</strong></p>
<p>After completing this set of activities you should be able to</p>
<ul>
<li>confidently distinguish between tidy and non-tidy data sets</li>
<li>confidently use <code>pivot_longer()</code> and <code>pivot_wider()</code> to convert between tidy (long) and non-tidy (wide) data frames</li>
</ul>
<p>Download the files I have dropped in the <code>#hwassignments</code> channel on slack and put them in your <code>data</code> folder (<code>.../02_ReproducibleResearch/data/</code>).</p>
<p>Then use <code>File &gt; New File &gt; R Script</code> or <code>Ctrl + Shift + N</code> to open an <code>R script</code> to document the code you are about to write as you practice some of your data wrangling and tidying skills.<label for="tufte-sn-1" class="margin-toggle sidenote-number">1</label><input type="checkbox" id="tufte-sn-1" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">1</span> Remember, <code>R scripts</code> are “all code” compared to <code>Rmarkdown</code> files that are a combination of plan text and code chunks.</span></p>
<p>Save your <code>R script</code> as <code>tidy.R</code> and at the top of your script start by loading the tidyverse packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-wrangling-tidy-data-revisited.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>As always - Comment your code!</p>
<div id="round-1" class="section level2">
<h2>
<span class="header-section-number">12.1</span> Round 1<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('round-1')" onmouseout="reset_tooltip('round-1-tooltip')"><span class="tooltiptext" id="round-1-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>The <code>tidyverse</code> set of R packages includes a few data sets we can use to play around with and sharpen our skills.</p>
<p>A typical messy/non-tidy data set is formatted for presentation as opposed to analysis. This means that we frequently find variables both in rows and in columns, and some of our columns headers are actually values not variable names.</p>
<p>Load a data set into your environment which contains information on income and religious affiliation for the US and take a look at the contents using <code>head()</code> and <code>View()</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-wrangling-tidy-data-revisited.html#cb2-1"></a>df &lt;-<span class="st"> </span>relig_income</span>
<span id="cb2-2"><a href="data-wrangling-tidy-data-revisited.html#cb2-2"></a></span>
<span id="cb2-3"><a href="data-wrangling-tidy-data-revisited.html#cb2-3"></a><span class="kw">head</span>(relig_income)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   religion  `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 Agnostic       27        34        60        81        76       137        122
## 2 Atheist        12        27        37        52        35        70         73
## 3 Buddhist       27        21        30        34        33        58         62
## 4 Catholic      418       617       732       670       638      1116        949
## 5 Don’t kn~      15        14        15        11        10        35         21
## 6 Evangeli~     575       869      1064       982       881      1486        949
## # ... with 3 more variables: $100-150k &lt;dbl&gt;, &gt;150k &lt;dbl&gt;,
## #   Don't know/refused &lt;dbl&gt;</code></pre>
<p>Remember, a tidy data set has three interrelated rules</p>
<ol style="list-style-type: decimal">
<li>Every variable has its own column.</li>
<li>Every observation has its own row</li>
<li>Every value has its own cell.</li>
</ol>
<p>To tidy a data set you first want to take a look at your data and determine what the observations, variables, and values are. One of the most typical issues we find are that some of the column names are actually values, we might also have some columns that are redundant, or columns that contain more than one value.</p>
<div id="ques:t1" class="question">
<p class="question-begin">
► Question 1
</p>
<div class="question-body">
<p>Use <code>View(df)</code> to take a closer the data set. Is it a tidy data set? Can you identify redundant columns? Are there columns that are likely values instead of variables? What variables can you identify that are already correctly formatted as columns?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-1" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-1', 'sol-start-1')"></span>
</p>
<div id="sol-body-1" class="solution-body" style="display: none;">
<ul>
<li>variables:
<ul>
<li>
<code>religion</code> is definitely a variable</li>
</ul>
</li>
<li>all other column names appear to be values indicating income</li>
<li>values in the cells apart from the religion column are frequency of observing a combination of religion and income.</li>
</ul>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:t2" class="question">
<p class="question-begin">
► Question 2
</p>
<div class="question-body">
<p>What should our tidy data set look like conceptually (what variables should be included). What function can you use to make this a tidy data set?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-2" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-2', 'sol-start-2')"></span>
</p>
<div id="sol-body-2" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-wrangling-tidy-data-revisited.html#cb4-1"></a>tidy &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="data-wrangling-tidy-data-revisited.html#cb4-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">names_to =</span> <span class="st">"income"</span>, <span class="dt">values_to =</span> <span class="st">"frequency"</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">11</span>)</span>
<span id="cb4-3"><a href="data-wrangling-tidy-data-revisited.html#cb4-3"></a></span>
<span id="cb4-4"><a href="data-wrangling-tidy-data-revisited.html#cb4-4"></a><span class="kw">head</span>(tidy)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   religion income  frequency
##   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;
## 1 Agnostic &lt;$10k          27
## 2 Agnostic $10-20k        34
## 3 Agnostic $20-30k        60
## 4 Agnostic $30-40k        81
## 5 Agnostic $40-50k        76
## 6 Agnostic $50-75k       137</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
</div>
<div id="round-2" class="section level2">
<h2>
<span class="header-section-number">12.2</span> Round 2<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('round-2')" onmouseout="reset_tooltip('round-2-tooltip')"><span class="tooltiptext" id="round-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>Load a new data frame - this one contains information on the data a song first entered the billboard top 100 and then tracks the rank for each successive week.</p>
<p>This format is convenient for data entry - but is it tidy?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-wrangling-tidy-data-revisited.html#cb6-1"></a>df &lt;-<span class="st"> </span>billboard</span>
<span id="cb6-2"><a href="data-wrangling-tidy-data-revisited.html#cb6-2"></a></span>
<span id="cb6-3"><a href="data-wrangling-tidy-data-revisited.html#cb6-3"></a><span class="kw">head</span>(df)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 79
##   artist   track    date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##   &lt;chr&gt;    &lt;chr&gt;    &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 2 Pac    Baby Do~ 2000-02-26      87    82    72    77    87    94    99    NA
## 2 2Ge+her  The Har~ 2000-09-02      91    87    92    NA    NA    NA    NA    NA
## 3 3 Doors~ Krypton~ 2000-04-08      81    70    68    67    66    57    54    53
## 4 3 Doors~ Loser    2000-10-21      76    76    72    69    67    65    55    59
## 5 504 Boyz Wobble ~ 2000-04-15      57    34    25    17    17    31    36    49
## 6 98^0     Give Me~ 2000-08-19      51    39    34    26    26    19     2     2
## # ... with 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
## #   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
## #   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
## #   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;,
## #   wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;,
## #   wk49 &lt;dbl&gt;, wk50 &lt;dbl&gt;, wk51 &lt;dbl&gt;, wk52 &lt;dbl&gt;, wk53 &lt;dbl&gt;, wk54 &lt;dbl&gt;,
## #   wk55 &lt;dbl&gt;, wk56 &lt;dbl&gt;, wk57 &lt;dbl&gt;, wk58 &lt;dbl&gt;, wk59 &lt;dbl&gt;, wk60 &lt;dbl&gt;,
## #   wk61 &lt;dbl&gt;, wk62 &lt;dbl&gt;, wk63 &lt;dbl&gt;, wk64 &lt;dbl&gt;, wk65 &lt;dbl&gt;, wk66 &lt;lgl&gt;,
## #   wk67 &lt;lgl&gt;, wk68 &lt;lgl&gt;, wk69 &lt;lgl&gt;, wk70 &lt;lgl&gt;, wk71 &lt;lgl&gt;, wk72 &lt;lgl&gt;,
## #   wk73 &lt;lgl&gt;, wk74 &lt;lgl&gt;, wk75 &lt;lgl&gt;, wk76 &lt;lgl&gt;</code></pre>
<div id="ques:t3" class="question">
<p class="question-begin">
► Question 3
</p>
<div class="question-body">
<p>Use <code>View(df)</code> to take a closer the data set. Is it a tidy data set? Can you identify redundant columns? Are there columns that are likely values instead of variables? What variables can you identify that are already correctly formatted as columns?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-3" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-3', 'sol-start-3')"></span>
</p>
<div id="sol-body-3" class="solution-body" style="display: none;">
<ul>
<li>variables:
<ul>
<li>
<code>artist</code>, <code>track</code>, and <code>date.entered</code> are definitely variables</li>
</ul>
</li>
<li>all other column names appear to be values indicating the week</li>
<li>values in the cells of columns named <code>wkxx</code> are ranks.</li>
</ul>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:t4" class="question">
<p class="question-begin">
► Question 4
</p>
<div class="question-body">
<p>What should our tidy data set look like conceptually (what variables should be included). What function can you use to make this a tidy data set?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-4" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-4', 'sol-start-4')"></span>
</p>
<div id="sol-body-4" class="solution-body" style="display: none;">
<p>Previously, we used column position to gather, we can also use column names. We can also use the argument <code>values_drop_na = TRUE</code> to drop missing values. In this example, not all songs stay in the billboard for all 76 weeks that are tracked, once we pivot to a tidy (long) format that will result in a lot of observations (rows) that are <code>NA</code>. By enabling the <code>values_drop_na</code> option it saves us a step of having to use <code>filter()</code> to get rid of those unnecessary rows.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-wrangling-tidy-data-revisited.html#cb8-1"></a>tidy &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="data-wrangling-tidy-data-revisited.html#cb8-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">names_to =</span> <span class="st">"week"</span>, <span class="dt">values_to =</span> <span class="st">"rank"</span>, wk1<span class="op">:</span>wk76, <span class="dt">values_drop_na =</span> <span class="ot">FALSE</span>)</span>
<span id="cb8-3"><a href="data-wrangling-tidy-data-revisited.html#cb8-3"></a></span>
<span id="cb8-4"><a href="data-wrangling-tidy-data-revisited.html#cb8-4"></a><span class="kw">head</span>(tidy)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   artist track                   date.entered week   rank
##   &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
## 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87
## 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82
## 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72
## 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77
## 5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87
## 6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:t5" class="question">
<p class="question-begin">
► Question 5
</p>
<div class="question-body">
<p>How could you sort the data set by</p>
<ul>
<li>artist, track, week?</li>
<li>date, rank?</li>
</ul>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-5" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-5', 'sol-start-5')"></span>
</p>
<div id="sol-body-5" class="solution-body" style="display: none;">
<p>Previously we used column position to gather, we can also use column names to indicate which columns are being gathered into a key-value pair.</p>
<p>Helpful argument of <code>pivot_longer()</code> that we haven’t explored yet is <code>values_drop_na = TRUE</code> to drop missing values. In this example, not all songs stay in the billboard for all 76 weeks that are tracked, once we pivot to a tidy (long) format that will result in a lot of observations (rows) that are <code>NA</code>. By enabling the <code>values_drop_na</code> option it saves us a step of having to use <code>filter()</code> to get rid of those unnecessary rows.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-wrangling-tidy-data-revisited.html#cb10-1"></a>tidy <span class="op">%&gt;%</span></span>
<span id="cb10-2"><a href="data-wrangling-tidy-data-revisited.html#cb10-2"></a><span class="st">  </span><span class="kw">arrange</span>(artist, track, week) <span class="op">%&gt;%</span></span>
<span id="cb10-3"><a href="data-wrangling-tidy-data-revisited.html#cb10-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   artist track                   date.entered week   rank
##   &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
## 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87
## 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk10     NA
## 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk11     NA
## 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk12     NA
## 5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk13     NA
## 6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk14     NA</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-wrangling-tidy-data-revisited.html#cb12-1"></a>tidy <span class="op">%&gt;%</span></span>
<span id="cb12-2"><a href="data-wrangling-tidy-data-revisited.html#cb12-2"></a><span class="st">  </span><span class="kw">arrange</span>(date.entered, rank)</span></code></pre></div>
<pre><code>## # A tibble: 24,092 x 5
##    artist   track  date.entered week   rank
##    &lt;chr&gt;    &lt;chr&gt;  &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
##  1 Lonestar Amazed 1999-06-05   wk40      1
##  2 Lonestar Amazed 1999-06-05   wk41      1
##  3 Lonestar Amazed 1999-06-05   wk42      2
##  4 Lonestar Amazed 1999-06-05   wk39      3
##  5 Lonestar Amazed 1999-06-05   wk43      3
##  6 Lonestar Amazed 1999-06-05   wk44      4
##  7 Lonestar Amazed 1999-06-05   wk45      4
##  8 Lonestar Amazed 1999-06-05   wk46      5
##  9 Lonestar Amazed 1999-06-05   wk47      6
## 10 Lonestar Amazed 1999-06-05   wk48      8
## # ... with 24,082 more rows</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
</div>
<div id="round-3" class="section level2">
<h2>
<span class="header-section-number">12.3</span> Round 3<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('round-3')" onmouseout="reset_tooltip('round-3-tooltip')"><span class="tooltiptext" id="round-3-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>You can load the <code>who</code> data set which contains tuberculosis (TB) cases by year, country, age, sex, and method diagnosed from the <a href="http://www.who.int/tb/country/data/download/en/">2014 WHO Report</a>.</p>
<p>Start by loading the data set into your environment and taking a quick look at the information contained.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-wrangling-tidy-data-revisited.html#cb14-1"></a><span class="co"># load data set</span></span>
<span id="cb14-2"><a href="data-wrangling-tidy-data-revisited.html#cb14-2"></a>df &lt;-<span class="st"> </span>who</span>
<span id="cb14-3"><a href="data-wrangling-tidy-data-revisited.html#cb14-3"></a></span>
<span id="cb14-4"><a href="data-wrangling-tidy-data-revisited.html#cb14-4"></a><span class="kw">head</span>(who)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 60
##   country   iso2  iso3   year new_sp_m014 new_sp_m1524 new_sp_m2534 new_sp_m3544
##   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt; &lt;int&gt;       &lt;int&gt;        &lt;int&gt;        &lt;int&gt;        &lt;int&gt;
## 1 Afghanis~ AF    AFG    1980          NA           NA           NA           NA
## 2 Afghanis~ AF    AFG    1981          NA           NA           NA           NA
## 3 Afghanis~ AF    AFG    1982          NA           NA           NA           NA
## 4 Afghanis~ AF    AFG    1983          NA           NA           NA           NA
## 5 Afghanis~ AF    AFG    1984          NA           NA           NA           NA
## 6 Afghanis~ AF    AFG    1985          NA           NA           NA           NA
## # ... with 52 more variables: new_sp_m4554 &lt;int&gt;, new_sp_m5564 &lt;int&gt;,
## #   new_sp_m65 &lt;int&gt;, new_sp_f014 &lt;int&gt;, new_sp_f1524 &lt;int&gt;,
## #   new_sp_f2534 &lt;int&gt;, new_sp_f3544 &lt;int&gt;, new_sp_f4554 &lt;int&gt;,
## #   new_sp_f5564 &lt;int&gt;, new_sp_f65 &lt;int&gt;, new_sn_m014 &lt;int&gt;,
## #   new_sn_m1524 &lt;int&gt;, new_sn_m2534 &lt;int&gt;, new_sn_m3544 &lt;int&gt;,
## #   new_sn_m4554 &lt;int&gt;, new_sn_m5564 &lt;int&gt;, new_sn_m65 &lt;int&gt;,
## #   new_sn_f014 &lt;int&gt;, new_sn_f1524 &lt;int&gt;, new_sn_f2534 &lt;int&gt;,
## #   new_sn_f3544 &lt;int&gt;, new_sn_f4554 &lt;int&gt;, new_sn_f5564 &lt;int&gt;,
## #   new_sn_f65 &lt;int&gt;, new_ep_m014 &lt;int&gt;, new_ep_m1524 &lt;int&gt;,
## #   new_ep_m2534 &lt;int&gt;, new_ep_m3544 &lt;int&gt;, new_ep_m4554 &lt;int&gt;,
## #   new_ep_m5564 &lt;int&gt;, new_ep_m65 &lt;int&gt;, new_ep_f014 &lt;int&gt;,
## #   new_ep_f1524 &lt;int&gt;, new_ep_f2534 &lt;int&gt;, new_ep_f3544 &lt;int&gt;,
## #   new_ep_f4554 &lt;int&gt;, new_ep_f5564 &lt;int&gt;, new_ep_f65 &lt;int&gt;,
## #   newrel_m014 &lt;int&gt;, newrel_m1524 &lt;int&gt;, newrel_m2534 &lt;int&gt;,
## #   newrel_m3544 &lt;int&gt;, newrel_m4554 &lt;int&gt;, newrel_m5564 &lt;int&gt;,
## #   newrel_m65 &lt;int&gt;, newrel_f014 &lt;int&gt;, newrel_f1524 &lt;int&gt;,
## #   newrel_f2534 &lt;int&gt;, newrel_f3544 &lt;int&gt;, newrel_f4554 &lt;int&gt;,
## #   newrel_f5564 &lt;int&gt;, newrel_f65 &lt;int&gt;</code></pre>
<p>Is this a tidy data set?</p>
<p>Nope - this is a typical, real-life messy data set… so, let’s tidy it up.</p>
<div id="ques:t6" class="question">
<p class="question-begin">
► Question 6
</p>
<div class="question-body">
<p>Use <code>View(df)</code> to take a closer the data set. Can you identify redundant columns? Are there columns that are likely values instead of variables? What variables can you identify that are already columns.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-6" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-6', 'sol-start-6')"></span>
</p>
<div id="sol-body-6" class="solution-body" style="display: none;">
<ul>
<li>variables:
<ul>
<li>
<code>year</code> is definitely a variable</li>
<li>
<code>country</code>, <code>iso2</code>, and <code>iso3</code> all specify country in different ways</li>
</ul>
</li>
<li>all others appear to be values.</li>
</ul>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Our first step should be to gather all the columns that appear to be values<label for="tufte-sn-2" class="margin-toggle sidenote-number">2</label><input type="checkbox" id="tufte-sn-2" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">2</span> whenever you’re not entirely sure what the variable is, a good name for that column is <code>key</code>.</span>, we know from the description of the data set that our values that are recorded in the data set are case numbers so let’s call our column containing the values currently in those columns <code>cases</code>. You’ve also noticed that there are a lot of <code>NA</code> values so we will drop those when we pivot the table.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-wrangling-tidy-data-revisited.html#cb16-1"></a>tidy &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb16-2"><a href="data-wrangling-tidy-data-revisited.html#cb16-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">names_to =</span> <span class="st">"key"</span>, <span class="dt">values_to =</span> <span class="st">"cases"</span>, <span class="dt">cols =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">60</span>, <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span>)</span>
<span id="cb16-3"><a href="data-wrangling-tidy-data-revisited.html#cb16-3"></a></span>
<span id="cb16-4"><a href="data-wrangling-tidy-data-revisited.html#cb16-4"></a><span class="kw">head</span>(tidy)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   country     iso2  iso3   year key          cases
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;
## 1 Afghanistan AF    AFG    1997 new_sp_m014      0
## 2 Afghanistan AF    AFG    1997 new_sp_m1524    10
## 3 Afghanistan AF    AFG    1997 new_sp_m2534     6
## 4 Afghanistan AF    AFG    1997 new_sp_m3544     3
## 5 Afghanistan AF    AFG    1997 new_sp_m4554     5
## 6 Afghanistan AF    AFG    1997 new_sp_m5564     2</code></pre>
<p>Note the difference in dimensions between <code>df</code> and <code>tidy</code>.</p>
<p>Okay, so what gives with those values in the format of <code>new_ep_f014</code> etc?</p>
<p>If you where to go to the documentation (meta-data) for this data set you would find that each of these codes for several pieces of information.</p>
<ul>
<li>first three letters indicates whether these are old or new TB cases (all of ours are new).</li>
<li>the next two letters describe the type of TB (e.g. <code>rel</code> is relapse).</li>
<li>sixth letter is the sex of TB patient.</li>
<li>remaining numbers are the age group (e.g. 014 is 0 - 14)</li>
</ul>
<div id="ques:t7" class="question">
<p class="question-begin">
► Question 7
</p>
<div class="question-body">
<p>If the definition of a tidy data set is that each column is a single variable, what should our next step be? What function would you use to achieve this?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-7" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-7', 'sol-start-7')"></span>
</p>
<div id="sol-body-7" class="solution-body" style="display: none;">
<p>Correct, we must separate this column into multiple columns using <code>separate()</code><label for="tufte-sn-3" class="margin-toggle sidenote-number">3</label><input type="checkbox" id="tufte-sn-3" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">3</span> There is an unhelpful formatting issue where instead of <code>new_rel</code> (easy to separate, and other entries have this format with the underscore) the entries are <code>newrel</code> so we will add a line of code using a function from the <code>stringr</code> package to fix that first.</span></p>
<p>Because the values are not consistently separated using an <code>_</code>, we have to use a two step process where we first create new column called <code>sexagegrp</code> and the separate that into <code>sex</code> and <code>agegrp</code> using positional information.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-wrangling-tidy-data-revisited.html#cb18-1"></a>tidy &lt;-<span class="st"> </span>tidy <span class="op">%&gt;%</span></span>
<span id="cb18-2"><a href="data-wrangling-tidy-data-revisited.html#cb18-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">str_replace</span>(key, <span class="st">"newrel"</span>, <span class="st">"new_rel"</span>)) <span class="op">%&gt;%</span></span>
<span id="cb18-3"><a href="data-wrangling-tidy-data-revisited.html#cb18-3"></a><span class="st">  </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">"new"</span>, <span class="st">"type"</span>, <span class="st">"sexage"</span>), <span class="dt">sep =</span> <span class="st">"_"</span>) <span class="op">%&gt;%</span></span>
<span id="cb18-4"><a href="data-wrangling-tidy-data-revisited.html#cb18-4"></a><span class="st">  </span><span class="kw">separate</span>(sexage, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">"sex"</span>, <span class="st">"age"</span>), <span class="dt">sep =</span> <span class="dv">1</span>)</span>
<span id="cb18-5"><a href="data-wrangling-tidy-data-revisited.html#cb18-5"></a>  </span>
<span id="cb18-6"><a href="data-wrangling-tidy-data-revisited.html#cb18-6"></a><span class="kw">head</span>(tidy)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##   country     iso2  iso3   year new   type  sex   age   cases
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
## 1 Afghanistan AF    AFG    1997 new   sp    m     014       0
## 2 Afghanistan AF    AFG    1997 new   sp    m     1524     10
## 3 Afghanistan AF    AFG    1997 new   sp    m     2534      6
## 4 Afghanistan AF    AFG    1997 new   sp    m     3544      3
## 5 Afghanistan AF    AFG    1997 new   sp    m     4554      5
## 6 Afghanistan AF    AFG    1997 new   sp    m     5564      2</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:t8" class="question">
<p class="question-begin">
► Question 8
</p>
<div class="question-body">
<p>Now we should consider whether there are unnecessary columns we can drop. Can you identify columns that are redundant or don’t carry necessary information? What function can we use to drop them?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-8" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-8', 'sol-start-8')"></span>
</p>
<div id="sol-body-8" class="solution-body" style="display: none;">
<p>Exactly, <code>select()</code> can be used to remove columns, we don’t need the column <code>new</code> since that is identical for all observations and we don’t need three columns describing country information.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-wrangling-tidy-data-revisited.html#cb20-1"></a>tidy &lt;-<span class="st"> </span>tidy <span class="op">%&gt;%</span></span>
<span id="cb20-2"><a href="data-wrangling-tidy-data-revisited.html#cb20-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>new, <span class="op">-</span>iso2, <span class="op">-</span>iso3)</span>
<span id="cb20-3"><a href="data-wrangling-tidy-data-revisited.html#cb20-3"></a></span>
<span id="cb20-4"><a href="data-wrangling-tidy-data-revisited.html#cb20-4"></a><span class="kw">head</span>(tidy)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   country      year type  sex   age   cases
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
## 1 Afghanistan  1997 sp    m     014       0
## 2 Afghanistan  1997 sp    m     1524     10
## 3 Afghanistan  1997 sp    m     2534      6
## 4 Afghanistan  1997 sp    m     3544      3
## 5 Afghanistan  1997 sp    m     4554      5
## 6 Afghanistan  1997 sp    m     5564      2</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:t9" class="question">
<p class="question-begin">
► Question 9
</p>
<div class="question-body">
<p>Create a new data frame that contains TB cases for the United States the year 2000 for women.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-9" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-9', 'sol-start-9')"></span>
</p>
<div id="sol-body-9" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-wrangling-tidy-data-revisited.html#cb22-1"></a>tidy <span class="op">%&gt;%</span></span>
<span id="cb22-2"><a href="data-wrangling-tidy-data-revisited.html#cb22-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> "United States of America"</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1990</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2000</span> <span class="op">&amp;</span><span class="st"> </span>sex <span class="op">==</span><span class="st"> "f"</span>) <span class="op">%&gt;%</span></span>
<span id="cb22-3"><a href="data-wrangling-tidy-data-revisited.html#cb22-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   country                   year type  sex   age   cases
##   &lt;chr&gt;                    &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
## 1 United States of America  1995 sp    f     014      26
## 2 United States of America  1995 sp    f     1524    280
## 3 United States of America  1995 sp    f     2534    579
## 4 United States of America  1995 sp    f     3544    499
## 5 United States of America  1995 sp    f     4554    285
## 6 United States of America  1995 sp    f     5564    202</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:t10" class="question">
<p class="question-begin">
► Question 10
</p>
<div class="question-body">
<p>Create a table for easier comparison of cases across age groups by year. What would that table need to look like? What function(s) will you use.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-10" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-10', 'sol-start-10')"></span>
</p>
<div id="sol-body-10" class="solution-body" style="display: none;">
<p>We pivot!</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-wrangling-tidy-data-revisited.html#cb24-1"></a>tidy <span class="op">%&gt;%</span></span>
<span id="cb24-2"><a href="data-wrangling-tidy-data-revisited.html#cb24-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> "United States of America"</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1990</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2000</span> <span class="op">&amp;</span><span class="st"> </span>sex <span class="op">==</span><span class="st"> "f"</span>) <span class="op">%&gt;%</span></span>
<span id="cb24-3"><a href="data-wrangling-tidy-data-revisited.html#cb24-3"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">"age"</span>, <span class="dt">values_from =</span> cases)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   country        year type  sex   `014` `1524` `2534` `3544` `4554` `5564`  `65`
##   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;int&gt;
## 1 United State~  1995 sp    f        26    280    579    499    285    202   591
## 2 United State~  1996 sp    f        21    289    487    478    279    217   541
## 3 United State~  1997 sp    f        28    269    449    447    254    201   514
## 4 United State~  1998 sp    f        15    269    425    424    267    179   492
## 5 United State~  1999 sp    f        16    232    391    394    245    244   444
## 6 United State~  2000 sp    f        14    246    376    349    253    152   396</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>

</div>
</div></body></html>

<p style="text-align: center;">
<a href="project-management-revisited.html"><button class="btn btn-default">Previous</button></a>
</p>
<p class="build-date">Page built: 
2021-09-16
 using 
R version 4.0.2 (2020-06-22)
</p>
</div>
</div>



</body>
</html>
