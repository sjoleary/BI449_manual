<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="23 Predictive modeling for air pollution | Data Science for the Natural Environment (FA21)" />
<meta property="og:type" content="book" />





<meta name="author" content="Shannon J. O’Leary" />

<meta name="date" content="2021-11-17" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="23 Predictive modeling for air pollution | Data Science for the Natural Environment (FA21)">

<title>23 Predictive modeling for air pollution | Data Science for the Natural Environment (FA21)</title>

<script src="libs/header-attrs/header-attrs.js"></script>
<link href="libs/tufte-css/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css/msmb.css" rel="stylesheet" />
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="msmb.css" type="text/css" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script>
function copy_link(id) {
  var dummy = document.createElement('input'),
  text = window.location.href.split(/[?#]/)[0] + '#' + id;
  document.body.appendChild(dummy);
  dummy.value = text;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  
  var tooltip = document.getElementById(id + '-tooltip');
  tooltip.innerHTML = 'Copied!';
}

function reset_tooltip(id) {
  var tooltip = document.getElementById(id);
  tooltip.innerHTML = 'Copy link';
}
</script>

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Data Science for the Natural Environment (FA21)<p><p class="author">Shannon J. O'Leary</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html">Overview</a>
<a href="what-even-is-data-science.html"><span class="toc-section-number">1</span> What even is data science?</a>
<a href="installing-rrstudio.html"><span class="toc-section-number">2</span> Installing R/Rstudio</a>
<a href="project-management-and-rmarkdown-basics.html"><span class="toc-section-number">3</span> Project management and Rmarkdown Basics</a>
<a href="r-functions-objects-vectors---oh-my.html"><span class="toc-section-number">4</span> R: Functions, Objects, Vectors - oh my!</a>
<a href="identifying-essential-fish-habitat-shark-nurseries-on-the-texas-coast.html"><span class="toc-section-number">5</span> Identifying essential fish habitat: Shark Nurseries on the Texas coast</a>
<a href="intro-to-data-frames.html"><span class="toc-section-number">6</span> Intro to data frames</a>
<a href="welcome-to-the-tidyverse.html"><span class="toc-section-number">7</span> Welcome to the tidyverse</a>
<a href="catch-data-analysis.html"><span class="toc-section-number">8</span> Catch data analysis</a>
<a href="scientific-misconduct-and-the-reproducible-crisis.html"><span class="toc-section-number">9</span> Scientific misconduct and the reproducible crisis</a>
<a href="responsible-research-is-reproducible-research.html"><span class="toc-section-number">10</span> Responsible Research is Reproducible Research</a>
<a href="project-management-revisited.html"><span class="toc-section-number">11</span> Project Management Revisited</a>
<a href="data-wrangling-tidy-data-revisited.html"><span class="toc-section-number">12</span> Data Wrangling &amp; Tidy data Revisited</a>
<a href="climate-change.html"><span class="toc-section-number">13</span> Climate Change</a>
<a href="visualization.html"><span class="toc-section-number">14</span> Visualization</a>
<a href="visualizations-as-a-tool-for-misinformation.html"><span class="toc-section-number">15</span> Visualizations as a tool for misinformation</a>
<a href="exploratory-analysis.html"><span class="toc-section-number">16</span> Exploratory Analysis</a>
<a href="making-good-figures.html"><span class="toc-section-number">17</span> Making good figures</a>
<a href="phenology.html"><span class="toc-section-number">18</span> Phenology</a>
<a href="predictive-modeling.html"><span class="toc-section-number">19</span> Predictive Modeling</a>
<a href="remote-sensing.html"><span class="toc-section-number">20</span> Remote Sensing</a>
<a href="simulated-data-for-hypothesis-testing-i.html"><span class="toc-section-number">21</span> Simulated Data for hypothesis testing I</a>
<a href="simulated-data-for-hypothesis-testing-ii.html"><span class="toc-section-number">22</span> Simulated Data for hypothesis testing II</a>
<a id="active-page" href="predictive-modeling-for-air-pollution.html"><span class="toc-section-number">23</span> Predictive modeling for air pollution</a><ul class="toc-sections">
<li class="toc"><a href="#data-for-predictive-modeling"> Data for predictive modeling</a></li>
<li class="toc"><a href="#explore-the-data-set-2"> Explore the data set</a></li>
<li class="toc"><a href="#machine-learning"> Machine learning</a></li>
<li class="toc"><a href="#NA"> Predict air pollution levels using linear regression model.</a></li>
<li class="toc"><a href="#predict-air-pollution-using-random-forest-regression"> Predict air pollution using Random Forest regression</a></li>
<li class="toc"><a href="#model-tuning"> Model Tuning</a></li>
<li class="toc"><a href="#final-model-performance-evaluation"> Final model performance evaluation</a></li>
<li class="toc"><a href="#data-visualization"> Data Visualization</a></li>
<li class="toc"><a href="#acknowledgments-6"> Acknowledgments</a></li>
</ul>
<a href="references.html">References</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<div id="predictive-modeling-for-air-pollution" class="section level1" number="23">
<h1>
<span class="header-section-number">23</span> Predictive modeling for air pollution</h1>
<p><strong>Learning Objectives</strong></p>
<p>After completing this tutorial you should be able to</p>
<ul>
<li>evaluate the correlation among predictor variables using <code>corrplot</code>.</li>
<li>understand the need for training and test data sets and implement <code>tidymodels</code> packages to split data set into training and testing sets
, understand the utility of cross-validation and implment it in the <code>tidymodels</code> framework.</li>
<li>understand the basic utility of machine learning for prediction and classification and use the <code>tidymodels</code> packages to train and test a linear regression model &amp; random forest model.</li>
<li>interpret root mean squared error (rmse) to assess the performance of prediction.</li>
</ul>
<p>Before we start, download the <a href="https://drive.google.com/drive/folders/1-zSiBKS-H8LVeP50_I-gbz6eERrqrFpb?usp=sharing">08_AirPollution</a> project folder. Once you have downloaded it, unzip the project directory into your <code>BI449</code> directory.</p>
<p>Your first step is creating a new R project in your project folder. To do this open <code>Rstudio</code> then use the drop down menu in the top right corner to select <code>New Project</code> and from there <code>New Project in an existing directory</code>. From there, navigate to and select the project folder create an R project. Remember, your <code>Rproj</code> sets the working directory so you need to make sure that it is in your project folder.</p>
<p>Next, open the <code>Rmd</code> file to follow along. Most of the code we will need to day is already in the Rmarkdown file, however, you should make sure that you comment all of the code in this set of activtiies <strong>line by line</strong>. Make sure your comments are informative and concise.</p>
<p>Before we start we need to install a few packages if you have not already done so. Remember, if you have a code chunk with code to install packages it will run every time you knit your document or use the <code>run all chunks</code> options. It is best to either comment out those lines of code, inactivate the code chunk using <code>eval=FALSE</code> or just run them directly in the console.</p>
<p>Here are the packages you need:</p>
<ul>
<li><code>summarytools</code></li>
<li><code>vip</code></li>
<li><code>tune</code></li>
<li><code>randomForest</code></li>
<li><code>doParallel</code></li>
<li><code>GGally</code></li>
<li><code>maps</code></li>
</ul>
<p>Let’s load our packages so we can get started.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="predictive-modeling-for-air-pollution.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries for data import &amp; wrangling</span></span>
<span id="cb496-2"><a href="predictive-modeling-for-air-pollution.html#cb496-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb496-3"><a href="predictive-modeling-for-air-pollution.html#cb496-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb496-4"><a href="predictive-modeling-for-air-pollution.html#cb496-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb496-5"><a href="predictive-modeling-for-air-pollution.html#cb496-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb496-6"><a href="predictive-modeling-for-air-pollution.html#cb496-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-7"><a href="predictive-modeling-for-air-pollution.html#cb496-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-8"><a href="predictive-modeling-for-air-pollution.html#cb496-8" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries for correlation plots</span></span>
<span id="cb496-9"><a href="predictive-modeling-for-air-pollution.html#cb496-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb496-10"><a href="predictive-modeling-for-air-pollution.html#cb496-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb496-11"><a href="predictive-modeling-for-air-pollution.html#cb496-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-12"><a href="predictive-modeling-for-air-pollution.html#cb496-12" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries for modeling &amp; machine learning</span></span>
<span id="cb496-13"><a href="predictive-modeling-for-air-pollution.html#cb496-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb496-14"><a href="predictive-modeling-for-air-pollution.html#cb496-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb496-15"><a href="predictive-modeling-for-air-pollution.html#cb496-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb496-16"><a href="predictive-modeling-for-air-pollution.html#cb496-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb496-17"><a href="predictive-modeling-for-air-pollution.html#cb496-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-18"><a href="predictive-modeling-for-air-pollution.html#cb496-18" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries for data visualization &amp; mapping</span></span>
<span id="cb496-19"><a href="predictive-modeling-for-air-pollution.html#cb496-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb496-20"><a href="predictive-modeling-for-air-pollution.html#cb496-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb496-21"><a href="predictive-modeling-for-air-pollution.html#cb496-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb496-22"><a href="predictive-modeling-for-air-pollution.html#cb496-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb496-23"><a href="predictive-modeling-for-air-pollution.html#cb496-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb496-24"><a href="predictive-modeling-for-air-pollution.html#cb496-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-25"><a href="predictive-modeling-for-air-pollution.html#cb496-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb496-26"><a href="predictive-modeling-for-air-pollution.html#cb496-26" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"mutate"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb496-27"><a href="predictive-modeling-for-air-pollution.html#cb496-27" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"map"</span>, <span class="st">"maps"</span>)</span>
<span id="cb496-28"><a href="predictive-modeling-for-air-pollution.html#cb496-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-29"><a href="predictive-modeling-for-air-pollution.html#cb496-29" aria-hidden="true" tabindex="-1"></a><span class="co"># turn of sci notation</span></span>
<span id="cb496-30"><a href="predictive-modeling-for-air-pollution.html#cb496-30" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span></code></pre></div>
<div id="data-for-predictive-modeling" class="section level2" number="23.1">
<h2>
<span class="header-section-number">23.1</span> Data for predictive modeling<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('data-for-predictive-modeling')" onmouseout="reset_tooltip('data-for-predictive-modeling-tooltip')"><span class="tooltiptext" id="data-for-predictive-modeling-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>We will use air pollution data gathered using air pollution monitoring. In this system of monitors about 90% are located with in city leading to rural areas being severely under-monitored. Let’s take a little bit of time to think about the limitations of our approach and what type of data we will need to answer our question.</p>
<p>Our goal is to use this data set to train model that can accurately predict air pollution levels even when physical monitors are not present. A primary interest in air pollution is due to the adverse health outcomes related to exposure.</p>
<p>Before we start we should consider limitations of the data set we will look at to make sure that we can answer our question and to make sure that we don’t overstep in our interpretation.</p>
<div id="ques:air-poll-1" class="question">
<p class="question-begin">
► Question 23.1
</p>
<div class="question-body">
<p>Consider limitations of the data that you should keep in mind when interpreting and discussing your results.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-58" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-58', 'sol-start-58')"></span>
</p>
<div id="sol-body-58" class="solution-body" style="display: none;">
<ol style="list-style-type: decimal">
<li>What limitations come with the fact that air pollutants are measured as “Particulate Matter?”</li>
<li>We are measuring (average) outdoor pollution levels; how does this related to making predictions about individual exposures?</li>
<li>We are using mean estimates of pollution levels.</li>
</ol>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>We will be using supervised machine learning to predict pollution levels. Here, we have two main types of data:</p>
<ol style="list-style-type: decimal">
<li>A <strong>continuous outcome variable</strong> - this is the variable we want to predict</li>
<li>A <strong>set of features</strong> or predictor variables used to predict the outcome variable.</li>
</ol>
<p>In order to build and train a model you need corresponding data sets<label for="tufte-sn-139" class="margin-toggle sidenote-number">139</label><input type="checkbox" id="tufte-sn-139" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">139</span> Corresponding means they should have the same/very similar spatial and temporal resolution.</span>. The underlying principle is that if you determine the existing relationship and describe it mathematically using an existing data set, then you would also be able predict the value for that outcome variable for a new observation as long as you have values for the predictor variable.</p>
<div id="ques:air-poll-2" class="question">
<p class="question-begin">
► Question 23.2
</p>
<div class="question-body">
<p>For our example of creating a model with the goal of predicting pollution levels, what would be our <strong>outcome variable</strong> and what are potential <strong>features</strong> (or predictor variables)?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-59" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-59', 'sol-start-59')"></span>
</p>
<div id="sol-body-59" class="solution-body" style="display: none;">
<p>Consider what we want to predict (what is the outcome of the model? what quantity do we hope to get as a result?
Consider which parameters might contribute to air pollution levels (i.e. factors that might be causing it to go up or down/are correlated).</p>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>With the rise of computational power available at our fingertips, Machine Learning and Artificial Intelligence approaches are increasingly being used to solve problems, especially when large data sets are involved. Unfortunately, this means it quickly turns into a black box where we dump in some outcome and predictor variables give it a good shake and take the “answer” we receive at face value.</p>
<p>To avoid this we need to start with a specific question in mind and carefully consider how our outcome and features are related. Good questions have a plausible explanation for why features predict the outcome and critically evaluate potential for variation in both the features and outcome over time.</p>
<p>We will be using a data set that was previously compiled by a <a href="http://www.biostat.jhsph.edu/~rpeng/">researcher</a> who studies air pollution, climate change and public health. We will import</p>
<p>The monitoring data comes from gravimetric monitors operated by the EPA that are designed to capture fine particulate matter (PM2.5) using a filtration system. Values are measure either daily or weekly. Our feature data set contains values for each of the 876 monitors (observations) and has been compiled from the EPA, NASA, US Census and National Center for Health Statistics. Most of the features have been taken for a circular area that surround the monitor itself (buffer).</p>
<p>For this module we will ask the central question <strong>Can we predict annual average air pollution concentrations at the resolution of zip code regional levels using predictor variables describing population density, urbanization, road density, satellite pollution data, and chemical modeling data?</strong></p>
</div>
<div id="explore-the-data-set-2" class="section level2" number="23.2">
<h2>
<span class="header-section-number">23.2</span> Explore the data set<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('explore-the-data-set-2')" onmouseout="reset_tooltip('explore-the-data-set-2-tooltip')"><span class="tooltiptext" id="explore-the-data-set-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>Let’s import the data set.</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="predictive-modeling-for-air-pollution.html#cb497-1" aria-hidden="true" tabindex="-1"></a>pm <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/air_pollution.csv"</span>, <span class="at">delim =</span> <span class="st">","</span>) <span class="sc">%&gt;%</span></span>
<span id="cb497-2"><a href="predictive-modeling-for-air-pollution.html#cb497-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span></code></pre></div>
<p>Let’s take a quick look at the data types to make sure everything read in correctly.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="predictive-modeling-for-air-pollution.html#cb498-1" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">%&gt;%</span></span>
<span id="cb498-2"><a href="predictive-modeling-for-air-pollution.html#cb498-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 876
## Columns: 50
## $ id                          &lt;dbl&gt; 1003.001, 1027.000, 1033.100, 1049.100, 1055.001, 1069.000, 1073.002, 1073.101, 1073.101, 1073.101, 1073.200,~
## $ value                       &lt;dbl&gt; 9.597647, 10.800000, 11.212174, 11.659091, 12.375394, 10.508850, 15.591017, 12.399355, 11.103704, 13.114545, ~
## $ fips                        &lt;dbl&gt; 1003, 1027, 1033, 1049, 1055, 1069, 1073, 1073, 1073, 1073, 1073, 1073, 1073, 1073, 1089, 1097, 1097, 1101, 1~
## $ lat                         &lt;dbl&gt; 30.49800, 33.28126, 34.75878, 34.28763, 33.99375, 31.22636, 33.55306, 33.33111, 33.45972, 33.54528, 33.49972,~
## $ lon                         &lt;dbl&gt; -87.88141, -85.80218, -87.65056, -85.96830, -85.99107, -85.39077, -86.81500, -87.00361, -87.30556, -86.54917,~
## $ state                       &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama",~
## $ county                      &lt;chr&gt; "Baldwin", "Clay", "Colbert", "DeKalb", "Etowah", "Houston", "Jefferson", "Jefferson", "Jefferson", "Jefferso~
## $ city                        &lt;chr&gt; "Fairhope", "Ashland", "Muscle Shoals", "Crossville", "Gadsden", "Dothan", "Birmingham", "Not in a city", "No~
## $ cmaq                        &lt;dbl&gt; 8.098836, 9.766208, 9.402679, 8.534772, 9.241744, 9.121892, 10.235612, 10.235612, 8.161789, 9.303766, 10.2356~
## $ zcta                        &lt;dbl&gt; 36532, 36251, 35660, 35962, 35901, 36303, 35207, 35111, 35444, 35094, 35064, 35244, 35126, 35180, 35802, 3661~
## $ zcta_area                   &lt;dbl&gt; 190980522, 374132430, 16716984, 203836235, 154069359, 162685124, 26929603, 166239542, 385566685, 148994881, 1~
## $ zcta_pop                    &lt;dbl&gt; 27829, 5103, 9042, 8300, 20045, 30217, 9010, 16140, 3699, 14212, 11458, 32390, 21725, 13794, 21297, 6106, 246~
## $ imp_a500                    &lt;dbl&gt; 0.01730104, 1.96972318, 19.17301038, 5.78200692, 16.49307958, 19.13927336, 41.83304498, 1.69765343, 0.0000000~
## $ imp_a1000                   &lt;dbl&gt; 1.40960208, 0.85315744, 11.14489619, 3.86764706, 11.09645329, 16.67149654, 41.03200692, 3.98239278, 0.0291955~
## $ imp_a5000                   &lt;dbl&gt; 3.33601181, 0.98514787, 15.17861538, 1.23114143, 14.67778782, 16.38548211, 36.00406256, 6.02132173, 0.1398356~
## $ imp_a10000                  &lt;dbl&gt; 1.9879187, 0.5208189, 9.7253870, 1.0316469, 8.2200785, 8.0739624, 23.1790413, 4.5567731, 0.1474968, 2.6970796~
## $ imp_a15000                  &lt;dbl&gt; 1.4386207, 0.3359198, 5.2472094, 0.9730444, 5.1612102, 4.7401296, 17.4524844, 4.3006226, 0.1623359, 2.9956557~
## $ county_area                 &lt;dbl&gt; 4117521611, 1564252280, 1534877333, 2012662359, 1385618994, 1501737720, 2878192209, 2878192209, 3423328940, 2~
## $ county_pop                  &lt;dbl&gt; 182265, 13932, 54428, 71109, 104430, 101547, 658466, 658466, 194656, 658466, 658466, 658466, 658466, 658466, ~
## $ log_dist_to_prisec          &lt;dbl&gt; 4.648181, 7.219907, 5.760131, 3.721489, 5.261457, 7.112373, 6.600958, 6.526896, 9.789557, 7.301545, 3.972137,~
## $ log_pri_length_5000         &lt;dbl&gt; 8.517193, 8.517193, 8.517193, 8.517193, 9.066563, 8.517193, 11.156977, 10.915066, 8.517193, 9.683336, 10.7323~
## $ log_pri_length_10000        &lt;dbl&gt; 9.210340, 9.210340, 9.274303, 10.409411, 11.137360, 9.210340, 11.849658, 11.728685, 9.210340, 10.763385, 11.6~
## $ log_pri_length_15000        &lt;dbl&gt; 9.630228, 9.615805, 9.658899, 11.173626, 11.587258, 9.615805, 12.401245, 12.230208, 9.615805, 11.615710, 12.1~
## $ log_pri_length_25000        &lt;dbl&gt; 11.32735, 10.12663, 10.15769, 11.90959, 12.01356, 10.12663, 12.98762, 12.86472, 10.12663, 12.53777, 12.97635,~
## $ log_prisec_length_500       &lt;dbl&gt; 7.295356, 6.214608, 8.611945, 7.310155, 8.740680, 6.214608, 6.214608, 6.214608, 6.214608, 6.214608, 8.385759,~
## $ log_prisec_length_1000      &lt;dbl&gt; 8.195119, 7.600902, 9.735569, 8.585843, 9.627898, 7.600902, 9.075921, 8.949239, 7.600902, 7.600902, 9.204951,~
## $ log_prisec_length_5000      &lt;dbl&gt; 10.815042, 10.170878, 11.770407, 10.214200, 11.728889, 12.298627, 12.281645, 11.039001, 8.517193, 11.262645, ~
## $ log_prisec_length_10000     &lt;dbl&gt; 11.886803, 11.405543, 12.840663, 11.508944, 12.768279, 12.994141, 13.278416, 12.128956, 9.210340, 12.141008, ~
## $ log_prisec_length_15000     &lt;dbl&gt; 12.205723, 12.042963, 13.282656, 12.353663, 13.189489, 13.326132, 13.826365, 12.753045, 9.615805, 12.851710, ~
## $ log_prisec_length_25000     &lt;dbl&gt; 13.41395, 12.79980, 13.79973, 13.55979, 13.70026, 13.85550, 14.45221, 13.80017, 11.89377, 14.08915, 14.32725,~
## $ log_nei_2008_pm25_sum_10000 &lt;dbl&gt; 0.318035438, 3.218632928, 6.573127301, 0.000000000, 3.772775514, 0.909136688, 7.987614168, 5.412954990, 0.002~
## $ log_nei_2008_pm25_sum_15000 &lt;dbl&gt; 1.967358961, 3.218632928, 6.581917457, 3.282789151, 3.785646441, 3.174609213, 8.438952213, 6.643477321, 0.002~
## $ log_nei_2008_pm25_sum_25000 &lt;dbl&gt; 5.0673081, 3.2186329, 6.8758996, 4.8876655, 4.1605064, 3.1900077, 8.6510684, 7.8067729, 6.3623285, 7.3020666,~
## $ log_nei_2008_pm10_sum_10000 &lt;dbl&gt; 1.35588511, 3.31111648, 6.69187313, 0.00000000, 4.43719884, 0.92888890, 8.20975958, 5.77118113, 0.01654963, 6~
## $ log_nei_2008_pm10_sum_15000 &lt;dbl&gt; 2.26783411, 3.31111648, 6.70127741, 3.35004443, 4.46267932, 3.67473904, 8.64883455, 6.86889676, 0.01654963, 6~
## $ log_nei_2008_pm10_sum_25000 &lt;dbl&gt; 5.6287284, 3.3111165, 7.1488584, 5.1719202, 4.6783110, 3.7446287, 8.8580191, 8.0210715, 6.8919916, 7.5490587,~
## $ popdens_county              &lt;dbl&gt; 44.265706, 8.906492, 35.460814, 35.330814, 75.367038, 67.619664, 228.777633, 228.777633, 56.861611, 228.77763~
## $ popdens_zcta                &lt;dbl&gt; 145.7164307, 13.6395554, 540.8870404, 40.7189625, 130.1037411, 185.7391706, 334.5760426, 97.0888142, 9.593671~
## $ nohs                        &lt;dbl&gt; 3.300, 11.600, 7.300, 14.300, 4.300, 5.800, 7.100, 2.700, 11.100, 7.200, 2.700, 0.800, 2.800, 9.700, 1.200, 3~
## $ somehs                      &lt;dbl&gt; 4.900, 19.100, 15.800, 16.700, 13.300, 11.600, 17.100, 6.600, 11.600, 12.200, 9.800, 2.600, 8.200, 21.600, 3.~
## $ hs                          &lt;dbl&gt; 25.10, 33.90, 30.60, 35.00, 27.80, 29.80, 37.20, 30.70, 46.00, 32.20, 28.80, 12.90, 32.00, 39.30, 15.10, 39.0~
## $ somecollege                 &lt;dbl&gt; 19.700, 18.800, 20.900, 14.900, 29.200, 21.400, 23.500, 25.700, 17.200, 19.000, 26.300, 17.900, 28.900, 21.60~
## $ associate                   &lt;dbl&gt; 8.20, 8.00, 7.60, 5.50, 10.10, 7.90, 7.30, 8.00, 4.10, 6.80, 12.40, 5.20, 7.40, 5.20, 6.50, 6.60, 8.30, 4.60,~
## $ bachelor                    &lt;dbl&gt; 25.3, 5.5, 12.7, 7.9, 10.0, 13.7, 5.9, 17.6, 7.1, 14.8, 11.6, 35.5, 13.5, 2.2, 30.4, 7.8, 8.3, 7.6, 18.2, 9.5~
## $ grad                        &lt;dbl&gt; 13.500, 3.100, 5.100, 5.800, 5.400, 9.800, 2.000, 8.700, 2.900, 7.700, 8.300, 25.200, 7.100, 0.400, 23.300, 4~
## $ pov                         &lt;dbl&gt; 6.100, 19.500, 19.000, 13.800, 8.800, 15.600, 25.500, 7.300, 8.100, 10.500, 18.100, 2.100, 5.100, 13.300, 5.2~
## $ hs_orless                   &lt;dbl&gt; 33.30, 64.60, 53.70, 66.00, 45.40, 47.20, 61.40, 40.00, 68.70, 51.60, 41.30, 16.30, 43.00, 70.60, 19.40, 59.1~
## $ urc2013                     &lt;dbl&gt; 4, 6, 4, 6, 4, 4, 1, 1, 1, 1, 1, 1, 1, 2, 3, 3, 3, 3, 4, 3, 1, 5, 4, 2, 6, 4, 4, 1, 1, 1, 1, 1, 4, 3, 3, 2, 2~
## $ urc2006                     &lt;dbl&gt; 5, 6, 4, 5, 4, 4, 1, 1, 1, 1, 1, 1, 1, 2, 3, 3, 3, 3, 4, 3, 1, 5, 4, 2, 6, 5, 4, 1, 1, 1, 1, 1, 5, 3, 3, 2, 2~
## $ aod                         &lt;dbl&gt; 37.363636, 34.818182, 36.000000, 33.083333, 43.416667, 33.000000, 39.583333, 38.750000, 40.363636, 42.454545,~</code></pre>
<div id="ques:air-poll-3" class="question">
<p class="question-begin">
► Question 23.3
</p>
<div class="question-body">
<p>How many monitors do we have in the data set? Which column contains our outcome variable? Which contains our predictor variables?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-60" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-60', 'sol-start-60')"></span>
</p>
<div id="sol-body-60" class="solution-body" style="display: none;">
<ul>
<li>The column <code>value</code> contains PM2.5 concentrations in mass concentration (ug/m3) - this is our outcome variable.</li>
<li>The column <code>id</code> codes for the monitors.</li>
<li>The remaining columns give us some additional information on the location where the monitor is located - we will have to assess which of those could be good predictor variables.</li>
</ul>
<p>Here are the specifics for each column:</p>
<table>
<colgroup>
<col width="43%">
<col width="56%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th>Details</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>id</strong></td>
<td>Monitor number <br> – the county number is indicated before the decimal <br> – the monitor number is indicated after the decimal <br><strong>Example</strong>: 1073.0023 is Jefferson county (1073) and .0023 one of 8 monitors</td>
</tr>
<tr class="even">
<td><strong>fips</strong></td>
<td>Federal information processing standard number for the county where the monitor is located <br> – 5 digit id code for counties (zero is often the first value and sometimes is not shown) <br> – the first 2 numbers indicate the state <br> – the last three numbers indicate the county <br><strong>Example</strong>: Alabama’s state code is 01 because it is first alphabetically <br> (note: Alaska and Hawaii are not included because they are not part of the contiguous US)</td>
</tr>
<tr class="odd">
<td><strong>Lat</strong></td>
<td>Latitude of the monitor in degrees</td>
</tr>
<tr class="even">
<td><strong>Lon</strong></td>
<td>Longitude of the monitor in degrees</td>
</tr>
<tr class="odd">
<td><strong>state</strong></td>
<td>State where the monitor is located</td>
</tr>
<tr class="even">
<td><strong>county</strong></td>
<td>County where the monitor is located</td>
</tr>
<tr class="odd">
<td><strong>city</strong></td>
<td>City where the monitor is located</td>
</tr>
<tr class="even">
<td><strong>CMAQ</strong></td>
<td>Estimated values of air pollution from a computational model called <a href="https://www.epa.gov/cmaq" target="_blank"><strong>Community Multiscale Air Quality (CMAQ)</strong></a> <br> – A monitoring system that simulates the physics of the atmosphere using chemistry and weather data to predict the air pollution <br> – <strong><em>Does not use any of the PM<sub>2.5</sub> gravimetric monitoring data.</em></strong> (There is a version that does use the gravimetric monitoring data, but not this one!) <br> – Data from the EPA</td>
</tr>
<tr class="odd">
<td><strong>zcta</strong></td>
<td>
<a href="https://www2.census.gov/geo/pdfs/education/brochures/ZCTAs.pdf" target="_blank">Zip Code Tabulation Area</a> where the monitor is located <br> – Postal Zip codes are converted into “generalized areal representations” that are non-overlapping <br> – Data from the 2010 Census</td>
</tr>
<tr class="even">
<td><strong>zcta_area</strong></td>
<td>Land area of the zip code area in meters squared <br> – Data from the 2010 Census</td>
</tr>
<tr class="odd">
<td><strong>zcta_pop</strong></td>
<td>Population in the zip code area <br> – Data from the 2010 Census</td>
</tr>
<tr class="even">
<td><strong>imp_a500</strong></td>
<td>Impervious surface measure <br> – Within a circle with a radius of 500 meters around the monitor <br> – Impervious surface are roads, concrete, parking lots, buildings <br> – This is a measure of development</td>
</tr>
<tr class="odd">
<td><strong>imp_a1000</strong></td>
<td>Impervious surface measure <br> – Within a circle with a radius of 1000 meters around the monitor</td>
</tr>
<tr class="even">
<td><strong>imp_a5000</strong></td>
<td>Impervious surface measure <br> – Within a circle with a radius of 5000 meters around the monitor</td>
</tr>
<tr class="odd">
<td><strong>imp_a10000</strong></td>
<td>Impervious surface measure <br> – Within a circle with a radius of 10000 meters around the monitor</td>
</tr>
<tr class="even">
<td><strong>imp_a15000</strong></td>
<td>Impervious surface measure <br> – Within a circle with a radius of 15000 meters around the monitor</td>
</tr>
<tr class="odd">
<td><strong>county_area</strong></td>
<td>Land area of the county of the monitor in meters squared</td>
</tr>
<tr class="even">
<td><strong>county_pop</strong></td>
<td>Population of the county of the monitor</td>
</tr>
<tr class="odd">
<td><strong>Log_dist_to_prisec</strong></td>
<td>Log (Natural log) distance to a primary or secondary road from the monitor <br> – Highway or major road</td>
</tr>
<tr class="even">
<td><strong>log_pri_length_5000</strong></td>
<td>Count of primary road length in meters in a circle with a radius of 5000 meters around the monitor (Natural log) <br> – Highways only</td>
</tr>
<tr class="odd">
<td><strong>log_pri_length_10000</strong></td>
<td>Count of primary road length in meters in a circle with a radius of 10000 meters around the monitor (Natural log) <br> – Highways only</td>
</tr>
<tr class="even">
<td><strong>log_pri_length_15000</strong></td>
<td>Count of primary road length in meters in a circle with a radius of 15000 meters around the monitor (Natural log) <br> – Highways only</td>
</tr>
<tr class="odd">
<td><strong>log_pri_length_25000</strong></td>
<td>Count of primary road length in meters in a circle with a radius of 25000 meters around the monitor (Natural log) <br> – Highways only</td>
</tr>
<tr class="even">
<td><strong>log_prisec_length_500</strong></td>
<td>Count of primary and secondary road length in meters in a circle with a radius of 500 meters around the monitor (Natural log) <br> – Highway and secondary roads</td>
</tr>
<tr class="odd">
<td><strong>log_prisec_length_1000</strong></td>
<td>Count of primary and secondary road length in meters in a circle with a radius of 1000 meters around the monitor (Natural log) <br> – Highway and secondary roads</td>
</tr>
<tr class="even">
<td><strong>log_prisec_length_5000</strong></td>
<td>Count of primary and secondary road length in meters in a circle with a radius of 5000 meters around the monitor (Natural log) <br> – Highway and secondary roads</td>
</tr>
<tr class="odd">
<td><strong>log_prisec_length_10000</strong></td>
<td>Count of primary and secondary road length in meters in a circle with a radius of 10000 meters around the monitor (Natural log) <br> – Highway and secondary roads</td>
</tr>
<tr class="even">
<td><strong>log_prisec_length_15000</strong></td>
<td>Count of primary and secondary road length in meters in a circle with a radius of 15000 meters around the monitor (Natural log) <br> – Highway and secondary roads</td>
</tr>
<tr class="odd">
<td><strong>log_prisec_length_25000</strong></td>
<td>Count of primary and secondary road length in meters in a circle with a radius of 25000 meters around the monitor (Natural log) <br> – Highway and secondary roads</td>
</tr>
<tr class="even">
<td><strong>log_nei_2008_pm25_sum_10000</strong></td>
<td>Tons of emissions from major sources data base (annual data) sum of all sources within a circle with a radius of 10000 meters of distance around the monitor (Natural log)</td>
</tr>
<tr class="odd">
<td><strong>log_nei_2008_pm25_sum_15000</strong></td>
<td>Tons of emissions from major sources data base (annual data) sum of all sources within a circle with a radius of 15000 meters of distance around the monitor (Natural log)</td>
</tr>
<tr class="even">
<td><strong>log_nei_2008_pm25_sum_25000</strong></td>
<td>Tons of emissions from major sources data base (annual data) sum of all sources within a circle with a radius of 25000 meters of distance around the monitor (Natural log)</td>
</tr>
<tr class="odd">
<td><strong>log_nei_2008_pm10_sum_10000</strong></td>
<td>Tons of emissions from major sources data base (annual data) sum of all sources within a circle with a radius of 10000 meters of distance around the monitor (Natural log)</td>
</tr>
<tr class="even">
<td><strong>log_nei_2008_pm10_sum_15000</strong></td>
<td>Tons of emissions from major sources data base (annual data) sum of all sources within a circle with a radius of 15000 meters of distance around the monitor (Natural log)</td>
</tr>
<tr class="odd">
<td><strong>log_nei_2008_pm10_sum_25000</strong></td>
<td>Tons of emissions from major sources data base (annual data) sum of all sources within a circle with a radius of 25000 meters of distance around the monitor (Natural log)</td>
</tr>
<tr class="even">
<td><strong>popdens_county</strong></td>
<td>Population density (number of people per kilometer squared area of the county)</td>
</tr>
<tr class="odd">
<td><strong>popdens_zcta</strong></td>
<td>Population density (number of people per kilometer squared area of zcta)</td>
</tr>
<tr class="even">
<td><strong>nohs</strong></td>
<td>Percentage of people in zcta area where the monitor is that <strong>do not have a high school degree</strong> <br> – Data from the Census</td>
</tr>
<tr class="odd">
<td><strong>somehs</strong></td>
<td>Percentage of people in zcta area where the monitor whose highest formal educational attainment was <strong>some high school education</strong> <br> – Data from the Census</td>
</tr>
<tr class="even">
<td><strong>hs</strong></td>
<td>Percentage of people in zcta area where the monitor whose highest formal educational attainment was completing a <strong>high school degree</strong> <br> – Data from the Census</td>
</tr>
<tr class="odd">
<td><strong>somecollege</strong></td>
<td>Percentage of people in zcta area where the monitor whose highest formal educational attainment was completing <strong>some college education</strong> <br> – Data from the Census</td>
</tr>
<tr class="even">
<td><strong>associate</strong></td>
<td>Percentage of people in zcta area where the monitor whose highest formal educational attainment was completing an <strong>associate degree</strong> <br> – Data from the Census</td>
</tr>
<tr class="odd">
<td><strong>bachelor</strong></td>
<td>Percentage of people in zcta area where the monitor whose highest formal educational attainment was a <strong>bachelor’s degree</strong> <br> – Data from the Census</td>
</tr>
<tr class="even">
<td><strong>grad</strong></td>
<td>Percentage of people in zcta area where the monitor whose highest formal educational attainment was a <strong>graduate degree</strong> <br> – Data from the Census</td>
</tr>
<tr class="odd">
<td><strong>pov</strong></td>
<td>Percentage of people in zcta area where the monitor is that lived in <a href="https://aspe.hhs.gov/2008-hhs-poverty-guidelines"><strong>poverty</strong></a> in 2008 - or would it have been 2007 guidelines??<a href="https://aspe.hhs.gov/2007-hhs-poverty-guidelines" class="uri">https://aspe.hhs.gov/2007-hhs-poverty-guidelines</a> <br> – Data from the Census</td>
</tr>
<tr class="even">
<td><strong>hs_orless</strong></td>
<td>Percentage of people in zcta area where the monitor whose highest formal educational attainment was a <strong>high school degree or less</strong> (sum of nohs, somehs, and hs)</td>
</tr>
<tr class="odd">
<td><strong>urc2013</strong></td>
<td>
<a href="https://www.cdc.gov/nchs/data/series/sr_02/sr02_166.pdf" target="_blank">2013 Urban-rural classification</a> of the county where the monitor is located <br> – 6 category variable - 1 is totally urban 6 is completely rural <br> – Data from the <a href="https://www.cdc.gov/nchs/index.htm" target="_blank">National Center for Health Statistics</a>
</td>
</tr>
<tr class="even">
<td><strong>urc2006</strong></td>
<td>
<a href="https://www.cdc.gov/nchs/data/series/sr_02/sr02_154.pdf" target="_blank">2006 Urban-rural classification</a> of the county where the monitor is located <br> – 6 category variable - 1 is totally urban 6 is completely rural <br> – Data from the <a href="https://www.cdc.gov/nchs/index.htm" target="_blank">National Center for Health Statistics</a>
</td>
</tr>
<tr class="odd">
<td><strong>aod</strong></td>
<td>Aerosol Optical Depth measurement from a NASA satellite <br> – based on the diffraction of a laser <br> – used as a proxy of particulate pollution <br> – unit-less - higher value indicates more pollution <br> – Data from NASA</td>
</tr>
</tbody>
</table>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:air-poll-4" class="question">
<p class="question-begin">
► Question 23.4
</p>
<div class="question-body">
<p>Take a look at the columns <code>id</code>, <code>fips</code>, and <code>zcta</code> - what data type are they? What information do you think they hold? Does the type of data they hold match their assigned data type?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-61" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-61', 'sol-start-61')"></span>
</p>
<div id="sol-body-61" class="solution-body" style="display: none;">
<p>These are all currently numerical variables and R thinks they are continuous variables. However <code>id</code> is the monitor ID, <code>fips</code> is the federal information processing standard number fo the country where it is located, and <code>zcta</code> is the zip code tabulation area. These should all be categorical variables.</p>
<p>We will convert them to characters.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="predictive-modeling-for-air-pollution.html#cb500-1" aria-hidden="true" tabindex="-1"></a>pm <span class="ot">&lt;-</span> pm <span class="sc">%&gt;%</span></span>
<span id="cb500-2"><a href="predictive-modeling-for-air-pollution.html#cb500-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(id, fips, zcta), as.factor))</span></code></pre></div>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Let’s dig a little bit deeper using <code>skim()</code>.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="predictive-modeling-for-air-pollution.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(pm)</span></code></pre></div>
<p><!--
<caption>--><span class="marginnote shownote"><span id="tab:unnamed-chunk-428">Table 23.1: </span>Data summary</span><!--</caption>--></p>
<table><tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">pm</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">876</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">50</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">44</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody></table>
<p><strong>Variable type: character</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">state</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">20</td>
<td align="right">0</td>
<td align="right">49</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">county</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="right">0</td>
<td align="right">471</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">city</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">48</td>
<td align="right">0</td>
<td align="right">607</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">876</td>
<td align="left">100: 1, 102: 1, 103: 1, 104: 1</td>
</tr>
<tr class="even">
<td align="left">fips</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">569</td>
<td align="left">170: 12, 603: 10, 261: 9, 107: 8</td>
</tr>
<tr class="odd">
<td align="left">zcta</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">842</td>
<td align="left">475: 3, 110: 2, 160: 2, 290: 2</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<colgroup>
<col width="14%">
<col width="5%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">value</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10.81</td>
<td align="right">2.58</td>
<td align="right">3.02</td>
<td align="right">9.27</td>
<td align="right">11.15</td>
<td align="right">12.37</td>
<td align="right">23.16</td>
<td align="left">▂▆▇▁▁</td>
</tr>
<tr class="even">
<td align="left">lat</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">38.48</td>
<td align="right">4.62</td>
<td align="right">25.47</td>
<td align="right">35.03</td>
<td align="right">39.30</td>
<td align="right">41.66</td>
<td align="right">48.40</td>
<td align="left">▁▃▅▇▂</td>
</tr>
<tr class="odd">
<td align="left">lon</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">-91.74</td>
<td align="right">14.96</td>
<td align="right">-124.18</td>
<td align="right">-99.16</td>
<td align="right">-87.47</td>
<td align="right">-80.69</td>
<td align="right">-68.04</td>
<td align="left">▃▂▃▇▃</td>
</tr>
<tr class="even">
<td align="left">cmaq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.41</td>
<td align="right">2.97</td>
<td align="right">1.63</td>
<td align="right">6.53</td>
<td align="right">8.62</td>
<td align="right">10.24</td>
<td align="right">23.13</td>
<td align="left">▃▇▃▁▁</td>
</tr>
<tr class="odd">
<td align="left">zcta_area</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">183173481.91</td>
<td align="right">542598878.48</td>
<td align="right">15459.00</td>
<td align="right">14204601.75</td>
<td align="right">37653560.50</td>
<td align="right">160041508.25</td>
<td align="right">8164820625.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">zcta_pop</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">24227.58</td>
<td align="right">17772.16</td>
<td align="right">0.00</td>
<td align="right">9797.00</td>
<td align="right">22014.00</td>
<td align="right">35004.75</td>
<td align="right">95397.00</td>
<td align="left">▇▇▃▁▁</td>
</tr>
<tr class="odd">
<td align="left">imp_a500</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">24.72</td>
<td align="right">19.34</td>
<td align="right">0.00</td>
<td align="right">3.70</td>
<td align="right">25.12</td>
<td align="right">40.22</td>
<td align="right">69.61</td>
<td align="left">▇▅▆▃▂</td>
</tr>
<tr class="even">
<td align="left">imp_a1000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">24.26</td>
<td align="right">18.02</td>
<td align="right">0.00</td>
<td align="right">5.32</td>
<td align="right">24.53</td>
<td align="right">38.59</td>
<td align="right">67.50</td>
<td align="left">▇▅▆▃▁</td>
</tr>
<tr class="odd">
<td align="left">imp_a5000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">19.93</td>
<td align="right">14.72</td>
<td align="right">0.05</td>
<td align="right">6.79</td>
<td align="right">19.07</td>
<td align="right">30.11</td>
<td align="right">74.60</td>
<td align="left">▇▆▃▁▁</td>
</tr>
<tr class="even">
<td align="left">imp_a10000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">15.82</td>
<td align="right">13.81</td>
<td align="right">0.09</td>
<td align="right">4.54</td>
<td align="right">12.36</td>
<td align="right">24.17</td>
<td align="right">72.09</td>
<td align="left">▇▃▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">imp_a15000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">13.43</td>
<td align="right">13.12</td>
<td align="right">0.11</td>
<td align="right">3.24</td>
<td align="right">9.67</td>
<td align="right">20.55</td>
<td align="right">71.10</td>
<td align="left">▇▃▁▁▁</td>
</tr>
<tr class="even">
<td align="left">county_area</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3768701992.12</td>
<td align="right">6212829553.56</td>
<td align="right">33703512.00</td>
<td align="right">1116536297.50</td>
<td align="right">1690826566.50</td>
<td align="right">2878192209.00</td>
<td align="right">51947229509.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">county_pop</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">687298.44</td>
<td align="right">1293488.74</td>
<td align="right">783.00</td>
<td align="right">100948.00</td>
<td align="right">280730.50</td>
<td align="right">743159.00</td>
<td align="right">9818605.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">log_dist_to_prisec</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6.19</td>
<td align="right">1.41</td>
<td align="right">-1.46</td>
<td align="right">5.43</td>
<td align="right">6.36</td>
<td align="right">7.15</td>
<td align="right">10.45</td>
<td align="left">▁▁▃▇▁</td>
</tr>
<tr class="odd">
<td align="left">log_pri_length_5000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">9.82</td>
<td align="right">1.08</td>
<td align="right">8.52</td>
<td align="right">8.52</td>
<td align="right">10.05</td>
<td align="right">10.73</td>
<td align="right">12.05</td>
<td align="left">▇▂▆▅▂</td>
</tr>
<tr class="even">
<td align="left">log_pri_length_10000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10.92</td>
<td align="right">1.13</td>
<td align="right">9.21</td>
<td align="right">9.80</td>
<td align="right">11.17</td>
<td align="right">11.83</td>
<td align="right">13.02</td>
<td align="left">▇▂▇▇▃</td>
</tr>
<tr class="odd">
<td align="left">log_pri_length_15000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">11.50</td>
<td align="right">1.15</td>
<td align="right">9.62</td>
<td align="right">10.87</td>
<td align="right">11.72</td>
<td align="right">12.40</td>
<td align="right">13.59</td>
<td align="left">▆▂▇▇▃</td>
</tr>
<tr class="even">
<td align="left">log_pri_length_25000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">12.24</td>
<td align="right">1.10</td>
<td align="right">10.13</td>
<td align="right">11.69</td>
<td align="right">12.46</td>
<td align="right">13.05</td>
<td align="right">14.36</td>
<td align="left">▅▃▇▇▃</td>
</tr>
<tr class="odd">
<td align="left">log_prisec_length_500</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6.99</td>
<td align="right">0.95</td>
<td align="right">6.21</td>
<td align="right">6.21</td>
<td align="right">6.21</td>
<td align="right">7.82</td>
<td align="right">9.40</td>
<td align="left">▇▁▂▂▁</td>
</tr>
<tr class="even">
<td align="left">log_prisec_length_1000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.56</td>
<td align="right">0.79</td>
<td align="right">7.60</td>
<td align="right">7.60</td>
<td align="right">8.66</td>
<td align="right">9.20</td>
<td align="right">10.47</td>
<td align="left">▇▅▆▃▁</td>
</tr>
<tr class="odd">
<td align="left">log_prisec_length_5000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">11.28</td>
<td align="right">0.78</td>
<td align="right">8.52</td>
<td align="right">10.91</td>
<td align="right">11.42</td>
<td align="right">11.83</td>
<td align="right">12.78</td>
<td align="left">▁▁▃▇▃</td>
</tr>
<tr class="even">
<td align="left">log_prisec_length_10000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">12.41</td>
<td align="right">0.73</td>
<td align="right">9.21</td>
<td align="right">11.99</td>
<td align="right">12.53</td>
<td align="right">12.94</td>
<td align="right">13.85</td>
<td align="left">▁▁▃▇▅</td>
</tr>
<tr class="odd">
<td align="left">log_prisec_length_15000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">13.03</td>
<td align="right">0.72</td>
<td align="right">9.62</td>
<td align="right">12.59</td>
<td align="right">13.13</td>
<td align="right">13.57</td>
<td align="right">14.41</td>
<td align="left">▁▁▃▇▅</td>
</tr>
<tr class="even">
<td align="left">log_prisec_length_25000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">13.82</td>
<td align="right">0.70</td>
<td align="right">10.13</td>
<td align="right">13.38</td>
<td align="right">13.92</td>
<td align="right">14.35</td>
<td align="right">15.23</td>
<td align="left">▁▁▃▇▆</td>
</tr>
<tr class="odd">
<td align="left">log_nei_2008_pm25_sum_10000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.97</td>
<td align="right">2.35</td>
<td align="right">0.00</td>
<td align="right">2.15</td>
<td align="right">4.29</td>
<td align="right">5.69</td>
<td align="right">9.12</td>
<td align="left">▆▅▇▆▂</td>
</tr>
<tr class="even">
<td align="left">log_nei_2008_pm25_sum_15000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.72</td>
<td align="right">2.25</td>
<td align="right">0.00</td>
<td align="right">3.47</td>
<td align="right">5.00</td>
<td align="right">6.35</td>
<td align="right">9.42</td>
<td align="left">▃▃▇▇▂</td>
</tr>
<tr class="odd">
<td align="left">log_nei_2008_pm25_sum_25000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.67</td>
<td align="right">2.11</td>
<td align="right">0.00</td>
<td align="right">4.66</td>
<td align="right">5.91</td>
<td align="right">7.28</td>
<td align="right">9.65</td>
<td align="left">▂▂▇▇▃</td>
</tr>
<tr class="even">
<td align="left">log_nei_2008_pm10_sum_10000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.35</td>
<td align="right">2.32</td>
<td align="right">0.00</td>
<td align="right">2.69</td>
<td align="right">4.62</td>
<td align="right">6.07</td>
<td align="right">9.34</td>
<td align="left">▅▅▇▇▂</td>
</tr>
<tr class="odd">
<td align="left">log_nei_2008_pm10_sum_15000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.10</td>
<td align="right">2.18</td>
<td align="right">0.00</td>
<td align="right">3.87</td>
<td align="right">5.39</td>
<td align="right">6.72</td>
<td align="right">9.71</td>
<td align="left">▂▃▇▇▂</td>
</tr>
<tr class="even">
<td align="left">log_nei_2008_pm10_sum_25000</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6.07</td>
<td align="right">2.01</td>
<td align="right">0.00</td>
<td align="right">5.10</td>
<td align="right">6.37</td>
<td align="right">7.52</td>
<td align="right">9.88</td>
<td align="left">▁▂▆▇▃</td>
</tr>
<tr class="odd">
<td align="left">popdens_county</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">551.76</td>
<td align="right">1711.51</td>
<td align="right">0.26</td>
<td align="right">40.77</td>
<td align="right">156.67</td>
<td align="right">510.81</td>
<td align="right">26821.91</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">popdens_zcta</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1279.66</td>
<td align="right">2757.49</td>
<td align="right">0.00</td>
<td align="right">101.15</td>
<td align="right">610.35</td>
<td align="right">1382.52</td>
<td align="right">30418.84</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">nohs</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6.99</td>
<td align="right">7.21</td>
<td align="right">0.00</td>
<td align="right">2.70</td>
<td align="right">5.10</td>
<td align="right">8.80</td>
<td align="right">100.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">somehs</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10.17</td>
<td align="right">6.20</td>
<td align="right">0.00</td>
<td align="right">5.90</td>
<td align="right">9.40</td>
<td align="right">13.90</td>
<td align="right">72.20</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">hs</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">30.32</td>
<td align="right">11.40</td>
<td align="right">0.00</td>
<td align="right">23.80</td>
<td align="right">30.75</td>
<td align="right">36.10</td>
<td align="right">100.00</td>
<td align="left">▂▇▂▁▁</td>
</tr>
<tr class="even">
<td align="left">somecollege</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">21.58</td>
<td align="right">8.60</td>
<td align="right">0.00</td>
<td align="right">17.50</td>
<td align="right">21.30</td>
<td align="right">24.70</td>
<td align="right">100.00</td>
<td align="left">▆▇▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">associate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7.13</td>
<td align="right">4.01</td>
<td align="right">0.00</td>
<td align="right">4.90</td>
<td align="right">7.10</td>
<td align="right">8.80</td>
<td align="right">71.40</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">bachelor</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">14.90</td>
<td align="right">9.71</td>
<td align="right">0.00</td>
<td align="right">8.80</td>
<td align="right">12.95</td>
<td align="right">19.22</td>
<td align="right">100.00</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">grad</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.91</td>
<td align="right">8.65</td>
<td align="right">0.00</td>
<td align="right">3.90</td>
<td align="right">6.70</td>
<td align="right">11.00</td>
<td align="right">100.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">pov</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">14.95</td>
<td align="right">11.33</td>
<td align="right">0.00</td>
<td align="right">6.50</td>
<td align="right">12.10</td>
<td align="right">21.22</td>
<td align="right">65.90</td>
<td align="left">▇▅▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">hs_orless</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">47.48</td>
<td align="right">16.75</td>
<td align="right">0.00</td>
<td align="right">37.92</td>
<td align="right">48.65</td>
<td align="right">59.10</td>
<td align="right">100.00</td>
<td align="left">▁▃▇▃▁</td>
</tr>
<tr class="even">
<td align="left">urc2013</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.92</td>
<td align="right">1.52</td>
<td align="right">1.00</td>
<td align="right">2.00</td>
<td align="right">3.00</td>
<td align="right">4.00</td>
<td align="right">6.00</td>
<td align="left">▇▅▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">urc2006</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.97</td>
<td align="right">1.52</td>
<td align="right">1.00</td>
<td align="right">2.00</td>
<td align="right">3.00</td>
<td align="right">4.00</td>
<td align="right">6.00</td>
<td align="left">▇▅▃▂▁</td>
</tr>
<tr class="even">
<td align="left">aod</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">43.70</td>
<td align="right">19.56</td>
<td align="right">5.00</td>
<td align="right">31.66</td>
<td align="right">40.17</td>
<td align="right">49.67</td>
<td align="right">143.00</td>
<td align="left">▃▇▁▁▁</td>
</tr>
</tbody>
</table>
<div id="ques:air-poll-5" class="question">
<p class="question-begin">
► Question 23.5
</p>
<div class="question-body">
<p>Here are a few starting points to explore (for each question also explain how you figured out the answer):</p>
<ul>
<li>how much missing data is there?</li>
<li>what data types are represented?</li>
<li>how many states are represented?</li>
<li>are there variables with large ranges? small ranges?</li>
<li>are there variables with normal distributions? very uneven distributions?</li>
</ul>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Next step is to look a little bit deeper at what information is in each column.</p>
<div id="ques:air-poll-6" class="question">
<p class="question-begin">
► Question 23.6
</p>
<div class="question-body">
<p>Here are a few starting points to explore (for each question include the code you used to get the answer:</p>
<ul>
<li>What states are included?</li>
<li>what cities have the highest number of air monitors?</li>
</ul>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-62" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-62', 'sol-start-62')"></span>
</p>
<div id="sol-body-62" class="solution-body" style="display: none;">
<p>What states are included?</p>
<table>
<thead><tr class="header">
<th align="left">state</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
</tr>
<tr class="odd">
<td align="left">Arkansas</td>
</tr>
<tr class="even">
<td align="left">California</td>
</tr>
<tr class="odd">
<td align="left">Colorado</td>
</tr>
<tr class="even">
<td align="left">Connecticut</td>
</tr>
<tr class="odd">
<td align="left">Delaware</td>
</tr>
<tr class="even">
<td align="left">District Of Columbia</td>
</tr>
<tr class="odd">
<td align="left">Florida</td>
</tr>
<tr class="even">
<td align="left">Georgia</td>
</tr>
<tr class="odd">
<td align="left">Idaho</td>
</tr>
<tr class="even">
<td align="left">Illinois</td>
</tr>
<tr class="odd">
<td align="left">Indiana</td>
</tr>
<tr class="even">
<td align="left">Iowa</td>
</tr>
<tr class="odd">
<td align="left">Kansas</td>
</tr>
<tr class="even">
<td align="left">Kentucky</td>
</tr>
<tr class="odd">
<td align="left">Louisiana</td>
</tr>
<tr class="even">
<td align="left">Maine</td>
</tr>
<tr class="odd">
<td align="left">Maryland</td>
</tr>
<tr class="even">
<td align="left">Massachusetts</td>
</tr>
<tr class="odd">
<td align="left">Michigan</td>
</tr>
<tr class="even">
<td align="left">Minnesota</td>
</tr>
<tr class="odd">
<td align="left">Mississippi</td>
</tr>
<tr class="even">
<td align="left">Missouri</td>
</tr>
<tr class="odd">
<td align="left">Montana</td>
</tr>
<tr class="even">
<td align="left">Nebraska</td>
</tr>
<tr class="odd">
<td align="left">Nevada</td>
</tr>
<tr class="even">
<td align="left">New Hampshire</td>
</tr>
<tr class="odd">
<td align="left">New Jersey</td>
</tr>
<tr class="even">
<td align="left">New Mexico</td>
</tr>
<tr class="odd">
<td align="left">New York</td>
</tr>
<tr class="even">
<td align="left">North Carolina</td>
</tr>
<tr class="odd">
<td align="left">North Dakota</td>
</tr>
<tr class="even">
<td align="left">Ohio</td>
</tr>
<tr class="odd">
<td align="left">Oklahoma</td>
</tr>
<tr class="even">
<td align="left">Oregon</td>
</tr>
<tr class="odd">
<td align="left">Pennsylvania</td>
</tr>
<tr class="even">
<td align="left">Rhode Island</td>
</tr>
<tr class="odd">
<td align="left">South Carolina</td>
</tr>
<tr class="even">
<td align="left">South Dakota</td>
</tr>
<tr class="odd">
<td align="left">Tennessee</td>
</tr>
<tr class="even">
<td align="left">Texas</td>
</tr>
<tr class="odd">
<td align="left">Utah</td>
</tr>
<tr class="even">
<td align="left">Vermont</td>
</tr>
<tr class="odd">
<td align="left">Virginia</td>
</tr>
<tr class="even">
<td align="left">Washington</td>
</tr>
<tr class="odd">
<td align="left">West Virginia</td>
</tr>
<tr class="even">
<td align="left">Wisconsin</td>
</tr>
<tr class="odd">
<td align="left">Wyoming</td>
</tr>
</tbody>
</table>
<p>Cities with largest number of air monitors?</p>
<pre><code>## # A tibble: 607 x 2
## # Groups:   city [607]
##    city              n
##    &lt;chr&gt;         &lt;int&gt;
##  1 Not in a city   103
##  2 New York          9
##  3 Cleveland         6
##  4 Baltimore         5
##  5 Chicago           5
##  6 Detroit           5
##  7 Milwaukee         5
##  8 New Haven         5
##  9 Philadelphia      5
## 10 Springfield       5
## # ... with 597 more rows</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>We should also evaluate to which extent our predictor variables are correlated.</p>
<div id="ques:air-poll-7" class="question">
<p class="question-begin">
► Question 23.7
</p>
<div class="question-body">
<p>Consider why it could be problematic if we had highly correlated predictor variables in our feature set.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-63" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-63', 'sol-start-63')"></span>
</p>
<div id="sol-body-63" class="solution-body" style="display: none;">
<p>When we use linear regressions and predictor variables are correlated they end up predicting each other rather than the outcome variable. This is generally referred to as multicollinearity.</p>
<p>Additionally, including redundant variables can add unnecessary noise to our model which can end up decreasing the accuracy of our precipitations and slow down our model.</p>
<p>Correlation among predictor variables can also make it difficult to understand which of them are actually predictive.</p>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>We’ll start by making pairwise comparisons among all of our numeric (continuous) variables using <code>corrplot</code>.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="predictive-modeling-for-air-pollution.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate Pearson's coefficients</span></span>
<span id="cb503-2"><a href="predictive-modeling-for-air-pollution.html#cb503-2" aria-hidden="true" tabindex="-1"></a>PM_cor <span class="ot">&lt;-</span> pm <span class="sc">%&gt;%</span></span>
<span id="cb503-3"><a href="predictive-modeling-for-air-pollution.html#cb503-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(is.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb503-4"><a href="predictive-modeling-for-air-pollution.html#cb503-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span>
<span id="cb503-5"><a href="predictive-modeling-for-air-pollution.html#cb503-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb503-6"><a href="predictive-modeling-for-air-pollution.html#cb503-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot pairwise correlation matrix</span></span>
<span id="cb503-7"><a href="predictive-modeling-for-air-pollution.html#cb503-7" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(PM_cor, <span class="at">tl.cex =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-431"></span>
<p class="caption marginnote shownote">
Figure 23.1: Pairwise comparison of correlation coefficients for all continuous variables.
</p>
<img src="_main_files/figure-html/unnamed-chunk-431-1.png" alt="Pairwise comparison of correlation coefficients for all continuous variables." width="672">
</div>
<p>Let’s re-plot that visualization using the absolute values of the Pearson correlation coefficient<label for="tufte-sn-140" class="margin-toggle sidenote-number">140</label><input type="checkbox" id="tufte-sn-140" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">140</span> We are not interested in the direction of the correlation only how strong it is</span> and by organizing our variables using hierarchical clustering, i.e. variables more similar to each other will be closer to each other.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="predictive-modeling-for-air-pollution.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(<span class="fu">abs</span>(PM_cor), <span class="at">order =</span> <span class="st">"hclust"</span>, <span class="at">tl.cex =</span> <span class="fl">0.5</span>, <span class="at">col.lim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-432"></span>
<p class="caption marginnote shownote">
Figure 23.2: Pairwise comparison of correlation coefficients for all continuous variables. Size and color intensity of circles represent the strength of these realationships.
</p>
<img src="_main_files/figure-html/unnamed-chunk-432-1.png" alt="Pairwise comparison of correlation coefficients for all continuous variables. Size and color intensity of circles represent the strength of these realationships." width="672">
</div>
<p>We can now see that there are quite a few variables correlated with our outcome variable (<code>value</code>). Unsurprisingly, we also have sets of variables describing the characteristic of the area corresponding to the locations of the emissions values, primarily the variables that contain <code>imp_*</code>, <code>*pri_*</code>, <code>*nei_*</code>.</p>
<div id="ques:air-poll-8" class="question">
<p class="question-begin">
► Question 23.8
</p>
<div class="question-body">
<p>Look up what these variables are and argue whether or not it makes sense for these sets of values to be correlated to the PM2.5 value. What other variables might be good indicators?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-64" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-64', 'sol-start-64')"></span>
</p>
<div id="sol-body-64" class="solution-body" style="display: none;">
<p>We can consider the set of <code>imp</code> variables as indicative of development/urbanization, the <code>pri</code> variables describe road density which can be an indicator of the amount of cars, an the <code>nei</code> variables describe emissions.</p>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>We can take a closer look at sets of variables we are interested in using the <code>ggcorr()</code> and <code>ggpairs()</code> functions from the <code>GGally</code> package.</p>
<p>Let’s start with our variables describing measuring how impervious the surface is:</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="predictive-modeling-for-air-pollution.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot pairwise </span></span>
<span id="cb505-2"><a href="predictive-modeling-for-air-pollution.html#cb505-2" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">%&gt;%</span></span>
<span id="cb505-3"><a href="predictive-modeling-for-air-pollution.html#cb505-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"imp"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb505-4"><a href="predictive-modeling-for-air-pollution.html#cb505-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggcorr</span>(<span class="at">label =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-433"></span>
<p class="caption marginnote shownote">
Figure 23.3: Pairwise comparison of correlation coefficients for all variables related to levels of development, i.e. level of surface imperiouslness.
</p>
<img src="_main_files/figure-html/unnamed-chunk-433-1.png" alt="Pairwise comparison of correlation coefficients for all variables related to levels of development, i.e. level of surface imperiouslness." width="672">
</div>
<p>And let’s look even a little bit closer look at the relationship of these variables.visualizing the relationships using scatter plots, the distribution of values for each variable using density plots, along with the correlation coefficients.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="predictive-modeling-for-air-pollution.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot scatter plots, density plots &amp; correlation coefficients</span></span>
<span id="cb506-2"><a href="predictive-modeling-for-air-pollution.html#cb506-2" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">%&gt;%</span></span>
<span id="cb506-3"><a href="predictive-modeling-for-air-pollution.html#cb506-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"imp"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb506-4"><a href="predictive-modeling-for-air-pollution.html#cb506-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>() <span class="sc">+</span></span>
<span id="cb506-5"><a href="predictive-modeling-for-air-pollution.html#cb506-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-434"></span>
<p class="caption marginnote shownote">
Figure 23.4: Scatterplots describing the relationships between all combinations of values describing level of development for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson’s correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal.
</p>
<img src="_main_files/figure-html/unnamed-chunk-434-1.png" alt="Scatterplots describing the relationships between all combinations of values describing level of development for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson's correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal." width="864">
</div>
<div id="ques:air-poll-9" class="question">
<p class="question-begin">
► Question 23.9
</p>
<div class="question-body">
<p>Which of these pairwise comparisons have the highest level of correlation? Which have the lowest? Does this make sense?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Next, let’s take a peak at our road density data</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="predictive-modeling-for-air-pollution.html#cb507-1" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">%&gt;%</span></span>
<span id="cb507-2"><a href="predictive-modeling-for-air-pollution.html#cb507-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"pri"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb507-3"><a href="predictive-modeling-for-air-pollution.html#cb507-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>() <span class="sc">+</span></span>
<span id="cb507-4"><a href="predictive-modeling-for-air-pollution.html#cb507-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-435"></span>
<p class="caption marginnote shownote">
Figure 23.5: Scatterplots describing the relationships between all combinations of values describing road density for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson’s correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal.
</p>
<img src="_main_files/figure-html/unnamed-chunk-435-1.png" alt="Scatterplots describing the relationships between all combinations of values describing road density for buffers surrounding each air pollution monitor  (below the diagonal) and corresponding pearson's correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal." width="864">
</div>
<div id="ques:air-poll-10" class="question">
<p class="question-begin">
► Question 23.10
</p>
<div class="question-body">
<p>Which of these pairwise comparisons have the highest level of correlation? Which have the lowest? Does this make sense?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Finally, let’s look at the emissions variables:</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="predictive-modeling-for-air-pollution.html#cb508-1" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">%&gt;%</span></span>
<span id="cb508-2"><a href="predictive-modeling-for-air-pollution.html#cb508-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"nei"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb508-3"><a href="predictive-modeling-for-air-pollution.html#cb508-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>() <span class="sc">+</span></span>
<span id="cb508-4"><a href="predictive-modeling-for-air-pollution.html#cb508-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-436"></span>
<p class="caption marginnote shownote">
Figure 23.6: Scatterplots describing the relationships between all combinations of variables measuring air pollution for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson’s correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal.
</p>
<img src="_main_files/figure-html/unnamed-chunk-436-1.png" alt="Scatterplots describing the relationships between all combinations of variables measuring air pollution for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson's correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal." width="864">
</div>
<div id="ques:air-poll-11" class="question">
<p class="question-begin">
► Question 23.11
</p>
<div class="question-body">
<p>Which of these pairwise comparisons have the highest level of correlation? Which have the lowest? Does this make sense?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Since we now know that the variables within these categories are correlated to each other, let’s select one of each for the same buffer size and compare how they are correlated to each other along with population density.</p>
<p>And finally, let’s see how population density correlates to some of these variables:</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="predictive-modeling-for-air-pollution.html#cb509-1" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">%&gt;%</span></span>
<span id="cb509-2"><a href="predictive-modeling-for-air-pollution.html#cb509-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(log_nei_2008_pm25_sum_10000, popdens_county, </span>
<span id="cb509-3"><a href="predictive-modeling-for-air-pollution.html#cb509-3" aria-hidden="true" tabindex="-1"></a>       log_pri_length_10000, imp_a10000, county_pop) <span class="sc">%&gt;%</span></span>
<span id="cb509-4"><a href="predictive-modeling-for-air-pollution.html#cb509-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-437"></span>
<p class="caption marginnote shownote">
Figure 23.7: Scatterplots describing the relationships between range of variables describing development, road density, emission levels, and population density for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson’s correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal.
</p>
<img src="_main_files/figure-html/unnamed-chunk-437-1.png" alt="Scatterplots describing the relationships between range of variables describing development, road density, emission levels, and population density for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson's correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal." width="864">
</div>
<div id="ques:air-poll-12" class="question">
<p class="question-begin">
► Question 23.12
</p>
<div class="question-body">
<p>Which of these pairwise comparisons have the highest level of correlation? Which have the lowest? Does this make sense?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Some of our variables have extreme variables; one way to do this is to perform a log transformation which might estimate our correlations so we should take a quick look.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="predictive-modeling-for-air-pollution.html#cb510-1" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">%&gt;%</span></span>
<span id="cb510-2"><a href="predictive-modeling-for-air-pollution.html#cb510-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_popdens_county =</span> <span class="fu">log</span>(popdens_county)) <span class="sc">%&gt;%</span></span>
<span id="cb510-3"><a href="predictive-modeling-for-air-pollution.html#cb510-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_pop_county =</span> <span class="fu">log</span>(county_pop)) <span class="sc">%&gt;%</span></span>
<span id="cb510-4"><a href="predictive-modeling-for-air-pollution.html#cb510-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(log_nei_2008_pm25_sum_10000, log_popdens_county, </span>
<span id="cb510-5"><a href="predictive-modeling-for-air-pollution.html#cb510-5" aria-hidden="true" tabindex="-1"></a>       log_pri_length_10000, imp_a10000, log_pop_county) <span class="sc">%&gt;%</span></span>
<span id="cb510-6"><a href="predictive-modeling-for-air-pollution.html#cb510-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-438"></span>
<p class="caption marginnote shownote">
Figure 23.8: Scatterplots describing the relationships between range of variables describing development, road density, emission levels, and population density for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson’s correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal.
</p>
<img src="_main_files/figure-html/unnamed-chunk-438-1.png" alt="Scatterplots describing the relationships between range of variables describing development, road density, emission levels, and population density for buffers surrounding each air pollution monitor (below the diagonal) and corresponding pearson's correlation coefficients (above the diagonal), the distribution of values for each variable is on the diagonal." width="864">
</div>
<p>This does increase our correlation levels a bit but overall these variables do not appear to be highly correlated, so we should make sure keep a variable from each category to use as predictor values for our model.</p>
<p>Let’s add an extra variable that tells us whether or not a monitor is in a city - this will be helpful down the line.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="predictive-modeling-for-air-pollution.html#cb511-1" aria-hidden="true" tabindex="-1"></a>pm <span class="ot">&lt;-</span> pm <span class="sc">%&gt;%</span></span>
<span id="cb511-2"><a href="predictive-modeling-for-air-pollution.html#cb511-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">case_when</span>(city <span class="sc">==</span> <span class="st">"Not in a city"</span> <span class="sc">~</span> <span class="st">"Not in a city"</span>,</span>
<span id="cb511-3"><a href="predictive-modeling-for-air-pollution.html#cb511-3" aria-hidden="true" tabindex="-1"></a>                          city <span class="sc">!=</span> <span class="st">"Not in a city"</span> <span class="sc">~</span> <span class="st">"In a city"</span>))</span></code></pre></div>
</div>
<div id="machine-learning" class="section level2" number="23.3">
<h2>
<span class="header-section-number">23.3</span> Machine learning<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('machine-learning')" onmouseout="reset_tooltip('machine-learning-tooltip')"><span class="tooltiptext" id="machine-learning-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>We are going to use machine learning for to build and train our predictive modeling.</p>
<p>You might recall from your biostats class that typically we draw a sample from a population and then we use what we learn from the sample to make inferences about the population that they represent, i.e. we can infer the average value of an observation in the (unsampled) population based on the sample<label for="tufte-sn-141" class="margin-toggle sidenote-number">141</label><input type="checkbox" id="tufte-sn-141" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">141</span> Recall, for linear regressions we use the formula “on average for an increase of one unit of the independent variable we expect the independent variable to increase by the value of the slope” to describe out results.</span>.</p>
<p>For prediction we also start with a sample, however, in this case the goal is to be able to predict a single observation’s value of a given characteristic based on the characteristics of the observations in the sample - our goal is not to make a statement about what the average expectation for the value of an observation is, we want to predict the actual value for that observation.</p>
<p>In the case at hand, we have our continuous outcome variable that we want to predict (air pollution levels) which we will denote as <span class="math inline">\(Y\)</span>. <span class="math inline">\(X\)</span> would be our set of predictor variables with <span class="math inline">\(X_{1}, ... X_{p}\)</span> denoting individual features (development, population density …).</p>
<p>Our goal is to describe a rule (machine learning algorithm) that takes values for our features as input and the predicts the air pollution (outcome variable) for situations where air pollution is unknown (<span class="math inline">\(\hat{Y}\)</span>) . This process is what we generally describe as training a model and means that we are using a data set where both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are known to estimate a function <span class="math inline">\(\hat{Y} = f(X)\)</span> that uses the predictor variables as input.</p>
<p>The better our model, the more closely our predicted outcome <span class="math inline">\(\hat{Y}\)</span> should match our actual outcome <span class="math inline">\(Y\)</span>. In other words we are trying to minimize the distance between <span class="math inline">\(\hat{Y} = f(X)\)</span> and <span class="math inline">\(Y\)</span><label for="tufte-sn-142" class="margin-toggle sidenote-number">142</label><input type="checkbox" id="tufte-sn-142" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">142</span> This is what is referred to as an optimization problem.</span>. The choice of the distance metric (<span class="math inline">\(d(Y - f(X))\)</span>) is frequently the absolute or squared difference.</p>
<p>In order to set up (and then solve!) a typical ML problem we need four components:</p>
<ol style="list-style-type: decimal">
<li>a training data set (i.e. matching data set of outcome and predictor variables)</li>
<li>a (set of) algorithms to try values of <span class="math inline">\(f\)</span>.</li>
<li>A distance metric <span class="math inline">\(d\)</span> to measure how closely <span class="math inline">\(Y\)</span> and <span class="math inline">\(\hat{Y}\)</span> mathc.</li>
<li>A definition of a “good” (acceptable) distance.</li>
</ol>
</div>
<div id="predict-air-pollution-levels-using-linear-regression-model." class="section level2" number="23.4">
<h2>
<span class="header-section-number">23.4</span> Predict air pollution levels using linear regression model.<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('predict-air-pollution-levels-using-linear-regression-model.')" onmouseout="reset_tooltip('predict-air-pollution-levels-using-linear-regression-model.-tooltip')"><span class="tooltiptext" id="predict-air-pollution-levels-using-linear-regression-model.-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>We already have a data set with features and outcome variables so we are ready to starting training a model.</p>
<p>We are going to use the <code>tidymodels</code> ecosystem which consists of a series of packages to assist in various steps of the model building process. These packages were designed using a standard syntax and the goal of having a standardize workflow and syntax across different types of machine learning algorithms. This also means that it is straightforward to modify pre-processing, algorithm choice, and hyper-parameter tuning for optimization.</p>
<p>These are the individual steps that we will go through to train our model<label for="tufte-sn-143" class="margin-toggle sidenote-number">143</label><input type="checkbox" id="tufte-sn-143" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">143</span> You are already familiar with some of these steps for some simple linear regressions that we have run (Steps 3, 5, 6, 7). Use this list to keep track of where we are in the process.</span>.</p>
<ol style="list-style-type: decimal">
<li>Split data into testing and training sets.</li>
<li>Create recipe + assign variable roles</li>
<li>Specify model, engine, and mode</li>
<li>Create workflow, add recipe &amp; model</li>
<li>Fit workflow</li>
<li>Get predictions</li>
<li>Use predictions to get performance metrics.</li>
</ol>
<div id="split-the-data" class="section level3" number="23.4.1">
<h3>
<span class="header-section-number">23.4.1</span> Split the data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('split-the-data')" onmouseout="reset_tooltip('split-the-data-tooltip')"><span class="tooltiptext" id="split-the-data-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div id="ques:air-poll-13" class="question">
<p class="question-begin">
► Question 23.13
</p>
<div class="question-body">
<p>We have previously discussed the problem with underfitting and overfitting - briefly describe these two terms and explain why they are a problem when building models.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>A good solution to this issue is to split our data set into a training and testing data set. The training data set will be used to build and tune our model. Then we can determine how well our model describe the relationship between outcome and predictor values.</p>
<p>Once we have created our training set we will set that aside until we have completed optimizing our model with the training set to minimize the bias in evaluating the performance of our model.</p>
<p>We will use <code>rsample::initial_split()</code> to randomly subset our data into a training (2/3 of observations) and test (1/3 of observations), data set.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="predictive-modeling-for-air-pollution.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set random seed</span></span>
<span id="cb512-2"><a href="predictive-modeling-for-air-pollution.html#cb512-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb512-3"><a href="predictive-modeling-for-air-pollution.html#cb512-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-4"><a href="predictive-modeling-for-air-pollution.html#cb512-4" aria-hidden="true" tabindex="-1"></a><span class="co"># split sample</span></span>
<span id="cb512-5"><a href="predictive-modeling-for-air-pollution.html#cb512-5" aria-hidden="true" tabindex="-1"></a>pm_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(<span class="at">data =</span> pm, <span class="at">prop =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb512-6"><a href="predictive-modeling-for-air-pollution.html#cb512-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-7"><a href="predictive-modeling-for-air-pollution.html#cb512-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check proportions of split</span></span>
<span id="cb512-8"><a href="predictive-modeling-for-air-pollution.html#cb512-8" aria-hidden="true" tabindex="-1"></a>pm_split</span></code></pre></div>
<pre><code>## &lt;Analysis/Assess/Total&gt;
## &lt;584/292/876&gt;</code></pre>
<p>Next, we will extract the testing and training data to create to separate <code>data.frames()</code></p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="predictive-modeling-for-air-pollution.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="co"># training data set</span></span>
<span id="cb514-2"><a href="predictive-modeling-for-air-pollution.html#cb514-2" aria-hidden="true" tabindex="-1"></a>train_pm <span class="ot">&lt;-</span> <span class="fu">training</span>(pm_split)</span>
<span id="cb514-3"><a href="predictive-modeling-for-air-pollution.html#cb514-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-4"><a href="predictive-modeling-for-air-pollution.html#cb514-4" aria-hidden="true" tabindex="-1"></a><span class="co"># test data set</span></span>
<span id="cb514-5"><a href="predictive-modeling-for-air-pollution.html#cb514-5" aria-hidden="true" tabindex="-1"></a>test_pm <span class="ot">&lt;-</span> <span class="fu">testing</span>(pm_split)</span></code></pre></div>
</div>
<div id="prepare-for-pre-proceesing" class="section level3" number="23.4.2">
<h3>
<span class="header-section-number">23.4.2</span> Prepare for pre-proceesing<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('prepare-for-pre-proceesing')" onmouseout="reset_tooltip('prepare-for-pre-proceesing-tooltip')"><span class="tooltiptext" id="prepare-for-pre-proceesing-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Now that we have split the data we need to process the training and testing data so they are compatible and optimized for building the model. This process is called feature engineering and involves assigning variables to specific roles, removing redundant variables if they are present, and scaling data as needed.</p>
<p><strong>Step 1: Specify variable roles with <code>recipe()</code></strong></p>
<p>In the <code>tidymodels</code> framework we can do this by first creating a “recipe” describing all the individual processing steps we want to take - this is especially helpful if we have multiple data sets we are going to work with and/or if we are going to be re-running the processing multiple time.</p>
<p>First, we will create a recipe that specifies the roles of individual variables, i.e. which are the outcome and which the predictor variables<label for="tufte-sn-144" class="margin-toggle sidenote-number">144</label><input type="checkbox" id="tufte-sn-144" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">144</span> Keep in mind that the recipe just describes the steps to take, it does <strong>not</strong> actually execute them</span>.</p>
<p>For our data set we want to specify that <code>value</code> (the PM2.5 concentration measure by air pollution monitors) is our outcome variable, and that our features (predictor variables) are all the other variables with the exception of the monitor ID (<code>id</code>). We don’t want to include this as a predictor variable as it is unique to each monitor so it will only add noise - however, down the line we will still want to have this information so we want to keep it in the data set.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="predictive-modeling-for-air-pollution.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build recipe</span></span>
<span id="cb515-2"><a href="predictive-modeling-for-air-pollution.html#cb515-2" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="ot">&lt;-</span><span class="fu">recipe</span>(train_pm) <span class="sc">%&gt;%</span></span>
<span id="cb515-3"><a href="predictive-modeling-for-air-pollution.html#cb515-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="fu">everything</span>(), <span class="at">new_role =</span> <span class="st">"predictor"</span>)<span class="sc">%&gt;%</span>  <span class="co"># specify predictor variables</span></span>
<span id="cb515-4"><a href="predictive-modeling-for-air-pollution.html#cb515-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(value, <span class="at">new_role =</span> <span class="st">"outcome"</span>)<span class="sc">%&gt;%</span>           <span class="co"># specify outcome variable</span></span>
<span id="cb515-5"><a href="predictive-modeling-for-air-pollution.html#cb515-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id variable"</span>)             <span class="co"># specify id as id variable</span></span>
<span id="cb515-6"><a href="predictive-modeling-for-air-pollution.html#cb515-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-7"><a href="predictive-modeling-for-air-pollution.html#cb515-7" aria-hidden="true" tabindex="-1"></a>simple_rec</span></code></pre></div>
<pre><code>## Recipe
## 
## Inputs:
## 
##         role #variables
##  id variable          1
##      outcome          1
##    predictor         48</code></pre>
<p>Let’s take closer look at our recipe</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="predictive-modeling-for-air-pollution.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_rec)</span></code></pre></div>
<pre><code>## # A tibble: 50 x 4
##    variable type    role        source  
##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;   
##  1 id       nominal id variable original
##  2 value    numeric outcome     original
##  3 fips     nominal predictor   original
##  4 lat      numeric predictor   original
##  5 lon      numeric predictor   original
##  6 state    nominal predictor   original
##  7 county   nominal predictor   original
##  8 city     nominal predictor   original
##  9 cmaq     numeric predictor   original
## 10 zcta     nominal predictor   original
## # ... with 40 more rows</code></pre>
<p>Success! All of our variables now have specific roles as either the outcome variable, features, and the id column.</p>
<p><strong>Step 2: Specify pre-processing steps</strong></p>
<p>Our next step is to use the <code>recipe::step*()</code> functions to specify any necessary pre-processing steps, this could include a variety of steps needed to transform our data, for example filling in missing values (imputation), converting continuous variables in to discrete variables (binning them), encoding and creating dummy variables, data type conversions, or normalization.</p>
<p>Because we are in the extended <code>tidyverse</code> we can use various functions to help select of variables to apply steps to:</p>
<ol style="list-style-type: decimal">
<li>Use <code>tidyselect</code> methods such as <code>contains()</code>, <code>matches()</code>, <code>starts_with()</code>, <code>ends_with()</code>, <code>everything()</code>, <code>num_range()</code>.</li>
<li>Use the data type of a column, e.g. <code>all_nominal()</code>, <code>all_numeric()</code>, <code>has_type()</code>
</li>
<li>Use the role assigned to variable (see above) <code>all_predictors()</code>, <code>all_outcomes()</code>, <code>has_role()</code>
</li>
<li>We can just use the name of the variable.</li>
</ol>
<p>Let’s look at a couple of specific examples for what we need to pay attention to during preprocessing.</p>
<p>A typical pre-processing step is what is called <code>one-hot encoding</code> which describes a way that categorical variables are converted to dummy variables (numbers) so that they can be used with certain algorithms that only take certain data types as input. Because we don’t want the algorithm to interpret this variables as continuous numerical variables, we make it explicit that they are binary (0s and 1s, no order).</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="predictive-modeling-for-air-pollution.html#cb519-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="sc">%&gt;%</span></span>
<span id="cb519-2"><a href="predictive-modeling-for-air-pollution.html#cb519-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(state, country, city, zcta, <span class="at">one_hot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Recipe
## 
## Inputs:
## 
##         role #variables
##  id variable          1
##      outcome          1
##    predictor         48
## 
## Operations:
## 
## Dummy variables from state, country, city, zcta</code></pre>
<p>The <code>fips</code> column contains a numeric code for state and county so it is redundant - we should also assign it as an id</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="predictive-modeling-for-air-pollution.html#cb521-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="sc">%&gt;%</span></span>
<span id="cb521-2"><a href="predictive-modeling-for-air-pollution.html#cb521-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(<span class="st">"fips"</span>, <span class="at">new_role =</span> <span class="st">"county id"</span>)</span></code></pre></div>
<pre><code>## Recipe
## 
## Inputs:
## 
##         role #variables
##    county id          1
##  id variable          1
##      outcome          1
##    predictor         47</code></pre>
<p>We know from our exploratory analysis that we have a series of variables that are redundant and/or highly correlated with each other; we will want to remove these, this can be done using <code>step_corr()</code>. However we want to keep some variables (<code>CMAQ</code>, <code>aod</code>) so we will explicitly exclude them from being removed.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="predictive-modeling-for-air-pollution.html#cb523-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="sc">%&gt;%</span></span>
<span id="cb523-2"><a href="predictive-modeling-for-air-pollution.html#cb523-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span> CMAQ, <span class="sc">-</span> aod)</span></code></pre></div>
<pre><code>## Recipe
## 
## Inputs:
## 
##         role #variables
##  id variable          1
##      outcome          1
##    predictor         48
## 
## Operations:
## 
## Correlation filter on all_predictors(), -CMAQ, -aod</code></pre>
<p>Variables with near zero variance will not be informative and will likely only include additional noise, so we would also want to remove those.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="predictive-modeling-for-air-pollution.html#cb525-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="sc">%&gt;%</span></span>
<span id="cb525-2"><a href="predictive-modeling-for-air-pollution.html#cb525-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span> CMAQ, <span class="sc">-</span> aod)</span></code></pre></div>
<pre><code>## Recipe
## 
## Inputs:
## 
##         role #variables
##  id variable          1
##      outcome          1
##    predictor         48
## 
## Operations:
## 
## Sparse, unbalanced variable filter on all_predictors(), -CMAQ, -aod</code></pre>
<p>The benefit of the recipes package is that we can create one single recipe that summarizes all the steps that we want to take before starting to build are model.</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="predictive-modeling-for-air-pollution.html#cb527-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create final recipe</span></span>
<span id="cb527-2"><a href="predictive-modeling-for-air-pollution.html#cb527-2" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(train_pm) <span class="sc">%&gt;%</span></span>
<span id="cb527-3"><a href="predictive-modeling-for-air-pollution.html#cb527-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="fu">everything</span>(), <span class="at">new_role =</span> <span class="st">"predictor"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb527-4"><a href="predictive-modeling-for-air-pollution.html#cb527-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(value, <span class="at">new_role =</span> <span class="st">"outcome"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb527-5"><a href="predictive-modeling-for-air-pollution.html#cb527-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb527-6"><a href="predictive-modeling-for-air-pollution.html#cb527-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="st">"fips"</span>, <span class="at">new_role =</span> <span class="st">"county id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb527-7"><a href="predictive-modeling-for-air-pollution.html#cb527-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_dummy</span>(state, county, city, zcta, <span class="at">one_hot =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb527-8"><a href="predictive-modeling-for-air-pollution.html#cb527-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_corr</span>(<span class="fu">all_numeric</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb527-9"><a href="predictive-modeling-for-air-pollution.html#cb527-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_nzv</span>(<span class="fu">all_numeric</span>())</span>
<span id="cb527-10"><a href="predictive-modeling-for-air-pollution.html#cb527-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb527-11"><a href="predictive-modeling-for-air-pollution.html#cb527-11" aria-hidden="true" tabindex="-1"></a>simple_rec</span></code></pre></div>
<pre><code>## Recipe
## 
## Inputs:
## 
##         role #variables
##    county id          1
##  id variable          1
##      outcome          1
##    predictor         47
## 
## Operations:
## 
## Dummy variables from state, county, city, zcta
## Correlation filter on all_numeric()
## Sparse, unbalanced variable filter on all_numeric()</code></pre>
</div>
<div id="run-pre-processing" class="section level3" number="23.4.3">
<h3>
<span class="header-section-number">23.4.3</span> Run pre-processing<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('run-pre-processing')" onmouseout="reset_tooltip('run-pre-processing-tooltip')"><span class="tooltiptext" id="run-pre-processing-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>So far we only have a recipe (plan on how we want to pre-process our data) our next step will be to complete the pre-processing and see how it affects our data set.</p>
<p><strong>Step 1: Update the recipe with training data using <code>prep()</code></strong></p>
<p>The function <code>prep()</code> will update the recipe object based on the training data by estimating parameters for pre-processing and updating the variable roles.</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="predictive-modeling-for-air-pollution.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update recipe with training data, retain training data set</span></span>
<span id="cb529-2"><a href="predictive-modeling-for-air-pollution.html#cb529-2" aria-hidden="true" tabindex="-1"></a>prepped_rec <span class="ot">&lt;-</span> <span class="fu">prep</span>(simple_rec, <span class="at">verbose =</span> <span class="cn">TRUE</span>, </span>
<span id="cb529-3"><a href="predictive-modeling-for-air-pollution.html#cb529-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">retain =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## oper 1 step dummy [training] 
## oper 2 step corr [training] 
## oper 3 step nzv [training] 
## The retained training set is ~ 0.27 Mb  in memory.</code></pre>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="predictive-modeling-for-air-pollution.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(prepped_rec)</span></code></pre></div>
<pre><code>## [1] "var_info"       "term_info"      "steps"          "template"       "levels"         "retained"       "tr_info"        "orig_lvls"     
## [9] "last_term_info"</code></pre>
<p><code>prepped_rec</code> is a list; the various elements contain a lot of useful information about our training set.</p>
<ul>
<li>
<code>steps</code>: contains the pre-processing steps that were run</li>
<li>
<code>var_info</code> contains the original variable information</li>
<li>
<code>term_info</code> is the updated variable after pre-processing</li>
<li>
<code>levels</code> are the new levels, the original levels are in <code>orig_lvls</code>
</li>
<li>
<code>tr_info</code> contains info about the training data set size and completeness</li>
</ul>
<p><strong>Step 2: Extract the pre-processing training data set using bake()`</strong></p>
<p>We retained our pre-processed training data set using <code>retain = TRUE</code> so we can take a look at our training data using <code>recipes::bake()</code>.</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="predictive-modeling-for-air-pollution.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract training data set</span></span>
<span id="cb533-2"><a href="predictive-modeling-for-air-pollution.html#cb533-2" aria-hidden="true" tabindex="-1"></a>baked_train <span class="ot">&lt;-</span> <span class="fu">bake</span>(prepped_rec, <span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb533-3"><a href="predictive-modeling-for-air-pollution.html#cb533-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-4"><a href="predictive-modeling-for-air-pollution.html#cb533-4" aria-hidden="true" tabindex="-1"></a><span class="co"># overview</span></span>
<span id="cb533-5"><a href="predictive-modeling-for-air-pollution.html#cb533-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(baked_train)</span></code></pre></div>
<pre><code>## Rows: 584
## Columns: 38
## $ id                          &lt;fct&gt; 18003.0004, 55041.0007, 6065.1003, 39009.0003, 39061.8001, 24510.0006, 6061.0006, 6065.5001, 44003.0002, 3711~
## $ value                       &lt;dbl&gt; 11.699065, 6.956780, 13.289744, 10.742000, 14.454783, 12.204167, 11.192063, 6.984545, 6.608690, 11.620670, 10~
## $ fips                        &lt;fct&gt; 18003, 55041, 6065, 39009, 39061, 24510, 6061, 6065, 44003, 37111, 19113, 6031, 17115, 22055, 12005, 36063, 1~
## $ lat                         &lt;dbl&gt; 41.09497, 45.56300, 33.94603, 39.44217, 39.18053, 39.34056, 38.74573, 33.85275, 41.61524, 35.68741, 42.00508,~
## $ lon                         &lt;dbl&gt; -85.10182, -88.80880, -117.40063, -81.90883, -84.49215, -76.58222, -121.26631, -116.54101, -71.72000, -81.993~
## $ cmaq                        &lt;dbl&gt; 10.383231, 3.411247, 11.404085, 7.971165, 11.791236, 10.940985, 8.814368, 7.719797, 6.356762, 6.901898, 7.459~
## $ zcta_area                   &lt;dbl&gt; 16696709, 370280916, 41957182, 132383592, 5358625, 461424, 28131203, 94913381, 130171360, 634388853, 35684277~
## $ zcta_pop                    &lt;dbl&gt; 21306, 4141, 44001, 1115, 6566, 934, 41192, 26179, 6135, 30600, 40149, 26079, 34075, 41163, 38425, 30389, 830~
## $ imp_a500                    &lt;dbl&gt; 28.97837370, 0.00000000, 30.39013841, 0.00000000, 51.26198934, 23.86332180, 31.68252595, 39.58564014, 0.12543~
## $ imp_a15000                  &lt;dbl&gt; 13.0547959, 0.3676404, 23.7457506, 0.3307975, 21.7174564, 24.0009267, 17.9092593, 8.0745508, 1.7787419, 1.209~
## $ county_area                 &lt;dbl&gt; 1702419942, 2626421270, 18664696661, 1304313482, 1051302780, 209643241, 3644136017, 18664696661, 436484769, 1~
## $ county_pop                  &lt;dbl&gt; 355329, 9304, 2189641, 64757, 802374, 620961, 348432, 2189641, 166158, 44996, 211226, 152982, 110768, 221578,~
## $ log_dist_to_prisec          &lt;dbl&gt; 6.621891, 8.415468, 7.419762, 6.344681, 5.778350, 6.290041, 7.018836, 6.838720, 8.408193, 6.688786, 5.039213,~
## $ log_pri_length_5000         &lt;dbl&gt; 8.517193, 8.517193, 10.150514, 8.517193, 9.956985, 10.300814, 10.288845, 9.442322, 8.517193, 9.775633, 10.219~
## $ log_pri_length_25000        &lt;dbl&gt; 12.77378, 10.16440, 13.14450, 10.12663, 13.02123, 13.68658, 12.19710, 11.33494, 12.61424, 11.88481, 12.10430,~
## $ log_prisec_length_500       &lt;dbl&gt; 6.214608, 6.214608, 6.214608, 6.214608, 7.141268, 6.214608, 6.214608, 6.214608, 6.214608, 6.214608, 7.789629,~
## $ log_prisec_length_1000      &lt;dbl&gt; 9.240294, 7.600902, 7.600902, 8.793450, 8.407702, 9.451706, 7.600902, 8.094200, 7.600902, 8.004455, 8.693829,~
## $ log_prisec_length_5000      &lt;dbl&gt; 11.485093, 9.425537, 10.155961, 10.562382, 11.698608, 12.086627, 10.288845, 10.247518, 9.406982, 11.155482, 1~
## $ log_prisec_length_10000     &lt;dbl&gt; 12.75582, 11.44833, 11.59563, 11.69093, 12.95940, 13.60081, 11.04273, 11.16916, 12.18139, 12.02683, 12.53498,~
## $ log_prisec_length_25000     &lt;dbl&gt; 13.98749, 13.15082, 13.44293, 13.58697, 14.59757, 14.87934, 12.99864, 12.53690, 14.39086, 13.13041, 13.64122,~
## $ log_nei_2008_pm10_sum_10000 &lt;dbl&gt; 4.91110140, 3.86982666, 4.03184660, 0.00000000, 5.89930186, 5.67208039, 4.20670364, 2.59375108, 0.02026674, 3~
## $ log_nei_2008_pm10_sum_15000 &lt;dbl&gt; 5.399131255, 3.883688842, 5.459257126, 0.000000000, 6.294167687, 6.365952312, 4.387253924, 2.606936870, 2.698~
## $ log_nei_2008_pm10_sum_25000 &lt;dbl&gt; 5.8160473, 3.8872637, 6.8845369, 3.7656347, 6.7347561, 8.6395685, 5.7761975, 3.5981622, 3.7133080, 4.8642599,~
## $ popdens_county              &lt;dbl&gt; 208.719947, 3.542463, 117.314577, 49.648341, 763.218756, 2961.989125, 95.614433, 117.314577, 380.673077, 39.4~
## $ popdens_zcta                &lt;dbl&gt; 1276.059851, 11.183401, 1048.711994, 8.422494, 1225.314330, 2024.168660, 1464.281496, 275.819908, 47.130183, ~
## $ nohs                        &lt;dbl&gt; 4.3, 5.1, 3.7, 4.8, 2.1, 0.0, 2.5, 7.7, 0.8, 8.6, 1.4, 19.2, 8.9, 6.4, 8.3, 2.2, 14.3, 9.7, 23.7, 6.8, 6.9, 3~
## $ somehs                      &lt;dbl&gt; 6.7, 10.4, 5.9, 11.5, 10.5, 0.0, 4.3, 7.5, 4.0, 13.9, 4.8, 25.4, 26.4, 9.5, 11.2, 11.8, 16.7, 17.4, 15.6, 17.~
## $ hs                          &lt;dbl&gt; 31.7, 40.3, 17.9, 47.3, 30.0, 0.0, 17.8, 21.7, 33.4, 33.4, 25.3, 26.5, 31.6, 26.2, 29.6, 46.8, 35.0, 29.7, 32~
## $ somecollege                 &lt;dbl&gt; 27.2, 24.1, 26.3, 20.0, 27.1, 0.0, 26.1, 26.0, 19.2, 18.1, 22.4, 20.0, 28.4, 26.2, 25.9, 19.0, 14.9, 37.4, 16~
## $ associate                   &lt;dbl&gt; 8.2, 7.4, 8.3, 3.1, 8.5, 71.4, 13.2, 7.6, 11.8, 11.0, 10.3, 5.4, 3.6, 4.3, 9.7, 6.5, 5.5, 0.6, 5.4, 5.0, 7.4,~
## $ bachelor                    &lt;dbl&gt; 15.0, 8.6, 20.2, 9.8, 14.2, 0.0, 23.4, 17.2, 20.9, 10.2, 25.2, 2.3, 1.1, 19.1, 9.4, 8.5, 7.9, 5.2, 5.1, 4.0, ~
## $ grad                        &lt;dbl&gt; 6.8, 4.2, 17.7, 3.5, 7.6, 28.6, 12.6, 12.3, 9.9, 4.8, 10.5, 1.1, 0.0, 8.4, 5.9, 5.2, 5.8, 0.0, 1.8, 1.3, 8.9,~
## $ pov                         &lt;dbl&gt; 13.500, 18.900, 6.700, 14.400, 12.500, 3.525, 5.900, 10.300, 5.300, 14.000, 5.800, 22.700, 59.400, 13.400, 14~
## $ hs_orless                   &lt;dbl&gt; 42.7, 55.8, 27.5, 63.6, 42.6, 0.0, 24.6, 36.9, 38.2, 55.9, 31.5, 71.1, 66.9, 42.1, 49.1, 60.8, 66.0, 56.8, 71~
## $ urc2006                     &lt;dbl&gt; 3, 6, 1, 5, 1, 1, 2, 1, 2, 6, 4, 4, 4, 4, 4, 2, 5, 3, 5, 4, 3, 5, 5, 1, 1, 1, 3, 3, 5, 2, 2, 1, 4, 3, 4, 2, 5~
## $ aod                         &lt;dbl&gt; 54.11111, 31.16667, 83.12500, 33.36364, 50.80000, 53.50000, 65.09091, 18.14286, 27.00000, 26.90909, 44.88889,~
## $ state_California            &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0~
## $ city_Not.in.a.city          &lt;dbl&gt; 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1~</code></pre>
<p>Compare this to our original data set</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="predictive-modeling-for-air-pollution.html#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(pm)</span></code></pre></div>
<pre><code>## Rows: 876
## Columns: 50
## $ id                          &lt;fct&gt; 1003.001, 1027.0001, 1033.1002, 1049.1003, 1055.001, 1069.0003, 1073.0023, 1073.1005, 1073.1009, 1073.101, 10~
## $ value                       &lt;dbl&gt; 9.597647, 10.800000, 11.212174, 11.659091, 12.375394, 10.508850, 15.591017, 12.399355, 11.103704, 13.114545, ~
## $ fips                        &lt;fct&gt; 1003, 1027, 1033, 1049, 1055, 1069, 1073, 1073, 1073, 1073, 1073, 1073, 1073, 1073, 1089, 1097, 1097, 1101, 1~
## $ lat                         &lt;dbl&gt; 30.49800, 33.28126, 34.75878, 34.28763, 33.99375, 31.22636, 33.55306, 33.33111, 33.45972, 33.54528, 33.49972,~
## $ lon                         &lt;dbl&gt; -87.88141, -85.80218, -87.65056, -85.96830, -85.99107, -85.39077, -86.81500, -87.00361, -87.30556, -86.54917,~
## $ state                       &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Alabama",~
## $ county                      &lt;chr&gt; "Baldwin", "Clay", "Colbert", "DeKalb", "Etowah", "Houston", "Jefferson", "Jefferson", "Jefferson", "Jefferso~
## $ city                        &lt;chr&gt; "In a city", "In a city", "In a city", "In a city", "In a city", "In a city", "In a city", "Not in a city", "~
## $ cmaq                        &lt;dbl&gt; 8.098836, 9.766208, 9.402679, 8.534772, 9.241744, 9.121892, 10.235612, 10.235612, 8.161789, 9.303766, 10.2356~
## $ zcta                        &lt;fct&gt; 36532, 36251, 35660, 35962, 35901, 36303, 35207, 35111, 35444, 35094, 35064, 35244, 35126, 35180, 35802, 3661~
## $ zcta_area                   &lt;dbl&gt; 190980522, 374132430, 16716984, 203836235, 154069359, 162685124, 26929603, 166239542, 385566685, 148994881, 1~
## $ zcta_pop                    &lt;dbl&gt; 27829, 5103, 9042, 8300, 20045, 30217, 9010, 16140, 3699, 14212, 11458, 32390, 21725, 13794, 21297, 6106, 246~
## $ imp_a500                    &lt;dbl&gt; 0.01730104, 1.96972318, 19.17301038, 5.78200692, 16.49307958, 19.13927336, 41.83304498, 1.69765343, 0.0000000~
## $ imp_a1000                   &lt;dbl&gt; 1.40960208, 0.85315744, 11.14489619, 3.86764706, 11.09645329, 16.67149654, 41.03200692, 3.98239278, 0.0291955~
## $ imp_a5000                   &lt;dbl&gt; 3.33601181, 0.98514787, 15.17861538, 1.23114143, 14.67778782, 16.38548211, 36.00406256, 6.02132173, 0.1398356~
## $ imp_a10000                  &lt;dbl&gt; 1.9879187, 0.5208189, 9.7253870, 1.0316469, 8.2200785, 8.0739624, 23.1790413, 4.5567731, 0.1474968, 2.6970796~
## $ imp_a15000                  &lt;dbl&gt; 1.4386207, 0.3359198, 5.2472094, 0.9730444, 5.1612102, 4.7401296, 17.4524844, 4.3006226, 0.1623359, 2.9956557~
## $ county_area                 &lt;dbl&gt; 4117521611, 1564252280, 1534877333, 2012662359, 1385618994, 1501737720, 2878192209, 2878192209, 3423328940, 2~
## $ county_pop                  &lt;dbl&gt; 182265, 13932, 54428, 71109, 104430, 101547, 658466, 658466, 194656, 658466, 658466, 658466, 658466, 658466, ~
## $ log_dist_to_prisec          &lt;dbl&gt; 4.648181, 7.219907, 5.760131, 3.721489, 5.261457, 7.112373, 6.600958, 6.526896, 9.789557, 7.301545, 3.972137,~
## $ log_pri_length_5000         &lt;dbl&gt; 8.517193, 8.517193, 8.517193, 8.517193, 9.066563, 8.517193, 11.156977, 10.915066, 8.517193, 9.683336, 10.7323~
## $ log_pri_length_10000        &lt;dbl&gt; 9.210340, 9.210340, 9.274303, 10.409411, 11.137360, 9.210340, 11.849658, 11.728685, 9.210340, 10.763385, 11.6~
## $ log_pri_length_15000        &lt;dbl&gt; 9.630228, 9.615805, 9.658899, 11.173626, 11.587258, 9.615805, 12.401245, 12.230208, 9.615805, 11.615710, 12.1~
## $ log_pri_length_25000        &lt;dbl&gt; 11.32735, 10.12663, 10.15769, 11.90959, 12.01356, 10.12663, 12.98762, 12.86472, 10.12663, 12.53777, 12.97635,~
## $ log_prisec_length_500       &lt;dbl&gt; 7.295356, 6.214608, 8.611945, 7.310155, 8.740680, 6.214608, 6.214608, 6.214608, 6.214608, 6.214608, 8.385759,~
## $ log_prisec_length_1000      &lt;dbl&gt; 8.195119, 7.600902, 9.735569, 8.585843, 9.627898, 7.600902, 9.075921, 8.949239, 7.600902, 7.600902, 9.204951,~
## $ log_prisec_length_5000      &lt;dbl&gt; 10.815042, 10.170878, 11.770407, 10.214200, 11.728889, 12.298627, 12.281645, 11.039001, 8.517193, 11.262645, ~
## $ log_prisec_length_10000     &lt;dbl&gt; 11.886803, 11.405543, 12.840663, 11.508944, 12.768279, 12.994141, 13.278416, 12.128956, 9.210340, 12.141008, ~
## $ log_prisec_length_15000     &lt;dbl&gt; 12.205723, 12.042963, 13.282656, 12.353663, 13.189489, 13.326132, 13.826365, 12.753045, 9.615805, 12.851710, ~
## $ log_prisec_length_25000     &lt;dbl&gt; 13.41395, 12.79980, 13.79973, 13.55979, 13.70026, 13.85550, 14.45221, 13.80017, 11.89377, 14.08915, 14.32725,~
## $ log_nei_2008_pm25_sum_10000 &lt;dbl&gt; 0.318035438, 3.218632928, 6.573127301, 0.000000000, 3.772775514, 0.909136688, 7.987614168, 5.412954990, 0.002~
## $ log_nei_2008_pm25_sum_15000 &lt;dbl&gt; 1.967358961, 3.218632928, 6.581917457, 3.282789151, 3.785646441, 3.174609213, 8.438952213, 6.643477321, 0.002~
## $ log_nei_2008_pm25_sum_25000 &lt;dbl&gt; 5.0673081, 3.2186329, 6.8758996, 4.8876655, 4.1605064, 3.1900077, 8.6510684, 7.8067729, 6.3623285, 7.3020666,~
## $ log_nei_2008_pm10_sum_10000 &lt;dbl&gt; 1.35588511, 3.31111648, 6.69187313, 0.00000000, 4.43719884, 0.92888890, 8.20975958, 5.77118113, 0.01654963, 6~
## $ log_nei_2008_pm10_sum_15000 &lt;dbl&gt; 2.26783411, 3.31111648, 6.70127741, 3.35004443, 4.46267932, 3.67473904, 8.64883455, 6.86889676, 0.01654963, 6~
## $ log_nei_2008_pm10_sum_25000 &lt;dbl&gt; 5.6287284, 3.3111165, 7.1488584, 5.1719202, 4.6783110, 3.7446287, 8.8580191, 8.0210715, 6.8919916, 7.5490587,~
## $ popdens_county              &lt;dbl&gt; 44.265706, 8.906492, 35.460814, 35.330814, 75.367038, 67.619664, 228.777633, 228.777633, 56.861611, 228.77763~
## $ popdens_zcta                &lt;dbl&gt; 145.7164307, 13.6395554, 540.8870404, 40.7189625, 130.1037411, 185.7391706, 334.5760426, 97.0888142, 9.593671~
## $ nohs                        &lt;dbl&gt; 3.300, 11.600, 7.300, 14.300, 4.300, 5.800, 7.100, 2.700, 11.100, 7.200, 2.700, 0.800, 2.800, 9.700, 1.200, 3~
## $ somehs                      &lt;dbl&gt; 4.900, 19.100, 15.800, 16.700, 13.300, 11.600, 17.100, 6.600, 11.600, 12.200, 9.800, 2.600, 8.200, 21.600, 3.~
## $ hs                          &lt;dbl&gt; 25.10, 33.90, 30.60, 35.00, 27.80, 29.80, 37.20, 30.70, 46.00, 32.20, 28.80, 12.90, 32.00, 39.30, 15.10, 39.0~
## $ somecollege                 &lt;dbl&gt; 19.700, 18.800, 20.900, 14.900, 29.200, 21.400, 23.500, 25.700, 17.200, 19.000, 26.300, 17.900, 28.900, 21.60~
## $ associate                   &lt;dbl&gt; 8.20, 8.00, 7.60, 5.50, 10.10, 7.90, 7.30, 8.00, 4.10, 6.80, 12.40, 5.20, 7.40, 5.20, 6.50, 6.60, 8.30, 4.60,~
## $ bachelor                    &lt;dbl&gt; 25.3, 5.5, 12.7, 7.9, 10.0, 13.7, 5.9, 17.6, 7.1, 14.8, 11.6, 35.5, 13.5, 2.2, 30.4, 7.8, 8.3, 7.6, 18.2, 9.5~
## $ grad                        &lt;dbl&gt; 13.500, 3.100, 5.100, 5.800, 5.400, 9.800, 2.000, 8.700, 2.900, 7.700, 8.300, 25.200, 7.100, 0.400, 23.300, 4~
## $ pov                         &lt;dbl&gt; 6.100, 19.500, 19.000, 13.800, 8.800, 15.600, 25.500, 7.300, 8.100, 10.500, 18.100, 2.100, 5.100, 13.300, 5.2~
## $ hs_orless                   &lt;dbl&gt; 33.30, 64.60, 53.70, 66.00, 45.40, 47.20, 61.40, 40.00, 68.70, 51.60, 41.30, 16.30, 43.00, 70.60, 19.40, 59.1~
## $ urc2013                     &lt;dbl&gt; 4, 6, 4, 6, 4, 4, 1, 1, 1, 1, 1, 1, 1, 2, 3, 3, 3, 3, 4, 3, 1, 5, 4, 2, 6, 4, 4, 1, 1, 1, 1, 1, 4, 3, 3, 2, 2~
## $ urc2006                     &lt;dbl&gt; 5, 6, 4, 5, 4, 4, 1, 1, 1, 1, 1, 1, 1, 2, 3, 3, 3, 3, 4, 3, 1, 5, 4, 2, 6, 5, 4, 1, 1, 1, 1, 1, 5, 3, 3, 2, 2~
## $ aod                         &lt;dbl&gt; 37.363636, 34.818182, 36.000000, 33.083333, 43.416667, 33.000000, 39.583333, 38.750000, 40.363636, 42.454545,~</code></pre>
<div id="ques:air-poll-14" class="question">
<p class="question-begin">
► Question 23.14
</p>
<div class="question-body">
<p>Compare the two outputs and see what has changes - pay specific attention to the number of variables, data types. How many predictor variables do we have?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-65" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-65', 'sol-start-65')"></span>
</p>
<div id="sol-body-65" class="solution-body" style="display: none;">
<p>We have 36 variables instead of 50 - two are now ID variables, one is the outcome variable leaving us with 33 predictor variables.
We no longer have categorical variables (e.g. state), and state_California is the only state identifier that does not have nonzero variance</p>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p><strong>Step 3: Extract the pre-processed testing data using <code>bake()</code></strong></p>
<p>We’ve extracted the training data set but we can also apply the recipe we designed to our test data set to check for any issues (e.g. introduction of NA values).</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="predictive-modeling-for-air-pollution.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract test data set</span></span>
<span id="cb537-2"><a href="predictive-modeling-for-air-pollution.html#cb537-2" aria-hidden="true" tabindex="-1"></a>baked_test_pm <span class="ot">&lt;-</span> <span class="fu">bake</span>(prepped_rec, <span class="at">new_data =</span> test_pm)</span>
<span id="cb537-3"><a href="predictive-modeling-for-air-pollution.html#cb537-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-4"><a href="predictive-modeling-for-air-pollution.html#cb537-4" aria-hidden="true" tabindex="-1"></a><span class="co"># compare effect</span></span>
<span id="cb537-5"><a href="predictive-modeling-for-air-pollution.html#cb537-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(baked_test_pm)</span></code></pre></div>
<pre><code>## Rows: 292
## Columns: 38
## $ id                          &lt;fct&gt; 1033.1002, 1055.001, 1069.0003, 1073.0023, 1073.1005, 1073.1009, 1073.5003, 1097.0003, 1101.0007, 1113.0001, ~
## $ value                       &lt;dbl&gt; 11.212174, 12.375394, 10.508850, 15.591017, 12.399355, 11.103704, 11.775000, 10.032110, 11.997867, 13.163146,~
## $ fips                        &lt;fct&gt; 1033, 1055, 1069, 1073, 1073, 1073, 1073, 1097, 1101, 1113, 1127, 4003, 4005, 4013, 4015, 4021, 5001, 5035, 5~
## $ lat                         &lt;dbl&gt; 34.75878, 33.99375, 31.22636, 33.55306, 33.33111, 33.45972, 33.80167, 30.76994, 32.42583, 32.47220, 33.83278,~
## $ lon                         &lt;dbl&gt; -87.65056, -85.99107, -85.39077, -86.81500, -87.00361, -87.30556, -86.94250, -88.08753, -86.28528, -85.00510,~
## $ cmaq                        &lt;dbl&gt; 9.402679, 9.241744, 9.121892, 10.235612, 10.235612, 8.161789, 8.816101, 8.654895, 10.219433, 9.774144, 8.1401~
## $ zcta_area                   &lt;dbl&gt; 16716984, 154069359, 162685124, 26929603, 166239542, 385566685, 230081840, 12304398, 76743399, 11526212, 1293~
## $ zcta_pop                    &lt;dbl&gt; 9042, 20045, 30217, 9010, 16140, 3699, 13794, 6106, 12997, 8638, 10424, 1021, 6362, 25042, 224, 21219, 10736,~
## $ imp_a500                    &lt;dbl&gt; 19.17301038, 16.49307958, 19.13927336, 41.83304498, 1.69765343, 0.00000000, 0.41608997, 4.41522491, 14.544982~
## $ imp_a15000                  &lt;dbl&gt; 5.2472094, 5.1612102, 4.7401296, 17.4524844, 4.3006226, 0.1623359, 0.9481135, 7.7170777, 10.9185636, 11.11534~
## $ county_area                 &lt;dbl&gt; 1534877333, 1385618994, 1501737720, 2878192209, 2878192209, 3423328940, 2878192209, 3184223082, 2031190777, 5~
## $ county_pop                  &lt;dbl&gt; 54428, 104430, 101547, 658466, 658466, 194656, 658466, 412992, 229363, 189885, 67023, 131346, 134421, 3817117~
## $ log_dist_to_prisec          &lt;dbl&gt; 5.760131, 5.261457, 7.112373, 6.600958, 6.526896, 9.789557, 8.734821, 5.779170, 7.187640, 5.522936, 7.041732,~
## $ log_pri_length_5000         &lt;dbl&gt; 8.517193, 9.066563, 8.517193, 11.156977, 10.915066, 8.517193, 8.517193, 10.364272, 9.623936, 8.517193, 8.5171~
## $ log_pri_length_25000        &lt;dbl&gt; 10.15769, 12.01356, 10.12663, 12.98762, 12.86472, 10.12663, 11.85793, 12.23758, 12.12632, 12.05099, 10.12663,~
## $ log_prisec_length_500       &lt;dbl&gt; 8.611945, 8.740680, 6.214608, 6.214608, 6.214608, 6.214608, 6.214608, 7.595229, 6.214608, 8.320842, 6.214608,~
## $ log_prisec_length_1000      &lt;dbl&gt; 9.735569, 9.627898, 7.600902, 9.075921, 8.949239, 7.600902, 7.600902, 8.658654, 7.600902, 9.324509, 7.600902,~
## $ log_prisec_length_5000      &lt;dbl&gt; 11.770407, 11.728889, 12.298627, 12.281645, 11.039001, 8.517193, 8.517193, 11.748979, 11.473810, 12.265658, 1~
## $ log_prisec_length_10000     &lt;dbl&gt; 12.840663, 12.768279, 12.994141, 13.278416, 12.128956, 9.210340, 10.420770, 12.793503, 12.818512, 13.232356, ~
## $ log_prisec_length_25000     &lt;dbl&gt; 13.79973, 13.70026, 13.85550, 14.45221, 13.80017, 11.89377, 13.34258, 13.90072, 14.10779, 14.16990, 13.10635,~
## $ log_nei_2008_pm10_sum_10000 &lt;dbl&gt; 6.69187313, 4.43719884, 0.92888890, 8.20975958, 5.77118113, 0.01654963, 0.00000000, 6.23090582, 3.93908358, 5~
## $ log_nei_2008_pm10_sum_15000 &lt;dbl&gt; 6.70127741, 4.46267932, 3.67473904, 8.64883455, 6.86889676, 0.01654963, 4.01669504, 6.42789031, 4.22931514, 5~
## $ log_nei_2008_pm10_sum_25000 &lt;dbl&gt; 7.148858, 4.678311, 3.744629, 8.858019, 8.021072, 6.891992, 6.961580, 6.640326, 7.331327, 5.786267, 6.613947,~
## $ popdens_county              &lt;dbl&gt; 35.4608142, 75.3670384, 67.6196640, 228.7776327, 228.7776327, 56.8616114, 228.7776327, 129.6994555, 112.92046~
## $ popdens_zcta                &lt;dbl&gt; 540.8870404, 130.1037411, 185.7391706, 334.5760426, 97.0888142, 9.5936712, 59.9525803, 496.2453263, 169.35658~
## $ nohs                        &lt;dbl&gt; 7.30, 4.30, 5.80, 7.10, 2.70, 11.10, 9.70, 3.00, 8.80, 8.60, 5.70, 32.70, 1.70, 23.90, 8.60, 3.20, 5.40, 3.60~
## $ somehs                      &lt;dbl&gt; 15.80, 13.30, 11.60, 17.10, 6.60, 11.60, 21.60, 17.10, 19.30, 24.60, 14.30, 11.80, 0.00, 17.40, 27.00, 6.50, ~
## $ hs                          &lt;dbl&gt; 30.60, 27.80, 29.80, 37.20, 30.70, 46.00, 39.30, 39.00, 36.00, 27.70, 37.60, 45.00, 22.30, 27.30, 35.20, 32.1~
## $ somecollege                 &lt;dbl&gt; 20.9, 29.2, 21.4, 23.5, 25.7, 17.2, 21.6, 22.4, 20.2, 19.4, 21.3, 7.9, 36.4, 20.8, 21.0, 30.3, 21.3, 28.2, 21~
## $ associate                   &lt;dbl&gt; 7.60, 10.10, 7.90, 7.30, 8.00, 4.10, 5.20, 6.60, 4.60, 4.30, 7.30, 2.60, 14.70, 4.30, 4.90, 10.20, 5.90, 5.40~
## $ bachelor                    &lt;dbl&gt; 12.70, 10.00, 13.70, 5.90, 17.60, 7.10, 2.20, 7.80, 7.60, 9.50, 10.30, 0.00, 13.60, 4.20, 2.70, 12.30, 8.10, ~
## $ grad                        &lt;dbl&gt; 5.100, 5.400, 9.800, 2.000, 8.700, 2.900, 0.400, 4.200, 3.500, 5.900, 3.500, 0.000, 11.400, 2.000, 0.600, 5.4~
## $ pov                         &lt;dbl&gt; 19.000, 8.800, 15.600, 25.500, 7.300, 8.100, 13.300, 23.200, 23.000, 37.700, 19.300, 15.600, 64.300, 29.500, ~
## $ hs_orless                   &lt;dbl&gt; 53.70, 45.40, 47.20, 61.40, 40.00, 68.70, 70.60, 59.10, 64.10, 60.90, 57.60, 89.50, 24.00, 68.60, 70.80, 41.8~
## $ urc2006                     &lt;dbl&gt; 4, 4, 4, 1, 1, 1, 2, 3, 3, 3, 2, 5, 4, 1, 5, 2, 6, 2, 4, 6, 5, 5, 3, 3, 6, 3, 5, 5, 4, 5, 3, 5, 1, 1, 1, 1, 4~
## $ aod                         &lt;dbl&gt; 36.000000, 43.416667, 33.000000, 39.583333, 38.750000, 40.363636, 42.636364, 42.000000, 39.500000, 31.250000,~
## $ state_California            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~
## $ city_Not.in.a.city          &lt;dbl&gt; 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~</code></pre>
</div>
<div id="specify-the-model" class="section level3" number="23.4.4">
<h3>
<span class="header-section-number">23.4.4</span> Specify the model<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('specify-the-model')" onmouseout="reset_tooltip('specify-the-model-tooltip')"><span class="tooltiptext" id="specify-the-model-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Quick reminder of where we are at in the process - here are the steps we’ve taken so far:</p>
<ul>
<li>acquire data set with outcome variable and set of predictor variables</li>
<li>split data set into training and testing sets using <code>rsample</code> package</li>
<li>assign variable types, specify and prep pre-processing and extract our pre-processed data sets using <code>recipes</code> packages.</li>
</ul>
<p>Now it’s to time actually specify our model. The <code>tidymodels</code> package to do this is called <code>parsnip</code>.</p>
<p>There are four things we need to specify about our model</p>
<ol style="list-style-type: decimal">
<li>The <strong>model type</strong>, e.g. a linear regression as we have done previously, here we will use a random forest approach</li>
<li>The <strong>engine</strong> (underlying function/package) to implement the selected model type, e.g. previously we have used <code>lm</code> as our engine to perform a linear regression</li>
<li>The <strong>mode</strong> of learning, so far we’ve never explicitly specified this, typically this would be a classification or regression.</li>
<li>Additional <strong>arguments</strong> specific to the specified model or package</li>
</ol>
<p><strong>Step 1: Specify the model type</strong></p>
<p>Let’s start by specifying the model type as a linear regression</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="predictive-modeling-for-air-pollution.html#cb539-1" aria-hidden="true" tabindex="-1"></a>lm_PM <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="co"># specify model type</span></span></code></pre></div>
<p><strong>Step 2: Specify the engine</strong></p>
<p>We want to use the ordinary least squares method to fit our linear regression. There are multiple implementations in various packages so we need to tell <code>parsnip</code> exactly which function/package to implement.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="predictive-modeling-for-air-pollution.html#cb540-1" aria-hidden="true" tabindex="-1"></a>lm_PM <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span> <span class="co"># specify model type</span></span>
<span id="cb540-2"><a href="predictive-modeling-for-air-pollution.html#cb540-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>)        <span class="co"># set engine</span></span></code></pre></div>
<p><strong>Step 3: Specify mode of learning</strong></p>
<p>Some packages can do both classifications and prediction, so we should explicitly specify the mode, in this case we want to perform a regression.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="predictive-modeling-for-air-pollution.html#cb541-1" aria-hidden="true" tabindex="-1"></a>lm_PM <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span> <span class="co"># specify model type</span></span>
<span id="cb541-2"><a href="predictive-modeling-for-air-pollution.html#cb541-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">%&gt;%</span>    <span class="co"># set engine</span></span>
<span id="cb541-3"><a href="predictive-modeling-for-air-pollution.html#cb541-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)  <span class="co"># set mode</span></span></code></pre></div>
</div>
<div id="fit-the-model" class="section level3" number="23.4.5">
<h3>
<span class="header-section-number">23.4.5</span> Fit the model<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('fit-the-model')" onmouseout="reset_tooltip('fit-the-model-tooltip')"><span class="tooltiptext" id="fit-the-model-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Now we’re ready to actually fit the model.</p>
<p>We are going to use the package <code>workflows</code> to keep track of the pre-processing steps and model specification. You probably realized that it is easy to lose track of all the individual steps additionally, down the line this will help us during the optimization process because we will be able automate steps, and it will be straightforward to add post-processing operations.</p>
<p>Let’s create our workflow which will incorporate our recipe for pre-processing and the model we just specified<label for="tufte-sn-145" class="margin-toggle sidenote-number">145</label><input type="checkbox" id="tufte-sn-145" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">145</span> We did use <code>prep()</code> to take a look at our data set during pre-processing, but it actually is not a necessary step</span>.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="predictive-modeling-for-air-pollution.html#cb542-1" aria-hidden="true" tabindex="-1"></a>PM_wflow <span class="ot">&lt;-</span>workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb542-2"><a href="predictive-modeling-for-air-pollution.html#cb542-2" aria-hidden="true" tabindex="-1"></a>           workflows<span class="sc">::</span><span class="fu">add_recipe</span>(simple_rec) <span class="sc">%&gt;%</span></span>
<span id="cb542-3"><a href="predictive-modeling-for-air-pollution.html#cb542-3" aria-hidden="true" tabindex="-1"></a>           workflows<span class="sc">::</span><span class="fu">add_model</span>(lm_PM)</span></code></pre></div>
<p>We can call up the workflow to get an overview of our model fitting process including our pre-processing steps and model specifications.:</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="predictive-modeling-for-air-pollution.html#cb543-1" aria-hidden="true" tabindex="-1"></a>PM_wflow</span></code></pre></div>
<pre><code>## == Workflow =======================================================================================================================================
## Preprocessor: Recipe
## Model: linear_reg()
## 
## -- Preprocessor -----------------------------------------------------------------------------------------------------------------------------------
## 3 Recipe Steps
## 
## * step_dummy()
## * step_corr()
## * step_nzv()
## 
## -- Model ------------------------------------------------------------------------------------------------------------------------------------------
## Linear Regression Model Specification (regression)
## 
## Computational engine: lm</code></pre>
<p>After all of that, we are now ready to “prepare the recipe,” i.e. we will estimate the parameters to fit the model to our full training data set using <code>parsnip::fit()</code>.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="predictive-modeling-for-air-pollution.html#cb545-1" aria-hidden="true" tabindex="-1"></a>PM_wflow_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(PM_wflow, <span class="at">data =</span> train_pm)</span></code></pre></div>
</div>
<div id="assessing-the-model" class="section level3" number="23.4.6">
<h3>
<span class="header-section-number">23.4.6</span> Assessing the model<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('assessing-the-model')" onmouseout="reset_tooltip('assessing-the-model-tooltip')"><span class="tooltiptext" id="assessing-the-model-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Let’s take a look at our fitted model<label for="tufte-sn-146" class="margin-toggle sidenote-number">146</label><input type="checkbox" id="tufte-sn-146" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">146</span> Because we used a workflow, we will first have to extract the fitted model from the workflow and then we can use <code>broom::tidy()</code> to look at the summary table you are already familiar with</span>.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="predictive-modeling-for-air-pollution.html#cb546-1" aria-hidden="true" tabindex="-1"></a>wflowoutput <span class="ot">&lt;-</span> PM_wflow_fit <span class="sc">%&gt;%</span> </span>
<span id="cb546-2"><a href="predictive-modeling-for-air-pollution.html#cb546-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb546-3"><a href="predictive-modeling-for-air-pollution.html#cb546-3" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb546-4"><a href="predictive-modeling-for-air-pollution.html#cb546-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-5"><a href="predictive-modeling-for-air-pollution.html#cb546-5" aria-hidden="true" tabindex="-1"></a>wflowoutput <span class="sc">%&gt;%</span></span>
<span id="cb546-6"><a href="predictive-modeling-for-air-pollution.html#cb546-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">293.5614329</td>
<td align="right">117.8588640</td>
<td align="right">2.4907879</td>
<td align="right">0.0130404</td>
</tr>
<tr class="even">
<td align="left">lat</td>
<td align="right">0.0326138</td>
<td align="right">0.0227789</td>
<td align="right">1.4317588</td>
<td align="right">0.1527819</td>
</tr>
<tr class="odd">
<td align="left">lon</td>
<td align="right">0.0158646</td>
<td align="right">0.0100543</td>
<td align="right">1.5778993</td>
<td align="right">0.1151647</td>
</tr>
<tr class="even">
<td align="left">cmaq</td>
<td align="right">0.2462656</td>
<td align="right">0.0396922</td>
<td align="right">6.2043858</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">zcta_area</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">-2.1503468</td>
<td align="right">0.0319638</td>
</tr>
<tr class="even">
<td align="left">zcta_pop</td>
<td align="right">0.0000101</td>
<td align="right">0.0000053</td>
<td align="right">1.9011310</td>
<td align="right">0.0578082</td>
</tr>
<tr class="odd">
<td align="left">imp_a500</td>
<td align="right">0.0050639</td>
<td align="right">0.0074193</td>
<td align="right">0.6825402</td>
<td align="right">0.4951853</td>
</tr>
<tr class="even">
<td align="left">imp_a15000</td>
<td align="right">-0.0030659</td>
<td align="right">0.0116454</td>
<td align="right">-0.2632746</td>
<td align="right">0.7924377</td>
</tr>
<tr class="odd">
<td align="left">county_area</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">-1.1820506</td>
<td align="right">0.2376974</td>
</tr>
<tr class="even">
<td align="left">county_pop</td>
<td align="right">-0.0000001</td>
<td align="right">0.0000001</td>
<td align="right">-0.8153865</td>
<td align="right">0.4152047</td>
</tr>
<tr class="odd">
<td align="left">log_dist_to_prisec</td>
<td align="right">0.0621405</td>
<td align="right">0.1186431</td>
<td align="right">0.5237604</td>
<td align="right">0.6006566</td>
</tr>
<tr class="even">
<td align="left">log_pri_length_5000</td>
<td align="right">-0.2006208</td>
<td align="right">0.1369828</td>
<td align="right">-1.4645700</td>
<td align="right">0.1436107</td>
</tr>
<tr class="odd">
<td align="left">log_pri_length_25000</td>
<td align="right">-0.0541120</td>
<td align="right">0.1635912</td>
<td align="right">-0.3307759</td>
<td align="right">0.7409399</td>
</tr>
<tr class="even">
<td align="left">log_prisec_length_500</td>
<td align="right">0.2204286</td>
<td align="right">0.1815609</td>
<td align="right">1.2140753</td>
<td align="right">0.2252410</td>
</tr>
<tr class="odd">
<td align="left">log_prisec_length_1000</td>
<td align="right">0.1153648</td>
<td align="right">0.2065246</td>
<td align="right">0.5586009</td>
<td align="right">0.5766619</td>
</tr>
<tr class="even">
<td align="left">log_prisec_length_5000</td>
<td align="right">0.2374483</td>
<td align="right">0.3008703</td>
<td align="right">0.7892050</td>
<td align="right">0.4303329</td>
</tr>
<tr class="odd">
<td align="left">log_prisec_length_10000</td>
<td align="right">-0.0343581</td>
<td align="right">0.4192387</td>
<td align="right">-0.0819534</td>
<td align="right">0.9347136</td>
</tr>
<tr class="even">
<td align="left">log_prisec_length_25000</td>
<td align="right">0.5223804</td>
<td align="right">0.3660985</td>
<td align="right">1.4268849</td>
<td align="right">0.1541815</td>
</tr>
<tr class="odd">
<td align="left">log_nei_2008_pm10_sum_10000</td>
<td align="right">0.1829265</td>
<td align="right">0.0800488</td>
<td align="right">2.2851883</td>
<td align="right">0.0226822</td>
</tr>
<tr class="even">
<td align="left">log_nei_2008_pm10_sum_15000</td>
<td align="right">-0.0235537</td>
<td align="right">0.1112343</td>
<td align="right">-0.2117486</td>
<td align="right">0.8323818</td>
</tr>
<tr class="odd">
<td align="left">log_nei_2008_pm10_sum_25000</td>
<td align="right">0.0240310</td>
<td align="right">0.0957173</td>
<td align="right">0.2510627</td>
<td align="right">0.8018596</td>
</tr>
<tr class="even">
<td align="left">popdens_county</td>
<td align="right">0.0000220</td>
<td align="right">0.0000606</td>
<td align="right">0.3635762</td>
<td align="right">0.7163145</td>
</tr>
<tr class="odd">
<td align="left">popdens_zcta</td>
<td align="right">-0.0000021</td>
<td align="right">0.0000390</td>
<td align="right">-0.0546538</td>
<td align="right">0.9564342</td>
</tr>
<tr class="even">
<td align="left">nohs</td>
<td align="right">-2.9830391</td>
<td align="right">1.1782820</td>
<td align="right">-2.5316851</td>
<td align="right">0.0116294</td>
</tr>
<tr class="odd">
<td align="left">somehs</td>
<td align="right">-2.9555131</td>
<td align="right">1.1788726</td>
<td align="right">-2.5070676</td>
<td align="right">0.0124615</td>
</tr>
<tr class="even">
<td align="left">hs</td>
<td align="right">-2.9619625</td>
<td align="right">1.1779690</td>
<td align="right">-2.5144657</td>
<td align="right">0.0122061</td>
</tr>
<tr class="odd">
<td align="left">somecollege</td>
<td align="right">-2.9670564</td>
<td align="right">1.1775295</td>
<td align="right">-2.5197301</td>
<td align="right">0.0120271</td>
</tr>
<tr class="even">
<td align="left">associate</td>
<td align="right">-2.9985202</td>
<td align="right">1.1778801</td>
<td align="right">-2.5456923</td>
<td align="right">0.0111784</td>
</tr>
<tr class="odd">
<td align="left">bachelor</td>
<td align="right">-2.9793979</td>
<td align="right">1.1778070</td>
<td align="right">-2.5296147</td>
<td align="right">0.0116974</td>
</tr>
<tr class="even">
<td align="left">grad</td>
<td align="right">-2.9781316</td>
<td align="right">1.1785618</td>
<td align="right">-2.5269202</td>
<td align="right">0.0117865</td>
</tr>
<tr class="odd">
<td align="left">pov</td>
<td align="right">0.0018587</td>
<td align="right">0.0103863</td>
<td align="right">0.1789620</td>
<td align="right">0.8580335</td>
</tr>
<tr class="even">
<td align="left">hs_orless</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">urc2006</td>
<td align="right">0.2577311</td>
<td align="right">0.1003245</td>
<td align="right">2.5689747</td>
<td align="right">0.0104630</td>
</tr>
<tr class="even">
<td align="left">aod</td>
<td align="right">0.0153540</td>
<td align="right">0.0060164</td>
<td align="right">2.5520176</td>
<td align="right">0.0109798</td>
</tr>
<tr class="odd">
<td align="left">state_California</td>
<td align="right">3.1138340</td>
<td align="right">0.4220360</td>
<td align="right">7.3781246</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">city_Not.in.a.city</td>
<td align="right">-0.0425040</td>
<td align="right">0.3265026</td>
<td align="right">-0.1301796</td>
<td align="right">0.8964720</td>
</tr>
</tbody>
</table>
<p>With models that have this many predictor values it can be helpful to understand which are the most important (i.e. have the strongest predictive value).</p>
<p>The function <code>vip::vip()</code> creates a barplot comparing the variable importance scores for each predictor variable ordered from most important.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="predictive-modeling-for-air-pollution.html#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pull top 10 most important variables</span></span>
<span id="cb547-2"><a href="predictive-modeling-for-air-pollution.html#cb547-2" aria-hidden="true" tabindex="-1"></a>PM_wflow_fit <span class="sc">%&gt;%</span> </span>
<span id="cb547-3"><a href="predictive-modeling-for-air-pollution.html#cb547-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb547-4"><a href="predictive-modeling-for-air-pollution.html#cb547-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">10</span>)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-460"></span>
<p class="caption marginnote shownote">
Figure 23.9: Top 10 variables with strongest impact on the model.
</p>
<img src="_main_files/figure-html/unnamed-chunk-460-1.png" alt="Top 10 variables with strongest impact on the model." width="672">
</div>
<div id="ques:air-poll-15" class="question">
<p class="question-begin">
► Question 23.15
</p>
<div class="question-body">
<p>What are the most important predictor variables for this model?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
</div>
<div id="evaluate-model-performance" class="section level3" number="23.4.7">
<h3>
<span class="header-section-number">23.4.7</span> Evaluate model performance<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('evaluate-model-performance')" onmouseout="reset_tooltip('evaluate-model-performance-tooltip')"><span class="tooltiptext" id="evaluate-model-performance-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Now that we have a fitted model we need to determine how well our model actually performs. The way to do this is to compare the similarity of predicted estimates and observed values of the outcome variable<label for="tufte-sn-147" class="margin-toggle sidenote-number">147</label><input type="checkbox" id="tufte-sn-147" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">147</span> Recall, that a machine learning optimization problem tires to minimize the distance between the predicted outcome <span class="math inline">\(\hat{Y} = f(X)\)</span> and actual outcome <span class="math inline">\(Y\)</span> using the predictor variables <span class="math inline">\(X\)</span> as input for our function <span class="math inline">\(f\)</span> that we want to estimate.</span>.</p>
<p>We can use the function <code>broom::augment()</code> to pull the observed and fitted values from our workflow.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="predictive-modeling-for-air-pollution.html#cb548-1" aria-hidden="true" tabindex="-1"></a>fit_PM <span class="ot">&lt;-</span> PM_wflow_fit <span class="sc">%&gt;%</span></span>
<span id="cb548-2"><a href="predictive-modeling-for-air-pollution.html#cb548-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>()</span>
<span id="cb548-3"><a href="predictive-modeling-for-air-pollution.html#cb548-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-4"><a href="predictive-modeling-for-air-pollution.html#cb548-4" aria-hidden="true" tabindex="-1"></a>fit_PM <span class="ot">&lt;-</span> <span class="fu">augment</span>(fit_PM<span class="sc">$</span>fit, <span class="at">data =</span> baked_train) <span class="sc">%&gt;%</span></span>
<span id="cb548-5"><a href="predictive-modeling-for-air-pollution.html#cb548-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value, .fitted<span class="sc">:</span>.std.resid)</span>
<span id="cb548-6"><a href="predictive-modeling-for-air-pollution.html#cb548-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-7"><a href="predictive-modeling-for-air-pollution.html#cb548-7" aria-hidden="true" tabindex="-1"></a>fit_PM</span></code></pre></div>
<pre><code>## # A tibble: 584 x 6
##    value .fitted   .hat .sigma   .cooksd .std.resid
##    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 11.7    12.2  0.0370   2.05 0.0000648     -0.243
##  2  6.96    9.14 0.0496   2.05 0.00179       -1.09 
##  3 13.3    12.6  0.0484   2.05 0.000151       0.322
##  4 10.7    10.4  0.0502   2.05 0.0000504      0.183
##  5 14.5    11.9  0.0243   2.05 0.00113        1.26 
##  6 12.2     9.52 0.476    2.04 0.0850         1.81 
##  7 11.2    12.6  0.0541   2.05 0.000792      -0.696
##  8  6.98   10.3  0.0586   2.04 0.00495       -1.67 
##  9  6.61    8.74 0.0690   2.05 0.00247       -1.08 
## 10 11.6    10.0  0.0283   2.05 0.000522       0.792
## # ... with 574 more rows</code></pre>
<p>Let’s compare the fitted (predicted) outcome values (fitted values) <span class="math inline">\(\hat{Y}\)</span> to the observed outcome values <span class="math inline">\(Y\)</span>.</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="predictive-modeling-for-air-pollution.html#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fit_PM, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb550-2"><a href="predictive-modeling-for-air-pollution.html#cb550-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb550-3"><a href="predictive-modeling-for-air-pollution.html#cb550-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb550-4"><a href="predictive-modeling-for-air-pollution.html#cb550-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb550-5"><a href="predictive-modeling-for-air-pollution.html#cb550-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb550-6"><a href="predictive-modeling-for-air-pollution.html#cb550-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"observed outcome values"</span>, <span class="at">y =</span> <span class="st">"predicted outcome values"</span>)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-462"></span>
<p class="caption marginnote shownote">
Figure 23.10: Comparison of observed and fitted PM2.5 values
</p>
<img src="_main_files/figure-html/unnamed-chunk-462-1.png" alt="Comparison of observed and fitted PM2.5 values" width="672">
</div>
<p>Our range of predicted outcomes appears to be smaller compared to the actual observed values.</p>
<p>We can quantify our model performances using the root mean square error (rmse)<label for="tufte-sn-148" class="margin-toggle sidenote-number">148</label><input type="checkbox" id="tufte-sn-148" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">148</span> Recall, that this is the root of the sum of all the distances between observed and fitter values over the number of observations <span class="math inline">\(RMSE = \frac{\sqrt{\sum_{i=1}^{n}({\hat{y}_{t}-y_{t}})^{2}}}{n}\)</span></span>.</p>
<p>We can calculate RMSE using <code>yardsticks:rmse()</code></p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="predictive-modeling-for-air-pollution.html#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate rmse</span></span>
<span id="cb551-2"><a href="predictive-modeling-for-air-pollution.html#cb551-2" aria-hidden="true" tabindex="-1"></a>fit_PM <span class="sc">%&gt;%</span></span>
<span id="cb551-3"><a href="predictive-modeling-for-air-pollution.html#cb551-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse</span>(<span class="at">truth =</span> value, <span class="at">estimate =</span> .fitted)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard        1.98</code></pre>
</div>
<div id="cross-validation" class="section level3" number="23.4.8">
<h3>
<span class="header-section-number">23.4.8</span> Cross validation<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('cross-validation')" onmouseout="reset_tooltip('cross-validation-tooltip')"><span class="tooltiptext" id="cross-validation-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>We previously realized that without context rmse is not that helpful, the smaller the value the better - but small compared to what? One option would be to compare whether the rmse for our training data set is comparable to our test data set, indicating that it works similarly well for both data sets.</p>
<p>Additionally, we can use the process of cross-validation to split our training data set into multiple data sets for a better assessment and optimization of our model before turning to our test data set<label for="tufte-sn-149" class="margin-toggle sidenote-number">149</label><input type="checkbox" id="tufte-sn-149" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">149</span> We only get to us our test data set once, so we should not be using it for our optimization process.</span>.</p>
<p>There are several methods for cross validation, we will use <strong>k-fold</strong> (or <strong>v-fold</strong>) cross validation. To do this, we split our data into <span class="math inline">\(k\)</span> equally sized subsets (folds). Then we take all but one of these subset (this is called the <strong>holdout</strong>), fit the model and assess the performance of that model using the holdout set. We keep repeating this process until every subset has been left out once.</p>
<p>We are going to ignore the spatial dependence of our data set and randomly subset our training data set into four cross-validation folds. A more involved version of his would involve leaving out blocks of monitors based on geography to test for differences in geography impacting the performance of the data.</p>
<p>We can use <code>rsample::vfold()</code> to create the cross-validation fold<label for="tufte-sn-150" class="margin-toggle sidenote-number">150</label><input type="checkbox" id="tufte-sn-150" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">150</span> we will create 4 sets, this is low, typically you would use 10</span>.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="predictive-modeling-for-air-pollution.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create four subsets</span></span>
<span id="cb553-2"><a href="predictive-modeling-for-air-pollution.html#cb553-2" aria-hidden="true" tabindex="-1"></a>kfold_pm <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(<span class="at">data =</span> train_pm, <span class="at">v =</span> <span class="dv">4</span>)</span>
<span id="cb553-3"><a href="predictive-modeling-for-air-pollution.html#cb553-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-4"><a href="predictive-modeling-for-air-pollution.html#cb553-4" aria-hidden="true" tabindex="-1"></a>kfold_pm</span></code></pre></div>
<pre><code>## #  4-fold cross-validation 
## # A tibble: 4 x 2
##   splits            id   
##   &lt;list&gt;            &lt;chr&gt;
## 1 &lt;split [438/146]&gt; Fold1
## 2 &lt;split [438/146]&gt; Fold2
## 3 &lt;split [438/146]&gt; Fold3
## 4 &lt;split [438/146]&gt; Fold4</code></pre>
<p>We can use <code>tune::fit_resamples()</code> to perform the cross-validation assessment. This automates the process where it will first use fold 1-3, fit the model, the assess the performance using fold 4, then it would use fold 1,2,4 to fit the model and fold 3 for assessment etc. There should always be as many iterations as there are folds.</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="predictive-modeling-for-air-pollution.html#cb555-1" aria-hidden="true" tabindex="-1"></a>xVal <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(PM_wflow, kfold_pm)</span></code></pre></div>
<p>Our next step is would be to take a look at a set of performance metrics based on the fit of the cross validation assessment. For example, <code>tune::show_best()</code> will calculate the mean <code>RMSE</code> value across all four folds.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="predictive-modeling-for-air-pollution.html#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(xVal, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   .metric .estimator  mean     n std_err .config             
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard    2.16     4   0.106 Preprocessor1_Model1</code></pre>
</div>
</div>
<div id="predict-air-pollution-using-random-forest-regression" class="section level2" number="23.5">
<h2>
<span class="header-section-number">23.5</span> Predict air pollution using Random Forest regression<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('predict-air-pollution-using-random-forest-regression')" onmouseout="reset_tooltip('predict-air-pollution-using-random-forest-regression-tooltip')"><span class="tooltiptext" id="predict-air-pollution-using-random-forest-regression-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>We just built a predictive model using a linear regression. This is an example what we generally refer to as a <strong>supervised Machine Learning model</strong><label for="tufte-sn-151" class="margin-toggle sidenote-number">151</label><input type="checkbox" id="tufte-sn-151" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">151</span> Supervised models use labeled data to “supervise” the building of the model.</span>. You have probably primarily used it as a statistical model, i.e. we are interested in making inferences about the population as a whole and understanding relationships between dependent and independent variables. But it can also be used for predictive modeling, where we train the model based on features. However, the more predictor variables are included, the more difficult it becomes to calculate the coefficients.</p>
<p><strong>Random Forest</strong> is a decision tree method that can also be used for a regression analysis, it is also a supervised ML model.</p>
<p>A decision tree partitions data based on a series of sequential decisions. Generally, these decisions are binary (two branches) and are chose to optimally split the data. Each branch is split further based on certain characteristics until all observations in a “branch” are “the same” form in the tree.</p>
<p>Once a tree has been built, you can then follow the tree to predict the outcome for new observations. you have likely used a dichotomous key to identify organisms, this is roughly the same process.</p>
<p>For a random forest, multiple decision trees are created<label for="tufte-sn-152" class="margin-toggle sidenote-number">152</label><input type="checkbox" id="tufte-sn-152" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">152</span> Trees, forests … get it?</span>. Each new tree is based using a random subset of the training data. The mean predictions from each tree is then used to generate the final output.</p>
<p>We will use the <code>randomForest</code> package. It does not allow for categorical variables with more than 53 levels. We manipulated the <code>city</code> column earlier so that it now has 2 levels instead of &gt; 600. However, we will need to remove the <code>zcta</code> and <code>county</code> variables.</p>
<p>We can update the recipe we designed earlier to pre-process our data set to build a regression using a random forest.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="predictive-modeling-for-air-pollution.html#cb558-1" aria-hidden="true" tabindex="-1"></a>RF_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(train_pm) <span class="sc">%&gt;%</span></span>
<span id="cb558-2"><a href="predictive-modeling-for-air-pollution.html#cb558-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="fu">everything</span>(), <span class="at">new_role =</span> <span class="st">"predictor"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb558-3"><a href="predictive-modeling-for-air-pollution.html#cb558-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(value, <span class="at">new_role =</span> <span class="st">"outcome"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb558-4"><a href="predictive-modeling-for-air-pollution.html#cb558-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb558-5"><a href="predictive-modeling-for-air-pollution.html#cb558-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="st">"fips"</span>, <span class="at">new_role =</span> <span class="st">"county id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb558-6"><a href="predictive-modeling-for-air-pollution.html#cb558-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_novel</span>(<span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb558-7"><a href="predictive-modeling-for-air-pollution.html#cb558-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_string2factor</span>(<span class="st">"state"</span>, <span class="st">"county"</span>, <span class="st">"city"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb558-8"><a href="predictive-modeling-for-air-pollution.html#cb558-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_rm</span>(<span class="st">"county"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb558-9"><a href="predictive-modeling-for-air-pollution.html#cb558-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_rm</span>(<span class="st">"zcta"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb558-10"><a href="predictive-modeling-for-air-pollution.html#cb558-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_corr</span>(<span class="fu">all_numeric</span>())<span class="sc">%&gt;%</span></span>
<span id="cb558-11"><a href="predictive-modeling-for-air-pollution.html#cb558-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_nzv</span>(<span class="fu">all_numeric</span>())</span></code></pre></div>
<p>We will now have to specify a new model. We will need to determine the number of predictor variables (<code>mtry</code>) to randomly sample at each split when creating the tree models. The default for a regression analysis is the number of predictors divided by 3. We will also specify the minimum number of data points at a node for a node to be split further (<code>min_n</code>).</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="predictive-modeling-for-air-pollution.html#cb559-1" aria-hidden="true" tabindex="-1"></a>RF_PM <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="dv">10</span>, <span class="at">min_n =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span>  <span class="co"># specify model</span></span>
<span id="cb559-2"><a href="predictive-modeling-for-air-pollution.html#cb559-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"randomForest"</span>) <span class="sc">%&gt;%</span>                  <span class="co"># set engine</span></span>
<span id="cb559-3"><a href="predictive-modeling-for-air-pollution.html#cb559-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)                          <span class="co"># set mode (continuous - regression)</span></span>
<span id="cb559-4"><a href="predictive-modeling-for-air-pollution.html#cb559-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-5"><a href="predictive-modeling-for-air-pollution.html#cb559-5" aria-hidden="true" tabindex="-1"></a>RF_PM</span></code></pre></div>
<pre><code>## Random Forest Model Specification (regression)
## 
## Main Arguments:
##   mtry = 10
##   min_n = 3
## 
## Computational engine: randomForest</code></pre>
<p>Our next step is to specify our workflow:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="predictive-modeling-for-air-pollution.html#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specify workflow</span></span>
<span id="cb561-2"><a href="predictive-modeling-for-air-pollution.html#cb561-2" aria-hidden="true" tabindex="-1"></a>RF_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb561-3"><a href="predictive-modeling-for-air-pollution.html#cb561-3" aria-hidden="true" tabindex="-1"></a>            workflows<span class="sc">::</span><span class="fu">add_recipe</span>(RF_rec) <span class="sc">%&gt;%</span></span>
<span id="cb561-4"><a href="predictive-modeling-for-air-pollution.html#cb561-4" aria-hidden="true" tabindex="-1"></a>            workflows<span class="sc">::</span><span class="fu">add_model</span>(RF_PM)</span>
<span id="cb561-5"><a href="predictive-modeling-for-air-pollution.html#cb561-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-6"><a href="predictive-modeling-for-air-pollution.html#cb561-6" aria-hidden="true" tabindex="-1"></a>RF_wflow</span></code></pre></div>
<pre><code>## == Workflow =======================================================================================================================================
## Preprocessor: Recipe
## Model: rand_forest()
## 
## -- Preprocessor -----------------------------------------------------------------------------------------------------------------------------------
## 6 Recipe Steps
## 
## * step_novel()
## * step_string2factor()
## * step_rm()
## * step_rm()
## * step_corr()
## * step_nzv()
## 
## -- Model ------------------------------------------------------------------------------------------------------------------------------------------
## Random Forest Model Specification (regression)
## 
## Main Arguments:
##   mtry = 10
##   min_n = 3
## 
## Computational engine: randomForest</code></pre>
<p>Now it’s time to fit the model:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="predictive-modeling-for-air-pollution.html#cb563-1" aria-hidden="true" tabindex="-1"></a>RF_wflow_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(RF_wflow, <span class="at">data =</span> train_pm)</span></code></pre></div>
<p>Let’s pull out our top 10 contributing variables</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="predictive-modeling-for-air-pollution.html#cb564-1" aria-hidden="true" tabindex="-1"></a>RF_wflow_fit <span class="sc">%&gt;%</span> </span>
<span id="cb564-2"><a href="predictive-modeling-for-air-pollution.html#cb564-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb564-3"><a href="predictive-modeling-for-air-pollution.html#cb564-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-471-1.png" width="672"></p>
<div id="ques:air-poll-16" class="question">
<p class="question-begin">
► Question 23.16
</p>
<div class="question-body">
<p>What are the most important predictor variables for this model? Compare and contrast the important predictor variables for our two models.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-66" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-66', 'sol-start-66')"></span>
</p>
<div id="sol-body-66" class="solution-body" style="display: none;">
<p>Because <code>vip()</code> relies on <code>ggplot</code> you can use patchwork to plot them side by side for better comparison.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="predictive-modeling-for-air-pollution.html#cb565-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> PM_wflow_fit <span class="sc">%&gt;%</span> </span>
<span id="cb565-2"><a href="predictive-modeling-for-air-pollution.html#cb565-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb565-3"><a href="predictive-modeling-for-air-pollution.html#cb565-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb565-4"><a href="predictive-modeling-for-air-pollution.html#cb565-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linear regression"</span>)</span>
<span id="cb565-5"><a href="predictive-modeling-for-air-pollution.html#cb565-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-6"><a href="predictive-modeling-for-air-pollution.html#cb565-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> RF_wflow_fit <span class="sc">%&gt;%</span> </span>
<span id="cb565-7"><a href="predictive-modeling-for-air-pollution.html#cb565-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb565-8"><a href="predictive-modeling-for-air-pollution.html#cb565-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb565-9"><a href="predictive-modeling-for-air-pollution.html#cb565-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Random Forest regression"</span>)</span>
<span id="cb565-10"><a href="predictive-modeling-for-air-pollution.html#cb565-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-11"><a href="predictive-modeling-for-air-pollution.html#cb565-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-472"></span>
<p class="caption marginnote shownote">
Figure 23.11: Comparison of observed and fitted values for linear regression (left) and random forest (right) models.
</p>
<img src="_main_files/figure-html/unnamed-chunk-472-1.png" alt="Comparison of observed and fitted values for linear regression (left) and random forest (right) models." width="672">
</div>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Our next step is to evaluate our model performance using cross validation<label for="tufte-sn-153" class="margin-toggle sidenote-number">153</label><input type="checkbox" id="tufte-sn-153" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">153</span> Notice the benefit of writing up our specific steps (in this case how we want to perform a cross-validation) for running multiple types of models, we can just reuse <code>kfold_pm</code> as specified earlier!</span>.</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="predictive-modeling-for-air-pollution.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="co"># perform cross-validation</span></span>
<span id="cb566-2"><a href="predictive-modeling-for-air-pollution.html#cb566-2" aria-hidden="true" tabindex="-1"></a>xVal_RF <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">fit_resamples</span>(RF_wflow, kfold_pm)</span>
<span id="cb566-3"><a href="predictive-modeling-for-air-pollution.html#cb566-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb566-4"><a href="predictive-modeling-for-air-pollution.html#cb566-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print rmse and rsq</span></span>
<span id="cb566-5"><a href="predictive-modeling-for-air-pollution.html#cb566-5" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(xVal_RF)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   .metric .estimator  mean     n std_err .config             
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard   1.67      4  0.132  Preprocessor1_Model1
## 2 rsq     standard   0.590     4  0.0429 Preprocessor1_Model1</code></pre>
<p>Now we can compare the two models:</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="predictive-modeling-for-air-pollution.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print rmse and rsq</span></span>
<span id="cb568-2"><a href="predictive-modeling-for-air-pollution.html#cb568-2" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(xVal)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   .metric .estimator  mean     n std_err .config             
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard   2.16      4  0.106  Preprocessor1_Model1
## 2 rsq     standard   0.285     4  0.0242 Preprocessor1_Model1</code></pre>
<div id="ques:air-poll-17" class="question">
<p class="question-begin">
► Question 23.17
</p>
<div class="question-body">
<p>Argue which model you think has the better performance (be sure to explain how you are using RMSE and R2 to support your answer.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Increasing the number of trees used to generate the model (<code>trees</code>) or the number of predictor variables sampled for each split (<code>mtry</code>) would increase the performance of our model (but also requires more computational time and power).</p>
</div>
<div id="model-tuning" class="section level2" number="23.6">
<h2>
<span class="header-section-number">23.6</span> Model Tuning<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('model-tuning')" onmouseout="reset_tooltip('model-tuning-tooltip')"><span class="tooltiptext" id="model-tuning-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p><strong>Hyperparameters</strong> describe the various arguments (parameters) that we need to specify about a given model. In this case <code>mtry</code> is a hyperparameter. We used the default which is a rule of thumb for a “good value,” however, we might want to identify the “best” value for our specific model, i.e. identifying the value that gives us the optimum performance for our model.</p>
<p>This process of optimizing parameters is called <strong>tuning</strong>.</p>
<p>Shall we give it a go? Let’s see if we can optimize values for <code>mtry</code> and <code>min_n</code>. Again, the goal for optimization is to not over- or under-fit but rather describe the true signal in the data as simply as possible.</p>
<p>Tuning is where the cross validation shows its true power because we can run cross-validation for a range of (combinations of) values for the parameters we want to optimize. The assessment using the holdout folds allows us to evaluate not only which model best describes our data but is able to predict outcomes for a new set of observations.</p>
<p>To do this, we can use the same syntax as earlier to specify our model, but instead of specifying exact values for <code>mtry</code> and <code>min_n</code> we will specify that these are the parameters we want to tune using <code>tune()</code>.</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="predictive-modeling-for-air-pollution.html#cb570-1" aria-hidden="true" tabindex="-1"></a>tune_RF <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb570-2"><a href="predictive-modeling-for-air-pollution.html#cb570-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"randomForest"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb570-3"><a href="predictive-modeling-for-air-pollution.html#cb570-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb570-4"><a href="predictive-modeling-for-air-pollution.html#cb570-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb570-5"><a href="predictive-modeling-for-air-pollution.html#cb570-5" aria-hidden="true" tabindex="-1"></a>tune_RF</span></code></pre></div>
<pre><code>## Random Forest Model Specification (regression)
## 
## Main Arguments:
##   mtry = tune()
##   min_n = tune()
## 
## Computational engine: randomForest</code></pre>
<p>Now, all we have to do is add this model specification to our workflow<label for="tufte-sn-154" class="margin-toggle sidenote-number">154</label><input type="checkbox" id="tufte-sn-154" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">154</span> Again, this is the convenience that comes with taking the time to specify a workflow!</span>.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="predictive-modeling-for-air-pollution.html#cb572-1" aria-hidden="true" tabindex="-1"></a>RF_tune_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb572-2"><a href="predictive-modeling-for-air-pollution.html#cb572-2" aria-hidden="true" tabindex="-1"></a>            workflows<span class="sc">::</span><span class="fu">add_recipe</span>(RF_rec) <span class="sc">%&gt;%</span></span>
<span id="cb572-3"><a href="predictive-modeling-for-air-pollution.html#cb572-3" aria-hidden="true" tabindex="-1"></a>            workflows<span class="sc">::</span><span class="fu">add_model</span>(tune_RF)</span>
<span id="cb572-4"><a href="predictive-modeling-for-air-pollution.html#cb572-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-5"><a href="predictive-modeling-for-air-pollution.html#cb572-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-6"><a href="predictive-modeling-for-air-pollution.html#cb572-6" aria-hidden="true" tabindex="-1"></a>RF_tune_wflow</span></code></pre></div>
<pre><code>## == Workflow =======================================================================================================================================
## Preprocessor: Recipe
## Model: rand_forest()
## 
## -- Preprocessor -----------------------------------------------------------------------------------------------------------------------------------
## 6 Recipe Steps
## 
## * step_novel()
## * step_string2factor()
## * step_rm()
## * step_rm()
## * step_corr()
## * step_nzv()
## 
## -- Model ------------------------------------------------------------------------------------------------------------------------------------------
## Random Forest Model Specification (regression)
## 
## Main Arguments:
##   mtry = tune()
##   min_n = tune()
## 
## Computational engine: randomForest</code></pre>
<p>We will use <code>tune::tune_grid()</code> to specify the range of combinations of values we want to test using our cross validation samples of our training set to determine the optimum combination.</p>
<p>This is a lot more computationally intensive than what we have done earlier. One way to increase efficiency is to run processes in parallel (at the same time) on multiple cores.</p>
<p>Check how many cores your laptop has:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="predictive-modeling-for-air-pollution.html#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detectCores</span>()</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>Let’s tune some parameters! By default, the the values for the hyperparameters are randomly drawn from a range of reasonable values, though we will specify how many we want to test using <code>grid</code>. This will take a little bit longer to process than you are used to:</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="predictive-modeling-for-air-pollution.html#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specify number of cores to use</span></span>
<span id="cb576-2"><a href="predictive-modeling-for-air-pollution.html#cb576-2" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> <span class="dv">2</span>)</span>
<span id="cb576-3"><a href="predictive-modeling-for-air-pollution.html#cb576-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb576-4"><a href="predictive-modeling-for-air-pollution.html#cb576-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tune parameters using 20 values per parameter</span></span>
<span id="cb576-5"><a href="predictive-modeling-for-air-pollution.html#cb576-5" aria-hidden="true" tabindex="-1"></a>tune_RF_results <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(<span class="at">object =</span> RF_tune_wflow, <span class="at">resamples =</span> kfold_pm, <span class="at">grid =</span> <span class="dv">20</span>)</span>
<span id="cb576-6"><a href="predictive-modeling-for-air-pollution.html#cb576-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb576-7"><a href="predictive-modeling-for-air-pollution.html#cb576-7" aria-hidden="true" tabindex="-1"></a>tune_RF_results</span></code></pre></div>
<pre><code>## # Tuning results
## # 4-fold cross-validation 
## # A tibble: 4 x 4
##   splits            id    .metrics          .notes          
##   &lt;list&gt;            &lt;chr&gt; &lt;list&gt;            &lt;list&gt;          
## 1 &lt;split [438/146]&gt; Fold1 &lt;tibble [40 x 6]&gt; &lt;tibble [0 x 1]&gt;
## 2 &lt;split [438/146]&gt; Fold2 &lt;tibble [40 x 6]&gt; &lt;tibble [0 x 1]&gt;
## 3 &lt;split [438/146]&gt; Fold3 &lt;tibble [40 x 6]&gt; &lt;tibble [0 x 1]&gt;
## 4 &lt;split [438/146]&gt; Fold4 &lt;tibble [40 x 6]&gt; &lt;tibble [0 x 1]&gt;</code></pre>
<p>Once we have tested the range of values we can asses our results using <code>RMSE</code> and <code>R2</code>.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="predictive-modeling-for-air-pollution.html#cb578-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare performance using RMSE and R2</span></span>
<span id="cb578-2"><a href="predictive-modeling-for-air-pollution.html#cb578-2" aria-hidden="true" tabindex="-1"></a>tune_RF_results <span class="sc">%&gt;%</span></span>
<span id="cb578-3"><a href="predictive-modeling-for-air-pollution.html#cb578-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 40 x 8
##     mtry min_n .metric .estimator  mean     n std_err .config              
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
##  1     1    20 rmse    standard   2.01      4  0.143  Preprocessor1_Model01
##  2     1    20 rsq     standard   0.452     4  0.0381 Preprocessor1_Model01
##  3    30    16 rmse    standard   1.68      4  0.120  Preprocessor1_Model02
##  4    30    16 rsq     standard   0.563     4  0.0494 Preprocessor1_Model02
##  5     9    23 rmse    standard   1.71      4  0.135  Preprocessor1_Model03
##  6     9    23 rsq     standard   0.575     4  0.0424 Preprocessor1_Model03
##  7    31    30 rmse    standard   1.71      4  0.119  Preprocessor1_Model04
##  8    31    30 rsq     standard   0.548     4  0.0500 Preprocessor1_Model04
##  9    14    10 rmse    standard   1.66      4  0.130  Preprocessor1_Model05
## 10    14    10 rsq     standard   0.587     4  0.0472 Preprocessor1_Model05
## # ... with 30 more rows</code></pre>
<p>The function <code>show_best()</code> can be used to pull out the combination of values for <code>min_n</code> and <code>mtry</code> with the best performance.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="predictive-modeling-for-air-pollution.html#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="co"># identify optimized model</span></span>
<span id="cb580-2"><a href="predictive-modeling-for-air-pollution.html#cb580-2" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(tune_RF_results, <span class="at">metric =</span> <span class="st">"rmse"</span>, <span class="at">n =</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 8
##    mtry min_n .metric .estimator  mean     n std_err .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1    23     5 rmse    standard    1.65     4   0.127 Preprocessor1_Model11</code></pre>
<div id="ques:air-poll-18" class="question">
<p class="question-begin">
► Question 23.18
</p>
<div class="question-body">
<p>Which combination of <code>mtry</code> and <code>min_n</code> creates the best model?</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
</div>
<div id="final-model-performance-evaluation" class="section level2" number="23.7">
<h2>
<span class="header-section-number">23.7</span> Final model performance evaluation<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('final-model-performance-evaluation')" onmouseout="reset_tooltip('final-model-performance-evaluation-tooltip')"><span class="tooltiptext" id="final-model-performance-evaluation-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>We almost did it! We now have exhaustively used our training data set to build models and test performances - the time has come to evaluate the performance using our testing data.</p>
<p>To do this, we will use the optimized random forest model we built using our training data to predict values for the monitors in our testing data.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="predictive-modeling-for-air-pollution.html#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pull the optimal model parameters</span></span>
<span id="cb582-2"><a href="predictive-modeling-for-air-pollution.html#cb582-2" aria-hidden="true" tabindex="-1"></a>tuned_RF_values<span class="ot">&lt;-</span> <span class="fu">select_best</span>(tune_RF_results, <span class="st">"rmse"</span>)</span>
<span id="cb582-3"><a href="predictive-modeling-for-air-pollution.html#cb582-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-4"><a href="predictive-modeling-for-air-pollution.html#cb582-4" aria-hidden="true" tabindex="-1"></a>tuned_RF_values</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##    mtry min_n .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
## 1    23     5 Preprocessor1_Model11</code></pre>
<p>Let’s set up our finalized workflow using those values.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="predictive-modeling-for-air-pollution.html#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define workflow using optimized parameters</span></span>
<span id="cb584-2"><a href="predictive-modeling-for-air-pollution.html#cb584-2" aria-hidden="true" tabindex="-1"></a>RF_tuned_wflow <span class="ot">&lt;-</span>RF_tune_wflow <span class="sc">%&gt;%</span></span>
<span id="cb584-3"><a href="predictive-modeling-for-air-pollution.html#cb584-3" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(tuned_RF_values)</span></code></pre></div>
<p>We can use the <code>tune::final_fit()</code> function to fit the final model to the full training set along with the testing data.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="predictive-modeling-for-air-pollution.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build model using training data and predict testing data</span></span>
<span id="cb585-2"><a href="predictive-modeling-for-air-pollution.html#cb585-2" aria-hidden="true" tabindex="-1"></a>overallfit <span class="ot">&lt;-</span>RF_wflow <span class="sc">%&gt;%</span></span>
<span id="cb585-3"><a href="predictive-modeling-for-air-pollution.html#cb585-3" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">last_fit</span>(pm_split)</span></code></pre></div>
<p>Let’s check the performance of the model on the test data (i.e. how well we were able to predict the outcome value).</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="predictive-modeling-for-air-pollution.html#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(overallfit)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   .metric .estimator .estimate .config             
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard       1.72  Preprocessor1_Model1
## 2 rsq     standard       0.607 Preprocessor1_Model1</code></pre>
<p>Our <code>RMSE</code> should be similar to the cross validation sets indicating good performance, i.e. this means that we can expect to achieve our goal of predicting air pollution in areas with no or only sparse monitoring based on the predictors with reasonable accuracy.</p>
<p>We can also generate a table comparing predicted and observed outcome variables to get an idea of how well they match up</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="predictive-modeling-for-air-pollution.html#cb588-1" aria-hidden="true" tabindex="-1"></a>overallfit <span class="sc">%&gt;%</span></span>
<span id="cb588-2"><a href="predictive-modeling-for-air-pollution.html#cb588-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb588-3"><a href="predictive-modeling-for-air-pollution.html#cb588-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   id               .pred  .row value .config             
##   &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;               
## 1 train/test split  12.0     3  11.2 Preprocessor1_Model1
## 2 train/test split  11.7     5  12.4 Preprocessor1_Model1
## 3 train/test split  11.1     6  10.5 Preprocessor1_Model1
## 4 train/test split  13.1     7  15.6 Preprocessor1_Model1
## 5 train/test split  12.0     8  12.4 Preprocessor1_Model1
## 6 train/test split  10.7     9  11.1 Preprocessor1_Model1</code></pre>
</div>
<div id="data-visualization" class="section level2" number="23.8">
<h2>
<span class="header-section-number">23.8</span> Data Visualization<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('data-visualization')" onmouseout="reset_tooltip('data-visualization-tooltip')"><span class="tooltiptext" id="data-visualization-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>Recall, that for this module we will ask the central question <strong>Can we predict annual average air pollution concentrations at the resolution of zip code regional levels using predictor variables describing population density, urbanization, road density, satellite pollution data, and chemical modeling data?</strong></p>
<p>We have successfully built and tested a model that fulfills our requirements (yay us!). If we put this in the context of science as “story-telling” our narrative is the we are able to use a set of predictor values that are generally gathered at much higher resolution compared to air pollution levels to predict annual average air pollution concentrations in areas with no or only sparse monitors with reasonable accuracy.</p>
<div id="ques:air-poll-19" class="question">
<p class="question-begin">
► Question 23.19
</p>
<div class="question-body">
<p>We have established that a good figure has a specific point and serves the narrative. Describe three visualization that you might generate to illustrate the key result of our project.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-67" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-67', 'sol-start-67')"></span>
</p>
<div id="sol-body-67" class="solution-body" style="display: none;">
<p>A map! Let’s make a map to compare our predicted outcome values <span class="math inline">\(\hat{Y}\)</span> to our actual observed outcome values <span class="math inline">\(Y\)</span>.</p>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Let’s start by accessing a simple feature (<code>sf</code>) object that contains information on how to plot polygons for all countries using <code>rnaturalearth::ne_countries()</code>.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="predictive-modeling-for-air-pollution.html#cb590-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span></code></pre></div>
<div id="ques:air-poll-20" class="question">
<p class="question-begin">
► Question 23.20
</p>
<div class="question-body">
<p>Use your plotting skills to plot the world map using <code>ggplot</code>.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-68" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-68', 'sol-start-68')"></span>
</p>
<div id="sol-body-68" class="solution-body" style="display: none;">
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-487"></span>
<p class="caption marginnote shownote">
Figure 23.12: World map
</p>
<img src="_main_files/figure-html/unnamed-chunk-487-1.png" alt="World map" width="672">
</div>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>We are only interested in plotting the continental US which has the following latitude/longitude bounds:</p>
<ul>
<li>Northern bound: 49.3457868</li>
<li>Western bound: -124.7844079</li>
<li>Eastern bound: -66.9513812</li>
<li>Southern bound: 24.7433195</li>
</ul>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:air-poll-21" class="question">
<p class="question-begin">
► Question 23.21
</p>
<div class="question-body">
<p>Create a plot containing only the United States</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-69" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-69', 'sol-start-69')"></span>
</p>
<div id="sol-body-69" class="solution-body" style="display: none;">
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-488"></span>
<p class="caption marginnote shownote">
Figure 23.13: Continental United States.
</p>
<img src="_main_files/figure-html/unnamed-chunk-488-1.png" alt="Continental United States." width="672">
</div>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div id="ques:air-poll-22" class="question">
<p class="question-begin">
► Question 23.22
</p>
<div class="question-body">
<p>Add the monitor stations to your map.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-70" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-70', 'sol-start-70')"></span>
</p>
<div id="sol-body-70" class="solution-body" style="display: none;">
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-489"></span>
<p class="caption marginnote shownote">
Figure 23.14: Map of continential United States indicating county lines.
</p>
<img src="_main_files/figure-html/unnamed-chunk-489-1.png" alt="Map of continential United States indicating county lines." width="672">
</div>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Previously, we accessed data sets containing state lines, for this data set we predicted air pollution at the county level, so let’s go ahead and use <code>maps::map()</code> to access a data set with country polygons. We need to make sure that the object is a simple feature (<code>sf</code>). In this case, we will need to use `sf::st_as_sf() to convert the downloaded object to the correct format.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="predictive-modeling-for-air-pollution.html#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download counties</span></span>
<span id="cb591-2"><a href="predictive-modeling-for-air-pollution.html#cb591-2" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="st">"county"</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb591-3"><a href="predictive-modeling-for-air-pollution.html#cb591-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb591-4"><a href="predictive-modeling-for-air-pollution.html#cb591-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-5"><a href="predictive-modeling-for-air-pollution.html#cb591-5" aria-hidden="true" tabindex="-1"></a><span class="co"># object information</span></span>
<span id="cb591-6"><a href="predictive-modeling-for-air-pollution.html#cb591-6" aria-hidden="true" tabindex="-1"></a>counties</span></code></pre></div>
<pre><code>## Simple feature collection with 3076 features and 1 field
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -124.6813 ymin: 25.12993 xmax: -67.00742 ymax: 49.38323
## Geodetic CRS:  WGS 84
## First 10 features:
##                  ID                           geom
## 1   alabama,autauga MULTIPOLYGON (((-86.50517 3...
## 2   alabama,baldwin MULTIPOLYGON (((-87.93757 3...
## 3   alabama,barbour MULTIPOLYGON (((-85.42801 3...
## 4      alabama,bibb MULTIPOLYGON (((-87.02083 3...
## 5    alabama,blount MULTIPOLYGON (((-86.9578 33...
## 6   alabama,bullock MULTIPOLYGON (((-85.66866 3...
## 7    alabama,butler MULTIPOLYGON (((-86.8604 31...
## 8   alabama,calhoun MULTIPOLYGON (((-85.74313 3...
## 9  alabama,chambers MULTIPOLYGON (((-85.59416 3...
## 10 alabama,cherokee MULTIPOLYGON (((-85.46812 3...</code></pre>
<div id="ques:air-poll-23" class="question">
<p class="question-begin">
► Question 23.23
</p>
<div class="question-body">
<p>Add the county information to your map. Describe how you can use this visualization to serve the narrative for this project.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-71" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-71', 'sol-start-71')"></span>
</p>
<div id="sol-body-71" class="solution-body" style="display: none;">
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-491"></span>
<p class="caption marginnote shownote">
Figure 23.15: Air pollution monitoring system in continental US. Individual monitors are indicated by a red diamond..
</p>
<img src="_main_files/figure-html/unnamed-chunk-491-1.png" alt="Air pollution monitoring system in continental US. Individual monitors are indicated by a red diamond.." width="672">
</div>
<p>This map illustrates really effectively that there are distinct differences in the density of monitors and illustrates that especially in rural areas the distribution can be quite sparse. You would not necessarily include this figure to underscore your results instead you would use it during your introduction when you describe the need to create the model in the first case.</p>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Now, let’s make the set of maps comparing the observed and predicted levels of air pollution, i.e. the figure that we want to use to make the point that indeed, we are able to build and train a model that can be used to predict air pollution levels based on a set of predictor variables.</p>
<p>First we are going to need to make sure that our <code>county</code> data set with the information to plot county polygons and the <code>data.frames</code> containing the observed and predicted air pollution values can be joined, i.e. they need to have a column in common.</p>
<div id="ques:air-poll-24" class="question">
<p class="question-begin">
► Question 23.24
</p>
<div class="question-body">
<p>Let’s take a look at the two objects, both contain a column with county information but you will see that the county information is formatted differently. Use bullet points to describe the steps that you will need to take so that the values will match, suggest which functions you can use to achieve this.</p>
<p>First, the polygons:</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="predictive-modeling-for-air-pollution.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counties)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 1 field
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -88.01778 ymin: 30.24071 xmax: -85.06131 ymax: 34.2686
## Geodetic CRS:  WGS 84
##                ID                           geom
## 1 alabama,autauga MULTIPOLYGON (((-86.50517 3...
## 2 alabama,baldwin MULTIPOLYGON (((-87.93757 3...
## 3 alabama,barbour MULTIPOLYGON (((-85.42801 3...
## 4    alabama,bibb MULTIPOLYGON (((-87.02083 3...
## 5  alabama,blount MULTIPOLYGON (((-86.9578 33...
## 6 alabama,bullock MULTIPOLYGON (((-85.66866 3...</code></pre>
<p>Now our air pollution data:</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="predictive-modeling-for-air-pollution.html#cb595-1" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">%&gt;%</span></span>
<span id="cb595-2"><a href="predictive-modeling-for-air-pollution.html#cb595-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(county) <span class="sc">%&gt;%</span></span>
<span id="cb595-3"><a href="predictive-modeling-for-air-pollution.html#cb595-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## [1] "Baldwin" "Clay"    "Colbert" "DeKalb"  "Etowah"  "Houston"</code></pre>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="msmb-solution">
<p class="solution-begin">
► Solution<span id="sol-start-72" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility('sol-body-72', 'sol-start-72')"></span>
</p>
<div id="sol-body-72" class="solution-body" style="display: none;">
<p>First we need to separate the county and state information in the counties data set, then, we need to make the values in the <code>county</code> column uppercase to match the <code>pm</code> data set.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="predictive-modeling-for-air-pollution.html#cb597-1" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> counties <span class="sc">%&gt;%</span></span>
<span id="cb597-2"><a href="predictive-modeling-for-air-pollution.html#cb597-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(ID, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"county"</span>), <span class="at">sep =</span> <span class="st">","</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb597-3"><a href="predictive-modeling-for-air-pollution.html#cb597-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">str_to_title</span>(county))</span>
<span id="cb597-4"><a href="predictive-modeling-for-air-pollution.html#cb597-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb597-5"><a href="predictive-modeling-for-air-pollution.html#cb597-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counties)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -88.01778 ymin: 30.24071 xmax: -85.06131 ymax: 34.2686
## Geodetic CRS:  WGS 84
##                ID   state  county                           geom
## 1 alabama,autauga alabama Autauga MULTIPOLYGON (((-86.50517 3...
## 2 alabama,baldwin alabama Baldwin MULTIPOLYGON (((-87.93757 3...
## 3 alabama,barbour alabama Barbour MULTIPOLYGON (((-85.42801 3...
## 4    alabama,bibb alabama    Bibb MULTIPOLYGON (((-87.02083 3...
## 5  alabama,blount alabama  Blount MULTIPOLYGON (((-86.9578 33...
## 6 alabama,bullock alabama Bullock MULTIPOLYGON (((-85.66866 3...</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Now we can use <code>inner_join()</code> to combine the two data sets.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="predictive-modeling-for-air-pollution.html#cb599-1" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> counties <span class="sc">%&gt;%</span></span>
<span id="cb599-2"><a href="predictive-modeling-for-air-pollution.html#cb599-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(pm, <span class="at">by =</span> <span class="st">"county"</span>)</span></code></pre></div>
<div id="ques:air-poll-25" class="question">
<p class="question-begin">
► Question 23.25
</p>
<div class="question-body">
<p>Conceptually explain the difference between using <code>left_join()</code>, <code>inner_join()</code> and <code>full_join()</code>.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>We’re read to create a map displaying the observed mean annual air pollution data for each country.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="predictive-modeling-for-air-pollution.html#cb600-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb600-2"><a href="predictive-modeling-for-air-pollution.html#cb600-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb600-3"><a href="predictive-modeling-for-air-pollution.html#cb600-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> map_data, <span class="fu">aes</span>(<span class="at">fill =</span> value), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb600-4"><a href="predictive-modeling-for-air-pollution.html#cb600-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb600-5"><a href="predictive-modeling-for-air-pollution.html#cb600-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max),</span>
<span id="cb600-6"><a href="predictive-modeling-for-air-pollution.html#cb600-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb600-7"><a href="predictive-modeling-for-air-pollution.html#cb600-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Observed mean annual PM2.5 concentration"</span>)</span>
<span id="cb600-8"><a href="predictive-modeling-for-air-pollution.html#cb600-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-9"><a href="predictive-modeling-for-air-pollution.html#cb600-9" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-496"></span>
<p class="caption marginnote shownote">
Figure 23.16: Observed mean annual PM2.5 concentration for counties with air pollution monitor.
</p>
<img src="_main_files/figure-html/unnamed-chunk-496-1.png" alt="Observed mean annual PM2.5 concentration for counties with air pollution monitor." width="672">
</div>
<p>Now, let’s create the same plot but displaying the predicted values. To do this we will first need to get all the predicted values for both our training and test data sets and then join that data set with our <code>counties</code> data set as above to be able to plot it.</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="predictive-modeling-for-air-pollution.html#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model for monitors in training set</span></span>
<span id="cb601-2"><a href="predictive-modeling-for-air-pollution.html#cb601-2" aria-hidden="true" tabindex="-1"></a>train_fit <span class="ot">&lt;-</span> RF_tuned_wflow <span class="sc">%&gt;%</span></span>
<span id="cb601-3"><a href="predictive-modeling-for-air-pollution.html#cb601-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> train_pm)</span>
<span id="cb601-4"><a href="predictive-modeling-for-air-pollution.html#cb601-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-5"><a href="predictive-modeling-for-air-pollution.html#cb601-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model for monitors in training set</span></span>
<span id="cb601-6"><a href="predictive-modeling-for-air-pollution.html#cb601-6" aria-hidden="true" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> RF_tuned_wflow <span class="sc">%&gt;%</span></span>
<span id="cb601-7"><a href="predictive-modeling-for-air-pollution.html#cb601-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> test_pm)</span>
<span id="cb601-8"><a href="predictive-modeling-for-air-pollution.html#cb601-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-9"><a href="predictive-modeling-for-air-pollution.html#cb601-9" aria-hidden="true" tabindex="-1"></a><span class="co"># predict values for monitors in training set</span></span>
<span id="cb601-10"><a href="predictive-modeling-for-air-pollution.html#cb601-10" aria-hidden="true" tabindex="-1"></a>pred_train <span class="ot">&lt;-</span> train_fit <span class="sc">%&gt;%</span></span>
<span id="cb601-11"><a href="predictive-modeling-for-air-pollution.html#cb601-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(train_pm) <span class="sc">%&gt;%</span></span>
<span id="cb601-12"><a href="predictive-modeling-for-air-pollution.html#cb601-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(train_pm) <span class="sc">%&gt;%</span></span>
<span id="cb601-13"><a href="predictive-modeling-for-air-pollution.html#cb601-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.pred, value, fips, county, id)</span>
<span id="cb601-14"><a href="predictive-modeling-for-air-pollution.html#cb601-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-15"><a href="predictive-modeling-for-air-pollution.html#cb601-15" aria-hidden="true" tabindex="-1"></a><span class="co"># predict values for monitors in test set</span></span>
<span id="cb601-16"><a href="predictive-modeling-for-air-pollution.html#cb601-16" aria-hidden="true" tabindex="-1"></a>pred_test <span class="ot">&lt;-</span> test_fit <span class="sc">%&gt;%</span></span>
<span id="cb601-17"><a href="predictive-modeling-for-air-pollution.html#cb601-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(test_pm) <span class="sc">%&gt;%</span></span>
<span id="cb601-18"><a href="predictive-modeling-for-air-pollution.html#cb601-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_pm) <span class="sc">%&gt;%</span></span>
<span id="cb601-19"><a href="predictive-modeling-for-air-pollution.html#cb601-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.pred, value, fips, county, id)</span>
<span id="cb601-20"><a href="predictive-modeling-for-air-pollution.html#cb601-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-21"><a href="predictive-modeling-for-air-pollution.html#cb601-21" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data sets</span></span>
<span id="cb601-22"><a href="predictive-modeling-for-air-pollution.html#cb601-22" aria-hidden="true" tabindex="-1"></a>pred_PM25 <span class="ot">&lt;-</span> pred_test <span class="sc">%&gt;%</span></span>
<span id="cb601-23"><a href="predictive-modeling-for-air-pollution.html#cb601-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(pred_train)</span>
<span id="cb601-24"><a href="predictive-modeling-for-air-pollution.html#cb601-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-25"><a href="predictive-modeling-for-air-pollution.html#cb601-25" aria-hidden="true" tabindex="-1"></a><span class="co"># add counties data for plotting</span></span>
<span id="cb601-26"><a href="predictive-modeling-for-air-pollution.html#cb601-26" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> counties <span class="sc">%&gt;%</span></span>
<span id="cb601-27"><a href="predictive-modeling-for-air-pollution.html#cb601-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(pred_PM25, <span class="at">by =</span> <span class="st">"county"</span>)</span></code></pre></div>
<div id="ques:air-poll-26" class="question">
<p class="question-begin">
► Question 23.26
</p>
<div class="question-body">
<p>Describe how this visualization displays our results (i.e. how is data encoded).</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<p>Now we should be able to create a plot with our predicted PM2.5 levels.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="predictive-modeling-for-air-pollution.html#cb602-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb602-2"><a href="predictive-modeling-for-air-pollution.html#cb602-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb602-3"><a href="predictive-modeling-for-air-pollution.html#cb602-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> map_data, <span class="fu">aes</span>(<span class="at">fill =</span> value), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb602-4"><a href="predictive-modeling-for-air-pollution.html#cb602-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb602-5"><a href="predictive-modeling-for-air-pollution.html#cb602-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max),</span>
<span id="cb602-6"><a href="predictive-modeling-for-air-pollution.html#cb602-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb602-7"><a href="predictive-modeling-for-air-pollution.html#cb602-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted mean annual PM2.5 concentration"</span>)</span>
<span id="cb602-8"><a href="predictive-modeling-for-air-pollution.html#cb602-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-9"><a href="predictive-modeling-for-air-pollution.html#cb602-9" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-498"></span>
<p class="caption marginnote shownote">
Figure 23.17: Predicted mean annual PM2.5 concentration for counties with air pollution monitor.
</p>
<img src="_main_files/figure-html/unnamed-chunk-498-1.png" alt="Predicted mean annual PM2.5 concentration for counties with air pollution monitor." width="672">
</div>
<p>Finally, we’ll use <code>patchwork</code> to create our final figure. We’ll use <code>patchwork::plot_annotation()</code> to add a title and legend<label for="tufte-sn-155" class="margin-toggle sidenote-number">155</label><input type="checkbox" id="tufte-sn-155" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">155</span> Note that adding <code>\n</code>forces a line break. Put that in your back pocket for creating good visualizations!</span></p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="predictive-modeling-for-air-pollution.html#cb603-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span></span>
<span id="cb603-2"><a href="predictive-modeling-for-air-pollution.html#cb603-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of observed (top) and predicted (bottom) PM2.5 levels."</span>,</span>
<span id="cb603-3"><a href="predictive-modeling-for-air-pollution.html#cb603-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">"A random forest model was trained to predict air PM2.5 levels based on predictor </span><span class="sc">\n</span><span class="st">variables including population levels, road density, development"</span>)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-499"></span>
<p class="caption marginnote shownote">
Figure 23.18: Comparison of observed and predicted mean annual PM2.5 concentration for counties with air pollution monitor.
</p>
<img src="_main_files/figure-html/unnamed-chunk-499-1.png" alt="Comparison of observed and predicted mean annual PM2.5 concentration for counties with air pollution monitor." width="864">
</div>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

<div id="acknowledgments-6" class="section level2" number="23.9">
<h2>
<span class="header-section-number">23.9</span> Acknowledgments<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('acknowledgments-6')" onmouseout="reset_tooltip('acknowledgments-6-tooltip')"><span class="tooltiptext" id="acknowledgments-6-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>These activities are based on the Air pollution open case study.<label for="tufte-sn-156" class="margin-toggle sidenote-number">156</label><input type="checkbox" id="tufte-sn-156" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">156</span> Wright, Carrie and Meng, Qier and Jager, Leah and Taub, Margaret and Hicks, Stephanie. (2020). <a href="https://github.com//opencasestudies/ocs-bp-air-pollution" class="uri">https://github.com//opencasestudies/ocs-bp-air-pollution</a>. Predicting Annual Air Pollution (Version v1.0.0)..</span></p>

</div>
</body></html>

<p style="text-align: center;">
<a href="simulated-data-for-hypothesis-testing-ii.html"><button class="btn btn-default">Previous</button></a>
<a href="references.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2021-11-17
 using 
R version 4.0.2 (2020-06-22)
</p>
</div>
</div>



</body>
</html>
